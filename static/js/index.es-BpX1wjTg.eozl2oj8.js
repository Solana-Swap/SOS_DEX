import{_ as fw}from"./index.cqjpgwtr.js";import{r as _e,a as Ro}from"./events-Cln-J3MF.ok6sy4ox.js";import{a0 as ut,aP as dw,$ as Oo,dG as wu,aa as gw}from"./Bridge.naj9bgy5.js";import{E as L,p as Ol,S as Nl,g as Cl,y as xl,n as yw,O as No,X as Al,G as Tl,A as Dl,r as jl,f as vw,H as ql,Q as mw}from"./index-DwIccy-O.mzej9uuk.js";import{X as Ps,$ as Rs,Y as Os,k as Lt,E as Wt,H as ur,q as ww,a as xr,V as $l,L as we,e as Ns,A as Fe,v as Co,Q as xo,Z as _u,w as lo,s as Ul,b as _w,n as fe,i as se,r as bw,U as Ew,c as Iw,F as bu,D as Sw,J as Pw,t as Rw,d as Eu,f as Ow,z as Nw}from"./index-DNGdMjrh.n26x5nkw.js";import"./vue.fv0erkdm.js";import"./lodash-es.bp0zmem9.js";import"./axios.i01mok01.js";import"./dayjs.pb8a0t5b.js";import"./vuex.jdzbw26m.js";import"./vue-router.jwqkmej7.js";import"./svg-icons.nw66rbkj.js";var Cw={};(function(o){const r=Cl,n=xl,s=Ol,a=Nl,u=d=>d==null,h=Symbol("encodeFragmentIdentifier");function y(d){switch(d.arrayFormat){case"index":return v=>(w,_)=>{const S=w.length;return _===void 0||d.skipNull&&_===null||d.skipEmptyString&&_===""?w:_===null?[...w,[O(v,d),"[",S,"]"].join("")]:[...w,[O(v,d),"[",O(S,d),"]=",O(_,d)].join("")]};case"bracket":return v=>(w,_)=>_===void 0||d.skipNull&&_===null||d.skipEmptyString&&_===""?w:_===null?[...w,[O(v,d),"[]"].join("")]:[...w,[O(v,d),"[]=",O(_,d)].join("")];case"colon-list-separator":return v=>(w,_)=>_===void 0||d.skipNull&&_===null||d.skipEmptyString&&_===""?w:_===null?[...w,[O(v,d),":list="].join("")]:[...w,[O(v,d),":list=",O(_,d)].join("")];case"comma":case"separator":case"bracket-separator":{const v=d.arrayFormat==="bracket-separator"?"[]=":"=";return w=>(_,S)=>S===void 0||d.skipNull&&S===null||d.skipEmptyString&&S===""?_:(S=S===null?"":S,_.length===0?[[O(w,d),v,O(S,d)].join("")]:[[_,O(S,d)].join(d.arrayFormatSeparator)])}default:return v=>(w,_)=>_===void 0||d.skipNull&&_===null||d.skipEmptyString&&_===""?w:_===null?[...w,O(v,d)]:[...w,[O(v,d),"=",O(_,d)].join("")]}}function I(d){let v;switch(d.arrayFormat){case"index":return(w,_,S)=>{if(v=/\[(\d*)\]$/.exec(w),w=w.replace(/\[\d*\]$/,""),!v){S[w]=_;return}S[w]===void 0&&(S[w]={}),S[w][v[1]]=_};case"bracket":return(w,_,S)=>{if(v=/(\[\])$/.exec(w),w=w.replace(/\[\]$/,""),!v){S[w]=_;return}if(S[w]===void 0){S[w]=[_];return}S[w]=[].concat(S[w],_)};case"colon-list-separator":return(w,_,S)=>{if(v=/(:list)$/.exec(w),w=w.replace(/:list$/,""),!v){S[w]=_;return}if(S[w]===void 0){S[w]=[_];return}S[w]=[].concat(S[w],_)};case"comma":case"separator":return(w,_,S)=>{const $=typeof _=="string"&&_.includes(d.arrayFormatSeparator),D=typeof _=="string"&&!$&&A(_,d).includes(d.arrayFormatSeparator);_=D?A(_,d):_;const Y=$||D?_.split(d.arrayFormatSeparator).map(Ur=>A(Ur,d)):_===null?_:A(_,d);S[w]=Y};case"bracket-separator":return(w,_,S)=>{const $=/(\[\])$/.test(w);if(w=w.replace(/\[\]$/,""),!$){S[w]=_&&A(_,d);return}const D=_===null?[]:_.split(d.arrayFormatSeparator).map(Y=>A(Y,d));if(S[w]===void 0){S[w]=D;return}S[w]=[].concat(S[w],D)};default:return(w,_,S)=>{if(S[w]===void 0){S[w]=_;return}S[w]=[].concat(S[w],_)}}}function R(d){if(typeof d!="string"||d.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function O(d,v){return v.encode?v.strict?r(d):encodeURIComponent(d):d}function A(d,v){return v.decode?n(d):d}function j(d){return Array.isArray(d)?d.sort():typeof d=="object"?j(Object.keys(d)).sort((v,w)=>Number(v)-Number(w)).map(v=>d[v]):d}function F(d){const v=d.indexOf("#");return v!==-1&&(d=d.slice(0,v)),d}function z(d){let v="";const w=d.indexOf("#");return w!==-1&&(v=d.slice(w)),v}function et(d){d=F(d);const v=d.indexOf("?");return v===-1?"":d.slice(v+1)}function nt(d,v){return v.parseNumbers&&!Number.isNaN(Number(d))&&typeof d=="string"&&d.trim()!==""?d=Number(d):v.parseBooleans&&d!==null&&(d.toLowerCase()==="true"||d.toLowerCase()==="false")&&(d=d.toLowerCase()==="true"),d}function st(d,v){v=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},v),R(v.arrayFormatSeparator);const w=I(v),_=Object.create(null);if(typeof d!="string"||(d=d.trim().replace(/^[?#&]/,""),!d))return _;for(const S of d.split("&")){if(S==="")continue;let[$,D]=s(v.decode?S.replace(/\+/g," "):S,"=");D=D===void 0?null:["comma","separator","bracket-separator"].includes(v.arrayFormat)?D:A(D,v),w(A($,v),D,_)}for(const S of Object.keys(_)){const $=_[S];if(typeof $=="object"&&$!==null)for(const D of Object.keys($))$[D]=nt($[D],v);else _[S]=nt($,v)}return v.sort===!1?_:(v.sort===!0?Object.keys(_).sort():Object.keys(_).sort(v.sort)).reduce((S,$)=>{const D=_[$];return D&&typeof D=="object"&&!Array.isArray(D)?S[$]=j(D):S[$]=D,S},Object.create(null))}o.extract=et,o.parse=st,o.stringify=(d,v)=>{if(!d)return"";v=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},v),R(v.arrayFormatSeparator);const w=D=>v.skipNull&&u(d[D])||v.skipEmptyString&&d[D]==="",_=y(v),S={};for(const D of Object.keys(d))w(D)||(S[D]=d[D]);const $=Object.keys(S);return v.sort!==!1&&$.sort(v.sort),$.map(D=>{const Y=d[D];return Y===void 0?"":Y===null?O(D,v):Array.isArray(Y)?Y.length===0&&v.arrayFormat==="bracket-separator"?O(D,v)+"[]":Y.reduce(_(D),[]).join("&"):O(D,v)+"="+O(Y,v)}).filter(D=>D.length>0).join("&")},o.parseUrl=(d,v)=>{v=Object.assign({decode:!0},v);const[w,_]=s(d,"#");return Object.assign({url:w.split("?")[0]||"",query:st(et(d),v)},v&&v.parseFragmentIdentifier&&_?{fragmentIdentifier:A(_,v)}:{})},o.stringifyUrl=(d,v)=>{v=Object.assign({encode:!0,strict:!0,[h]:!0},v);const w=F(d.url).split("?")[0]||"",_=o.extract(d.url),S=o.parse(_,{sort:!1}),$=Object.assign(S,d.query);let D=o.stringify($,v);D&&(D=`?${D}`);let Y=z(d.url);return d.fragmentIdentifier&&(Y=`#${v[h]?O(d.fragmentIdentifier,v):d.fragmentIdentifier}`),`${w}${D}${Y}`},o.pick=(d,v,w)=>{w=Object.assign({parseFragmentIdentifier:!0,[h]:!1},w);const{url:_,query:S,fragmentIdentifier:$}=o.parseUrl(d,w);return o.stringifyUrl({url:_,query:a(S,v),fragmentIdentifier:$},w)},o.exclude=(d,v,w)=>{const _=Array.isArray(v)?S=>!v.includes(S):(S,$)=>!v(S,$);return o.pick(d,_,w)}})(Cw);function xw(o,r=[]){const n=[];return Object.keys(o).forEach(s=>{if(r.length&&!r.includes(s))return;const a=o[s];n.push(...a.accounts)}),n}const Aw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Tw(o,r){const{message:n,code:s}=Aw[o];return{message:n,code:s}}function ho(o,r){return!!Array.isArray(o)}var Dr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var po=function(o,r){return po=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var a in s)s.hasOwnProperty(a)&&(n[a]=s[a])},po(o,r)};function Dw(o,r){po(o,r);function n(){this.constructor=o}o.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}var fo=function(){return fo=Object.assign||function(o){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(o[a]=r[a])}return o},fo.apply(this,arguments)};function jw(o,r){var n={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&r.indexOf(s)<0&&(n[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)r.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(n[s[a]]=o[s[a]]);return n}function qw(o,r,n,s){var a=arguments.length,u=a<3?r:s===null?s=Object.getOwnPropertyDescriptor(r,n):s,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,r,n,s);else for(var y=o.length-1;y>=0;y--)(h=o[y])&&(u=(a<3?h(u):a>3?h(r,n,u):h(r,n))||u);return a>3&&u&&Object.defineProperty(r,n,u),u}function $w(o,r){return function(n,s){r(n,s,o)}}function Uw(o,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,r)}function kw(o,r,n,s){function a(u){return u instanceof n?u:new n(function(h){h(u)})}return new(n||(n=Promise))(function(u,h){function y(O){try{R(s.next(O))}catch(A){h(A)}}function I(O){try{R(s.throw(O))}catch(A){h(A)}}function R(O){O.done?u(O.value):a(O.value).then(y,I)}R((s=s.apply(o,r||[])).next())})}function Mw(o,r){var n={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,h;return h={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function y(R){return function(O){return I([R,O])}}function I(R){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,a&&(u=R[0]&2?a.return:R[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,R[1])).done)return u;switch(a=0,u&&(R=[R[0]&2,u.value]),R[0]){case 0:case 1:u=R;break;case 4:return n.label++,{value:R[1],done:!1};case 5:n.label++,a=R[1],R=[0];continue;case 7:R=n.ops.pop(),n.trys.pop();continue;default:if(u=n.trys,!(u=u.length>0&&u[u.length-1])&&(R[0]===6||R[0]===2)){n=0;continue}if(R[0]===3&&(!u||R[1]>u[0]&&R[1]<u[3])){n.label=R[1];break}if(R[0]===6&&n.label<u[1]){n.label=u[1],u=R;break}if(u&&n.label<u[2]){n.label=u[2],n.ops.push(R);break}u[2]&&n.ops.pop(),n.trys.pop();continue}R=r.call(o,n)}catch(O){R=[6,O],a=0}finally{s=u=0}if(R[0]&5)throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}}function Lw(o,r,n,s){s===void 0&&(s=n),o[s]=r[n]}function zw(o,r){for(var n in o)n!=="default"&&!r.hasOwnProperty(n)&&(r[n]=o[n])}function go(o){var r=typeof Symbol=="function"&&Symbol.iterator,n=r&&o[r],s=0;if(n)return n.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function kl(o,r){var n=typeof Symbol=="function"&&o[Symbol.iterator];if(!n)return o;var s=n.call(o),a,u=[],h;try{for(;(r===void 0||r-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(y){h={error:y}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(h)throw h.error}}return u}function Hw(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(kl(arguments[r]));return o}function Vw(){for(var o=0,r=0,n=arguments.length;r<n;r++)o+=arguments[r].length;for(var s=Array(o),a=0,r=0;r<n;r++)for(var u=arguments[r],h=0,y=u.length;h<y;h++,a++)s[a]=u[h];return s}function vn(o){return this instanceof vn?(this.v=o,this):new vn(o)}function Kw(o,r,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(o,r||[]),a,u=[];return a={},h("next"),h("throw"),h("return"),a[Symbol.asyncIterator]=function(){return this},a;function h(j){s[j]&&(a[j]=function(F){return new Promise(function(z,et){u.push([j,F,z,et])>1||y(j,F)})})}function y(j,F){try{I(s[j](F))}catch(z){A(u[0][3],z)}}function I(j){j.value instanceof vn?Promise.resolve(j.value.v).then(R,O):A(u[0][2],j)}function R(j){y("next",j)}function O(j){y("throw",j)}function A(j,F){j(F),u.shift(),u.length&&y(u[0][0],u[0][1])}}function Fw(o){var r,n;return r={},s("next"),s("throw",function(a){throw a}),s("return"),r[Symbol.iterator]=function(){return this},r;function s(a,u){r[a]=o[a]?function(h){return(n=!n)?{value:vn(o[a](h)),done:a==="return"}:u?u(h):h}:u}}function Gw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o[Symbol.asyncIterator],n;return r?r.call(o):(o=typeof go=="function"?go(o):o[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(u){n[u]=o[u]&&function(h){return new Promise(function(y,I){h=o[u](h),a(y,I,h.done,h.value)})}}function a(u,h,y,I){Promise.resolve(I).then(function(R){u({value:R,done:y})},h)}}function Bw(o,r){return Object.defineProperty?Object.defineProperty(o,"raw",{value:r}):o.raw=r,o}function Ww(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var n in o)Object.hasOwnProperty.call(o,n)&&(r[n]=o[n]);return r.default=o,r}function Qw(o){return o&&o.__esModule?o:{default:o}}function Jw(o,r){if(!r.has(o))throw new TypeError("attempted to get private field on non-instance");return r.get(o)}function Zw(o,r,n){if(!r.has(o))throw new TypeError("attempted to set private field on non-instance");return r.set(o,n),n}const Yw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return fo},__asyncDelegator:Fw,__asyncGenerator:Kw,__asyncValues:Gw,__await:vn,__awaiter:kw,__classPrivateFieldGet:Jw,__classPrivateFieldSet:Zw,__createBinding:Lw,__decorate:qw,__exportStar:zw,__extends:Dw,__generator:Mw,__importDefault:Qw,__importStar:Ww,__makeTemplateObject:Bw,__metadata:Uw,__param:$w,__read:kl,__rest:jw,__spread:Hw,__spreadArrays:Vw,__values:go},Symbol.toStringTag,{value:"Module"})),Cs=Oo(Yw);var an={},Iu={},cn={};const Xw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:ur},Symbol.toStringTag,{value:"Module"})),t_=Oo(Xw);var Su;function e_(){if(Su)return cn;Su=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.IHeartBeat=void 0;const o=t_;class r extends o.IEvents{constructor(s){super()}}return cn.IHeartBeat=r,cn}var Pu;function Ml(){return Pu||(Pu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Cs.__exportStar(e_(),o)}(Iu)),Iu}var Ru={},or={},Ou;function r_(){if(Ou)return or;Ou=1,Object.defineProperty(or,"__esModule",{value:!0}),or.HEARTBEAT_EVENTS=or.HEARTBEAT_INTERVAL=void 0;const o=L;return or.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,or.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},or}var Nu;function Ll(){return Nu||(Nu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Cs.__exportStar(r_(),o)}(Ru)),Ru}var Cu;function n_(){if(Cu)return an;Cu=1,Object.defineProperty(an,"__esModule",{value:!0}),an.HeartBeat=void 0;const o=Cs,r=dw(),n=L,s=Ml(),a=Ll();class u extends s.IHeartBeat{constructor(y){super(y),this.events=new r.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||a.HEARTBEAT_INTERVAL}static init(y){return o.__awaiter(this,void 0,void 0,function*(){const I=new u(y);return yield I.init(),I})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,I){this.events.on(y,I)}once(y,I){this.events.once(y,I)}off(y,I){this.events.off(y,I)}removeListener(y,I){this.events.removeListener(y,I)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),n.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return an.HeartBeat=u,an}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const r=Cs;r.__exportStar(n_(),o),r.__exportStar(Ml(),o),r.__exportStar(Ll(),o)})(Dr);class s_ extends ur{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}let i_=class extends ur{constructor(o,r){super(),this.core=o,this.logger=r,this.records=new Map}};class o_{constructor(r,n){this.logger=r,this.core=n}}let a_=class extends ur{constructor(o,r){super(),this.relayer=o,this.logger=r}},c_=class extends ur{constructor(o){super()}},u_=class{constructor(o,r,n,s){this.core=o,this.logger=r,this.name=n}},l_=class extends ur{constructor(o,r){super(),this.relayer=o,this.logger=r}},h_=class extends ur{constructor(o,r){super(),this.core=o,this.logger=r}},p_=class{constructor(o,r){this.projectId=o,this.logger=r}},f_=class{constructor(o,r){this.projectId=o,this.logger=r}},d_=class{constructor(o){this.opts=o,this.protocol="wc",this.version=2}},g_=class{constructor(o){this.client=o}};var mn={};(function(o){const r=Cl,n=xl,s=Ol,a=Nl,u=d=>d==null,h=Symbol("encodeFragmentIdentifier");function y(d){switch(d.arrayFormat){case"index":return v=>(w,_)=>{const S=w.length;return _===void 0||d.skipNull&&_===null||d.skipEmptyString&&_===""?w:_===null?[...w,[O(v,d),"[",S,"]"].join("")]:[...w,[O(v,d),"[",O(S,d),"]=",O(_,d)].join("")]};case"bracket":return v=>(w,_)=>_===void 0||d.skipNull&&_===null||d.skipEmptyString&&_===""?w:_===null?[...w,[O(v,d),"[]"].join("")]:[...w,[O(v,d),"[]=",O(_,d)].join("")];case"colon-list-separator":return v=>(w,_)=>_===void 0||d.skipNull&&_===null||d.skipEmptyString&&_===""?w:_===null?[...w,[O(v,d),":list="].join("")]:[...w,[O(v,d),":list=",O(_,d)].join("")];case"comma":case"separator":case"bracket-separator":{const v=d.arrayFormat==="bracket-separator"?"[]=":"=";return w=>(_,S)=>S===void 0||d.skipNull&&S===null||d.skipEmptyString&&S===""?_:(S=S===null?"":S,_.length===0?[[O(w,d),v,O(S,d)].join("")]:[[_,O(S,d)].join(d.arrayFormatSeparator)])}default:return v=>(w,_)=>_===void 0||d.skipNull&&_===null||d.skipEmptyString&&_===""?w:_===null?[...w,O(v,d)]:[...w,[O(v,d),"=",O(_,d)].join("")]}}function I(d){let v;switch(d.arrayFormat){case"index":return(w,_,S)=>{if(v=/\[(\d*)\]$/.exec(w),w=w.replace(/\[\d*\]$/,""),!v){S[w]=_;return}S[w]===void 0&&(S[w]={}),S[w][v[1]]=_};case"bracket":return(w,_,S)=>{if(v=/(\[\])$/.exec(w),w=w.replace(/\[\]$/,""),!v){S[w]=_;return}if(S[w]===void 0){S[w]=[_];return}S[w]=[].concat(S[w],_)};case"colon-list-separator":return(w,_,S)=>{if(v=/(:list)$/.exec(w),w=w.replace(/:list$/,""),!v){S[w]=_;return}if(S[w]===void 0){S[w]=[_];return}S[w]=[].concat(S[w],_)};case"comma":case"separator":return(w,_,S)=>{const $=typeof _=="string"&&_.includes(d.arrayFormatSeparator),D=typeof _=="string"&&!$&&A(_,d).includes(d.arrayFormatSeparator);_=D?A(_,d):_;const Y=$||D?_.split(d.arrayFormatSeparator).map(Ur=>A(Ur,d)):_===null?_:A(_,d);S[w]=Y};case"bracket-separator":return(w,_,S)=>{const $=/(\[\])$/.test(w);if(w=w.replace(/\[\]$/,""),!$){S[w]=_&&A(_,d);return}const D=_===null?[]:_.split(d.arrayFormatSeparator).map(Y=>A(Y,d));if(S[w]===void 0){S[w]=D;return}S[w]=[].concat(S[w],D)};default:return(w,_,S)=>{if(S[w]===void 0){S[w]=_;return}S[w]=[].concat(S[w],_)}}}function R(d){if(typeof d!="string"||d.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function O(d,v){return v.encode?v.strict?r(d):encodeURIComponent(d):d}function A(d,v){return v.decode?n(d):d}function j(d){return Array.isArray(d)?d.sort():typeof d=="object"?j(Object.keys(d)).sort((v,w)=>Number(v)-Number(w)).map(v=>d[v]):d}function F(d){const v=d.indexOf("#");return v!==-1&&(d=d.slice(0,v)),d}function z(d){let v="";const w=d.indexOf("#");return w!==-1&&(v=d.slice(w)),v}function et(d){d=F(d);const v=d.indexOf("?");return v===-1?"":d.slice(v+1)}function nt(d,v){return v.parseNumbers&&!Number.isNaN(Number(d))&&typeof d=="string"&&d.trim()!==""?d=Number(d):v.parseBooleans&&d!==null&&(d.toLowerCase()==="true"||d.toLowerCase()==="false")&&(d=d.toLowerCase()==="true"),d}function st(d,v){v=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},v),R(v.arrayFormatSeparator);const w=I(v),_=Object.create(null);if(typeof d!="string"||(d=d.trim().replace(/^[?#&]/,""),!d))return _;for(const S of d.split("&")){if(S==="")continue;let[$,D]=s(v.decode?S.replace(/\+/g," "):S,"=");D=D===void 0?null:["comma","separator","bracket-separator"].includes(v.arrayFormat)?D:A(D,v),w(A($,v),D,_)}for(const S of Object.keys(_)){const $=_[S];if(typeof $=="object"&&$!==null)for(const D of Object.keys($))$[D]=nt($[D],v);else _[S]=nt($,v)}return v.sort===!1?_:(v.sort===!0?Object.keys(_).sort():Object.keys(_).sort(v.sort)).reduce((S,$)=>{const D=_[$];return D&&typeof D=="object"&&!Array.isArray(D)?S[$]=j(D):S[$]=D,S},Object.create(null))}o.extract=et,o.parse=st,o.stringify=(d,v)=>{if(!d)return"";v=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},v),R(v.arrayFormatSeparator);const w=D=>v.skipNull&&u(d[D])||v.skipEmptyString&&d[D]==="",_=y(v),S={};for(const D of Object.keys(d))w(D)||(S[D]=d[D]);const $=Object.keys(S);return v.sort!==!1&&$.sort(v.sort),$.map(D=>{const Y=d[D];return Y===void 0?"":Y===null?O(D,v):Array.isArray(Y)?Y.length===0&&v.arrayFormat==="bracket-separator"?O(D,v)+"[]":Y.reduce(_(D),[]).join("&"):O(D,v)+"="+O(Y,v)}).filter(D=>D.length>0).join("&")},o.parseUrl=(d,v)=>{v=Object.assign({decode:!0},v);const[w,_]=s(d,"#");return Object.assign({url:w.split("?")[0]||"",query:st(et(d),v)},v&&v.parseFragmentIdentifier&&_?{fragmentIdentifier:A(_,v)}:{})},o.stringifyUrl=(d,v)=>{v=Object.assign({encode:!0,strict:!0,[h]:!0},v);const w=F(d.url).split("?")[0]||"",_=o.extract(d.url),S=o.parse(_,{sort:!1}),$=Object.assign(S,d.query);let D=o.stringify($,v);D&&(D=`?${D}`);let Y=z(d.url);return d.fragmentIdentifier&&(Y=`#${v[h]?O(d.fragmentIdentifier,v):d.fragmentIdentifier}`),`${w}${D}${Y}`},o.pick=(d,v,w)=>{w=Object.assign({parseFragmentIdentifier:!0,[h]:!1},w);const{url:_,query:S,fragmentIdentifier:$}=o.parseUrl(d,w);return o.stringifyUrl({url:_,query:a(S,v),fragmentIdentifier:$},w)},o.exclude=(d,v,w)=>{const _=Array.isArray(v)?S=>!v.includes(S):(S,$)=>!v(S,$);return o.pick(d,_,w)}})(mn);const y_=":";function v_(o){const[r,n]=o.split(y_);return{namespace:r,reference:n}}function zl(o,r){return o.includes(":")?[o]:r.chains||[]}const Hl="base10",Tt="base16",yo="base64pad",Ao="utf8",Vl=0,lr=1,m_=0,xu=1,vo=12,To=32;function w_(){const o=Dl.generateKeyPair();return{privateKey:se(o.secretKey,Tt),publicKey:se(o.publicKey,Tt)}}function mo(){const o=jl.randomBytes(To);return se(o,Tt)}function __(o,r){const n=Dl.sharedKey(fe(o,Tt),fe(r,Tt),!0),s=new vw(No.SHA256,n).expand(To);return se(s,Tt)}function b_(o){const r=No.hash(fe(o,Tt));return se(r,Tt)}function Ar(o){const r=No.hash(fe(o,Ao));return se(r,Tt)}function E_(o){return fe(`${o}`,Hl)}function _n(o){return Number(se(o,Hl))}function I_(o){const r=E_(typeof o.type<"u"?o.type:Vl);if(_n(r)===lr&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof o.senderPublicKey<"u"?fe(o.senderPublicKey,Tt):void 0,s=typeof o.iv<"u"?fe(o.iv,Tt):jl.randomBytes(vo),a=new ql.ChaCha20Poly1305(fe(o.symKey,Tt)).seal(s,fe(o.message,Ao));return P_({type:r,sealed:a,iv:s,senderPublicKey:n})}function S_(o){const r=new ql.ChaCha20Poly1305(fe(o.symKey,Tt)),{sealed:n,iv:s}=Es(o.encoded),a=r.open(s,n);if(a===null)throw new Error("Failed to decrypt");return se(a,Ao)}function P_(o){if(_n(o.type)===lr){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return se(Eu([o.type,o.senderPublicKey,o.iv,o.sealed]),yo)}return se(Eu([o.type,o.iv,o.sealed]),yo)}function Es(o){const r=fe(o,yo),n=r.slice(m_,xu),s=xu;if(_n(n)===lr){const y=s+To,I=y+vo,R=r.slice(s,y),O=r.slice(y,I),A=r.slice(I);return{type:n,sealed:A,iv:O,senderPublicKey:R}}const a=s+vo,u=r.slice(s,a),h=r.slice(a);return{type:n,sealed:h,iv:u}}function R_(o,r){const n=Es(o);return Kl({type:_n(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?se(n.senderPublicKey,Tt):void 0,receiverPublicKey:r==null?void 0:r.receiverPublicKey})}function Kl(o){const r=(o==null?void 0:o.type)||Vl;if(r===lr){if(typeof(o==null?void 0:o.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(o==null?void 0:o.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:r,senderPublicKey:o==null?void 0:o.senderPublicKey,receiverPublicKey:o==null?void 0:o.receiverPublicKey}}function Au(o){return o.type===lr&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var O_=Object.defineProperty,Tu=Object.getOwnPropertySymbols,N_=Object.prototype.hasOwnProperty,C_=Object.prototype.propertyIsEnumerable,Du=(o,r,n)=>r in o?O_(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,ju=(o,r)=>{for(var n in r||(r={}))N_.call(r,n)&&Du(o,n,r[n]);if(Tu)for(var n of Tu(r))C_.call(r,n)&&Du(o,n,r[n]);return o};const x_="ReactNative",Bt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},A_="js";function Do(){return typeof ut.process<"u"&&typeof ut.process.versions<"u"&&typeof ut.process.versions.node<"u"}function jr(){return!Tl()&&!!Al()&&navigator.product===x_}function qr(){return!Do()&&!!Al()&&!!Tl()}function bn(){return jr()?Bt.reactNative:Do()?Bt.node:qr()?Bt.browser:Bt.unknown}function T_(){var o;try{return jr()&&typeof ut.global<"u"&&typeof(ut.global==null?void 0:ut.global.Application)<"u"?(o=ut.global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function D_(o,r){let n=mn.parse(o);return n=ju(ju({},n),r),o=mn.stringify(n),o}function j_(){return yw()||{name:"",description:"",url:"",icons:[""]}}function q_(){if(bn()===Bt.reactNative&&typeof ut.global<"u"&&typeof(ut.global==null?void 0:ut.global.Platform)<"u"){const{OS:n,Version:s}=ut.global.Platform;return[n,s].join("-")}const o=Nw();if(o===null)return"unknown";const r=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[r,o.name,o.version].join("-"):[r,o.version].join("-")}function $_(){var o;const r=bn();return r===Bt.browser?[r,((o=mw())==null?void 0:o.host)||"unknown"].join(":"):r}function U_(o,r,n){const s=q_(),a=$_();return[[o,r].join("-"),[A_,n].join("-"),s,a].join("/")}function k_({protocol:o,version:r,relayUrl:n,sdkVersion:s,auth:a,projectId:u,useOnCloseEvent:h,bundleId:y}){const I=n.split("?"),R=U_(o,r,s),O={auth:a,ua:R,projectId:u,useOnCloseEvent:h||void 0,origin:y||void 0},A=D_(I[1]||"",O);return I[0]+"?"+A}function ar(o,r){return o.filter(n=>r.includes(n)).length===o.length}function Fl(o){return Object.fromEntries(o.entries())}function Gl(o){return new Map(Object.entries(o))}function Nr(o=L.FIVE_MINUTES,r){const n=L.toMiliseconds(o||L.FIVE_MINUTES);let s,a,u;return{resolve:h=>{u&&s&&(clearTimeout(u),s(h))},reject:h=>{u&&a&&(clearTimeout(u),a(h))},done:()=>new Promise((h,y)=>{u=setTimeout(()=>{y(new Error(r))},n),s=h,a=y})}}function wn(o,r,n){return new Promise(async(s,a)=>{const u=setTimeout(()=>a(new Error(n)),r);try{const h=await o;s(h)}catch(h){a(h)}clearTimeout(u)})}function Bl(o,r){if(typeof r=="string"&&r.startsWith(`${o}:`))return r;if(o.toLowerCase()==="topic"){if(typeof r!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${r}`}else if(o.toLowerCase()==="id"){if(typeof r!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${r}`}throw new Error(`Unknown expirer target type: ${o}`)}function M_(o){return Bl("topic",o)}function L_(o){return Bl("id",o)}function Wl(o){const[r,n]=o.split(":"),s={id:void 0,topic:void 0};if(r==="topic"&&typeof n=="string")s.topic=n;else if(r==="id"&&Number.isInteger(Number(n)))s.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${r}:${n}`);return s}function pe(o,r){return L.fromMiliseconds(Date.now()+L.toMiliseconds(o))}function Ge(o){return Date.now()>=L.toMiliseconds(o)}function mt(o,r){return`${o}${r?`:${r}`:""}`}function Xi(o=[],r=[]){return[...new Set([...o,...r])]}async function z_({id:o,topic:r,wcDeepLink:n}){try{if(!n)return;const s=typeof n=="string"?JSON.parse(n):n;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${o}&sessionTopic=${r}`,h=bn();h===Bt.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):h===Bt.reactNative&&typeof(ut.global==null?void 0:ut.global.Linking)<"u"&&await ut.global.Linking.openURL(u)}catch(s){console.error(s)}}async function H_(o,r){try{return await o.getItem(r)||(qr()?localStorage.getItem(r):void 0)}catch(n){console.error(n)}}const V_="irn";function wo(o){return(o==null?void 0:o.relay)||{protocol:V_}}function _s(o){const r=Ow[o];if(typeof r>"u")throw new Error(`Relay Protocol not supported: ${o}`);return r}var K_=Object.defineProperty,qu=Object.getOwnPropertySymbols,F_=Object.prototype.hasOwnProperty,G_=Object.prototype.propertyIsEnumerable,$u=(o,r,n)=>r in o?K_(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,B_=(o,r)=>{for(var n in r||(r={}))F_.call(r,n)&&$u(o,n,r[n]);if(qu)for(var n of qu(r))G_.call(r,n)&&$u(o,n,r[n]);return o};function W_(o,r="-"){const n={},s="relay"+r;return Object.keys(o).forEach(a=>{if(a.startsWith(s)){const u=a.replace(s,""),h=o[a];n[u]=h}}),n}function Uu(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const r=o.indexOf(":"),n=o.indexOf("?")!==-1?o.indexOf("?"):void 0,s=o.substring(0,r),a=o.substring(r+1,n).split("@"),u=typeof n<"u"?o.substring(n):"",h=mn.parse(u);return{protocol:s,topic:Q_(a[0]),version:parseInt(a[1],10),symKey:h.symKey,relay:W_(h)}}function Q_(o){return o.startsWith("//")?o.substring(2):o}function J_(o,r="-"){const n="relay",s={};return Object.keys(o).forEach(a=>{const u=n+r+a;o[a]&&(s[u]=o[a])}),s}function Z_(o){return`${o.protocol}:${o.topic}@${o.version}?`+mn.stringify(B_({symKey:o.symKey},J_(o.relay)))}function $r(o){const r=[];return o.forEach(n=>{const[s,a]=n.split(":");r.push(`${s}:${a}`)}),r}function Y_(o){const r=[];return Object.values(o).forEach(n=>{r.push(...$r(n.accounts))}),r}function X_(o,r){const n=[];return Object.values(o).forEach(s=>{$r(s.accounts).includes(r)&&n.push(...s.methods)}),n}function tb(o,r){const n=[];return Object.values(o).forEach(s=>{$r(s.accounts).includes(r)&&n.push(...s.events)}),n}function eb(o,r){const n=bs(o,r);if(n)throw new Error(n.message);const s={};for(const[a,u]of Object.entries(o))s[a]={methods:u.methods,events:u.events,chains:u.accounts.map(h=>`${h.split(":")[0]}:${h.split(":")[1]}`)};return s}function jo(o){return o.includes(":")}function dn(o){return jo(o)?o.split(":")[0]:o}const rb={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},nb={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function q(o,r){const{message:n,code:s}=nb[o];return{message:r?`${n} ${r}`:n,code:s}}function vt(o,r){const{message:n,code:s}=rb[o];return{message:r?`${n} ${r}`:n,code:s}}function cr(o,r){return!!Array.isArray(o)}function Tr(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function Mt(o){return typeof o>"u"}function Et(o,r){return r&&Mt(o)?!0:typeof o=="string"&&!!o.trim().length}function qo(o,r){return typeof o=="number"&&!isNaN(o)}function sb(o,r){const{requiredNamespaces:n}=r,s=Object.keys(o.namespaces),a=Object.keys(n);let u=!0;return ar(a,s)?(s.forEach(h=>{const{accounts:y,methods:I,events:R}=o.namespaces[h],O=$r(y),A=n[h];(!ar(zl(h,A),O)||!ar(A.methods,I)||!ar(A.events,R))&&(u=!1)}),u):!1}function Is(o){return Et(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function ib(o){if(Et(o,!1)&&o.includes(":")){const r=o.split(":");if(r.length===3){const n=r[0]+":"+r[1];return!!r[2]&&Is(n)}}return!1}function ob(o){if(Et(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function ab(o){var r;return(r=o==null?void 0:o.proposer)==null?void 0:r.publicKey}function cb(o){return o==null?void 0:o.topic}function ub(o,r){let n=null;return Et(o==null?void 0:o.publicKey,!1)||(n=q("MISSING_OR_INVALID",`${r} controller public key should be a string`)),n}function ku(o){let r=!0;return cr(o)?o.length&&(r=o.every(n=>Et(n,!1))):r=!1,r}function lb(o,r,n){let s=null;return cr(r)&&r.length?r.forEach(a=>{s||Is(a)||(s=vt("UNSUPPORTED_CHAINS",`${n}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Is(o)||(s=vt("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function hb(o,r,n){let s=null;return Object.entries(o).forEach(([a,u])=>{if(s)return;const h=lb(a,zl(a,u),`${r} ${n}`);h&&(s=h)}),s}function pb(o,r){let n=null;return cr(o)?o.forEach(s=>{n||ib(s)||(n=vt("UNSUPPORTED_ACCOUNTS",`${r}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):n=vt("UNSUPPORTED_ACCOUNTS",`${r}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function fb(o,r){let n=null;return Object.values(o).forEach(s=>{if(n)return;const a=pb(s==null?void 0:s.accounts,`${r} namespace`);a&&(n=a)}),n}function db(o,r){let n=null;return ku(o==null?void 0:o.methods)?ku(o==null?void 0:o.events)||(n=vt("UNSUPPORTED_EVENTS",`${r}, events should be an array of strings or empty array for no events`)):n=vt("UNSUPPORTED_METHODS",`${r}, methods should be an array of strings or empty array for no methods`),n}function Ql(o,r){let n=null;return Object.values(o).forEach(s=>{if(n)return;const a=db(s,`${r}, namespace`);a&&(n=a)}),n}function gb(o,r,n){let s=null;if(o&&Tr(o)){const a=Ql(o,r);a&&(s=a);const u=hb(o,r,n);u&&(s=u)}else s=q("MISSING_OR_INVALID",`${r}, ${n} should be an object with data`);return s}function bs(o,r){let n=null;if(o&&Tr(o)){const s=Ql(o,r);s&&(n=s);const a=fb(o,r);a&&(n=a)}else n=q("MISSING_OR_INVALID",`${r}, namespaces should be an object with data`);return n}function Jl(o){return Et(o.protocol,!0)}function yb(o,r){let n=!1;return o?o&&cr(o)&&o.length&&o.forEach(s=>{n=Jl(s)}):n=!0,n}function vb(o){return typeof o=="number"}function kt(o){return typeof o<"u"&&typeof o!==null}function mb(o){return!(!o||typeof o!="object"||!o.code||!qo(o.code)||!o.message||!Et(o.message,!1))}function wb(o){return!(Mt(o)||!Et(o.method,!1))}function _b(o){return!(Mt(o)||Mt(o.result)&&Mt(o.error)||!qo(o.id)||!Et(o.jsonrpc,!1))}function bb(o){return!(Mt(o)||!Et(o.name,!1))}function Mu(o,r){return!(!Is(r)||!Y_(o).includes(r))}function Eb(o,r,n){return Et(n,!1)?X_(o,r).includes(n):!1}function Ib(o,r,n){return Et(n,!1)?tb(o,r).includes(n):!1}function Lu(o,r,n){let s=null;const a=Sb(o),u=Pb(r),h=Object.keys(a),y=Object.keys(u),I=zu(Object.keys(o)),R=zu(Object.keys(r)),O=I.filter(A=>!R.includes(A));return O.length&&(s=q("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${O.toString()}
      Received: ${Object.keys(r).toString()}`)),ar(h,y)||(s=q("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${h.toString()}
      Approved: ${y.toString()}`)),Object.keys(r).forEach(A=>{if(!A.includes(":")||s)return;const j=$r(r[A].accounts);j.includes(A)||(s=q("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${A}
        Required: ${A}
        Approved: ${j.toString()}`))}),h.forEach(A=>{s||(ar(a[A].methods,u[A].methods)?ar(a[A].events,u[A].events)||(s=q("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${A}`)):s=q("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${A}`))}),s}function Sb(o){const r={};return Object.keys(o).forEach(n=>{var s;n.includes(":")?r[n]=o[n]:(s=o[n].chains)==null||s.forEach(a=>{r[a]={methods:o[n].methods,events:o[n].events}})}),r}function zu(o){return[...new Set(o.map(r=>r.includes(":")?r.split(":")[0]:r))]}function Pb(o){const r={};return Object.keys(o).forEach(n=>{if(n.includes(":"))r[n]=o[n];else{const s=$r(o[n].accounts);s==null||s.forEach(a=>{r[a]={accounts:o[n].accounts.filter(u=>u.includes(`${a}:`)),methods:o[n].methods,events:o[n].events}})}}),r}function Rb(o,r){return qo(o)&&o<=r.max&&o>=r.min}function Hu(){const o=bn();return new Promise(r=>{switch(o){case Bt.browser:r(Ob());break;case Bt.reactNative:r(Nb());break;case Bt.node:r(Cb());break;default:r(!0)}})}function Ob(){return qr()&&(navigator==null?void 0:navigator.onLine)}async function Nb(){if(jr()&&typeof ut.global<"u"&&ut.global!=null&&ut.global.NetInfo){const o=await(ut.global==null?void 0:ut.global.NetInfo.fetch());return o==null?void 0:o.isConnected}return!0}function Cb(){return!0}function xb(o){switch(bn()){case Bt.browser:Ab(o);break;case Bt.reactNative:Tb(o);break}}function Ab(o){!jr()&&qr()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function Tb(o){var r;jr()&&typeof ut.global<"u"&&ut.global!=null&&ut.global.NetInfo&&((r=ut.global)==null||r.NetInfo.addEventListener(n=>o(n==null?void 0:n.isConnected)))}const to={};let ys=class{static get(o){return to[o]}static set(o,r){to[o]=r}static delete(o){delete to[o]}};class De extends ww{constructor(r){super(r),this.events=new _e.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(r),this.connection.connected&&this.registerEventListeners()}async connect(r=this.connection){await this.open(r)}async disconnect(){await this.close()}on(r,n){this.events.on(r,n)}once(r,n){this.events.once(r,n)}off(r,n){this.events.off(r,n)}removeListener(r,n){this.events.removeListener(r,n)}async request(r,n){return this.requestStrict(xr(r.method,r.params||[],r.id||$l().toString()),n)}async requestStrict(r,n){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${r.id}`,u=>{we(u)?a(u.error):s(u.result)});try{await this.connection.send(r,n)}catch(u){a(u)}})}setConnection(r=this.connection){return r}onPayload(r){this.events.emit("payload",r),Ns(r)?this.events.emit(`${r.id}`,r):this.events.emit("message",{type:r.method,data:r.params})}onClose(r){r&&r.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${r.code} ${r.reason?`(${r.reason})`:""}`)),this.events.emit("disconnect")}async open(r=this.connection){this.connection===r&&this.connection.connected||(this.connection.connected&&this.close(),typeof r=="string"&&(await this.connection.open(r),r=this.connection),this.connection=this.setConnection(r),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",r=>this.onPayload(r)),this.connection.on("close",r=>this.onClose(r)),this.connection.on("error",r=>this.events.emit("error",r)),this.connection.on("register_error",r=>this.onClose()),this.hasRegisteredEventListeners=!0)}}function Db(o,r){return r=r||{},new Promise(function(n,s){var a=new XMLHttpRequest,u=[],h=[],y={},I=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:I,headers:{keys:function(){return u},entries:function(){return h},get:function(O){return y[O.toLowerCase()]},has:function(O){return O.toLowerCase()in y}}}};for(var R in a.open(r.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(O,A,j){u.push(A=A.toLowerCase()),h.push([A,j]),y[A]=y[A]?y[A]+","+j:j}),n(I())},a.onerror=s,a.withCredentials=r.credentials=="include",r.headers)a.setRequestHeader(R,r.headers[R]);a.send(r.body||null)})}const jb=Object.freeze(Object.defineProperty({__proto__:null,default:Db},Symbol.toStringTag,{value:"Module"})),Vu=Oo(jb);var qb=self.fetch||(self.fetch=Vu.default||Vu);const $b=gw(qb);function Ub(o,r){if(o.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),s=0;s<n.length;s++)n[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),h=u.charCodeAt(0);if(n[h]!==255)throw new TypeError(u+" is ambiguous");n[h]=a}var y=o.length,I=o.charAt(0),R=Math.log(y)/Math.log(256),O=Math.log(256)/Math.log(y);function A(z){if(z instanceof Uint8Array||(ArrayBuffer.isView(z)?z=new Uint8Array(z.buffer,z.byteOffset,z.byteLength):Array.isArray(z)&&(z=Uint8Array.from(z))),!(z instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(z.length===0)return"";for(var et=0,nt=0,st=0,d=z.length;st!==d&&z[st]===0;)st++,et++;for(var v=(d-st)*O+1>>>0,w=new Uint8Array(v);st!==d;){for(var _=z[st],S=0,$=v-1;(_!==0||S<nt)&&$!==-1;$--,S++)_+=256*w[$]>>>0,w[$]=_%y>>>0,_=_/y>>>0;if(_!==0)throw new Error("Non-zero carry");nt=S,st++}for(var D=v-nt;D!==v&&w[D]===0;)D++;for(var Y=I.repeat(et);D<v;++D)Y+=o.charAt(w[D]);return Y}function j(z){if(typeof z!="string")throw new TypeError("Expected String");if(z.length===0)return new Uint8Array;var et=0;if(z[et]!==" "){for(var nt=0,st=0;z[et]===I;)nt++,et++;for(var d=(z.length-et)*R+1>>>0,v=new Uint8Array(d);z[et];){var w=n[z.charCodeAt(et)];if(w===255)return;for(var _=0,S=d-1;(w!==0||_<st)&&S!==-1;S--,_++)w+=y*v[S]>>>0,v[S]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");st=_,et++}if(z[et]!==" "){for(var $=d-st;$!==d&&v[$]===0;)$++;for(var D=new Uint8Array(nt+(d-$)),Y=nt;$!==d;)D[Y++]=v[$++];return D}}}function F(z){var et=j(z);if(et)return et;throw new Error(`Non-${r} character`)}return{encode:A,decodeUnsafe:j,decode:F}}var kb=Ub,Mb=kb;const Zl=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Lb=o=>new TextEncoder().encode(o),zb=o=>new TextDecoder().decode(o);class Hb{constructor(r,n,s){this.name=r,this.prefix=n,this.baseEncode=s}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Vb{constructor(r,n,s){if(this.name=r,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=s}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return Yl(this,r)}}class Kb{constructor(r){this.decoders=r}or(r){return Yl(this,r)}decode(r){const n=r[0],s=this.decoders[n];if(s)return s.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Yl=(o,r)=>new Kb({...o.decoders||{[o.prefix]:o},...r.decoders||{[r.prefix]:r}});class Fb{constructor(r,n,s,a){this.name=r,this.prefix=n,this.baseEncode=s,this.baseDecode=a,this.encoder=new Hb(r,n,s),this.decoder=new Vb(r,n,a)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const xs=({name:o,prefix:r,encode:n,decode:s})=>new Fb(o,r,n,s),En=({prefix:o,name:r,alphabet:n})=>{const{encode:s,decode:a}=Mb(n,r);return xs({prefix:o,name:r,encode:s,decode:u=>Zl(a(u))})},Gb=(o,r,n,s)=>{const a={};for(let O=0;O<r.length;++O)a[r[O]]=O;let u=o.length;for(;o[u-1]==="=";)--u;const h=new Uint8Array(u*n/8|0);let y=0,I=0,R=0;for(let O=0;O<u;++O){const A=a[o[O]];if(A===void 0)throw new SyntaxError(`Non-${s} character`);I=I<<n|A,y+=n,y>=8&&(y-=8,h[R++]=255&I>>y)}if(y>=n||255&I<<8-y)throw new SyntaxError("Unexpected end of data");return h},Bb=(o,r,n)=>{const s=r[r.length-1]==="=",a=(1<<n)-1;let u="",h=0,y=0;for(let I=0;I<o.length;++I)for(y=y<<8|o[I],h+=8;h>n;)h-=n,u+=r[a&y>>h];if(h&&(u+=r[a&y<<n-h]),s)for(;u.length*n&7;)u+="=";return u},Pt=({name:o,prefix:r,bitsPerChar:n,alphabet:s})=>xs({prefix:r,name:o,encode(a){return Bb(a,s,n)},decode(a){return Gb(a,s,n,o)}}),Wb=xs({prefix:"\0",name:"identity",encode:o=>zb(o),decode:o=>Lb(o)});var Qb=Object.freeze({__proto__:null,identity:Wb});const Jb=Pt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Zb=Object.freeze({__proto__:null,base2:Jb});const Yb=Pt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Xb=Object.freeze({__proto__:null,base8:Yb});const tE=En({prefix:"9",name:"base10",alphabet:"0123456789"});var eE=Object.freeze({__proto__:null,base10:tE});const rE=Pt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),nE=Pt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var sE=Object.freeze({__proto__:null,base16:rE,base16upper:nE});const iE=Pt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),oE=Pt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),aE=Pt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),cE=Pt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),uE=Pt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),lE=Pt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hE=Pt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),pE=Pt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fE=Pt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dE=Object.freeze({__proto__:null,base32:iE,base32upper:oE,base32pad:aE,base32padupper:cE,base32hex:uE,base32hexupper:lE,base32hexpad:hE,base32hexpadupper:pE,base32z:fE});const gE=En({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),yE=En({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var vE=Object.freeze({__proto__:null,base36:gE,base36upper:yE});const mE=En({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),wE=En({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var _E=Object.freeze({__proto__:null,base58btc:mE,base58flickr:wE});const bE=Pt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),EE=Pt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),IE=Pt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),SE=Pt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var PE=Object.freeze({__proto__:null,base64:bE,base64pad:EE,base64url:IE,base64urlpad:SE});const Xl=Array.from("ğŸš€ğŸªâ˜„ğŸ›°ğŸŒŒğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜ğŸŒğŸŒğŸŒğŸ‰â˜€ğŸ’»ğŸ–¥ğŸ’¾ğŸ’¿ğŸ˜‚â¤ğŸ˜ğŸ¤£ğŸ˜ŠğŸ™ğŸ’•ğŸ˜­ğŸ˜˜ğŸ‘ğŸ˜…ğŸ‘ğŸ˜ğŸ”¥ğŸ¥°ğŸ’”ğŸ’–ğŸ’™ğŸ˜¢ğŸ¤”ğŸ˜†ğŸ™„ğŸ’ªğŸ˜‰â˜ºğŸ‘ŒğŸ¤—ğŸ’œğŸ˜”ğŸ˜ğŸ˜‡ğŸŒ¹ğŸ¤¦ğŸ‰ğŸ’âœŒâœ¨ğŸ¤·ğŸ˜±ğŸ˜ŒğŸŒ¸ğŸ™ŒğŸ˜‹ğŸ’—ğŸ’šğŸ˜ğŸ’›ğŸ™‚ğŸ’“ğŸ¤©ğŸ˜„ğŸ˜€ğŸ–¤ğŸ˜ƒğŸ’¯ğŸ™ˆğŸ‘‡ğŸ¶ğŸ˜’ğŸ¤­â£ğŸ˜œğŸ’‹ğŸ‘€ğŸ˜ªğŸ˜‘ğŸ’¥ğŸ™‹ğŸ˜ğŸ˜©ğŸ˜¡ğŸ¤ªğŸ‘ŠğŸ¥³ğŸ˜¥ğŸ¤¤ğŸ‘‰ğŸ’ƒğŸ˜³âœ‹ğŸ˜šğŸ˜ğŸ˜´ğŸŒŸğŸ˜¬ğŸ™ƒğŸ€ğŸŒ·ğŸ˜»ğŸ˜“â­âœ…ğŸ¥ºğŸŒˆğŸ˜ˆğŸ¤˜ğŸ’¦âœ”ğŸ˜£ğŸƒğŸ’â˜¹ğŸŠğŸ’˜ğŸ˜ â˜ğŸ˜•ğŸŒºğŸ‚ğŸŒ»ğŸ˜ğŸ–•ğŸ’ğŸ™ŠğŸ˜¹ğŸ—£ğŸ’«ğŸ’€ğŸ‘‘ğŸµğŸ¤ğŸ˜›ğŸ”´ğŸ˜¤ğŸŒ¼ğŸ˜«âš½ğŸ¤™â˜•ğŸ†ğŸ¤«ğŸ‘ˆğŸ˜®ğŸ™†ğŸ»ğŸƒğŸ¶ğŸ’ğŸ˜²ğŸŒ¿ğŸ§¡ğŸâš¡ğŸŒğŸˆâŒâœŠğŸ‘‹ğŸ˜°ğŸ¤¨ğŸ˜¶ğŸ¤ğŸš¶ğŸ’°ğŸ“ğŸ’¢ğŸ¤ŸğŸ™ğŸš¨ğŸ’¨ğŸ¤¬âœˆğŸ€ğŸºğŸ¤“ğŸ˜™ğŸ’ŸğŸŒ±ğŸ˜–ğŸ‘¶ğŸ¥´â–¶â¡â“ğŸ’ğŸ’¸â¬‡ğŸ˜¨ğŸŒšğŸ¦‹ğŸ˜·ğŸ•ºâš ğŸ™…ğŸ˜ŸğŸ˜µğŸ‘ğŸ¤²ğŸ¤ ğŸ¤§ğŸ“ŒğŸ”µğŸ’…ğŸ§ğŸ¾ğŸ’ğŸ˜—ğŸ¤‘ğŸŒŠğŸ¤¯ğŸ·â˜ğŸ’§ğŸ˜¯ğŸ’†ğŸ‘†ğŸ¤ğŸ™‡ğŸ‘â„ğŸŒ´ğŸ’£ğŸ¸ğŸ’ŒğŸ“ğŸ¥€ğŸ¤¢ğŸ‘…ğŸ’¡ğŸ’©ğŸ‘ğŸ“¸ğŸ‘»ğŸ¤ğŸ¤®ğŸ¼ğŸ¥µğŸš©ğŸğŸŠğŸ‘¼ğŸ’ğŸ“£ğŸ¥‚"),RE=Xl.reduce((o,r,n)=>(o[n]=r,o),[]),OE=Xl.reduce((o,r,n)=>(o[r.codePointAt(0)]=n,o),[]);function NE(o){return o.reduce((r,n)=>(r+=RE[n],r),"")}function CE(o){const r=[];for(const n of o){const s=OE[n.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${n}`);r.push(s)}return new Uint8Array(r)}const xE=xs({prefix:"ğŸš€",name:"base256emoji",encode:NE,decode:CE});var AE=Object.freeze({__proto__:null,base256emoji:xE}),TE=th,Ku=128,DE=127,jE=~DE,qE=Math.pow(2,31);function th(o,r,n){r=r||[],n=n||0;for(var s=n;o>=qE;)r[n++]=o&255|Ku,o/=128;for(;o&jE;)r[n++]=o&255|Ku,o>>>=7;return r[n]=o|0,th.bytes=n-s+1,r}var $E=_o,UE=128,Fu=127;function _o(o,s){var n=0,s=s||0,a=0,u=s,h,y=o.length;do{if(u>=y)throw _o.bytes=0,new RangeError("Could not decode varint");h=o[u++],n+=a<28?(h&Fu)<<a:(h&Fu)*Math.pow(2,a),a+=7}while(h>=UE);return _o.bytes=u-s,n}var kE=Math.pow(2,7),ME=Math.pow(2,14),LE=Math.pow(2,21),zE=Math.pow(2,28),HE=Math.pow(2,35),VE=Math.pow(2,42),KE=Math.pow(2,49),FE=Math.pow(2,56),GE=Math.pow(2,63),BE=function(o){return o<kE?1:o<ME?2:o<LE?3:o<zE?4:o<HE?5:o<VE?6:o<KE?7:o<FE?8:o<GE?9:10},WE={encode:TE,decode:$E,encodingLength:BE},eh=WE;const Gu=(o,r,n=0)=>(eh.encode(o,r,n),r),Bu=o=>eh.encodingLength(o),bo=(o,r)=>{const n=r.byteLength,s=Bu(o),a=s+Bu(n),u=new Uint8Array(a+n);return Gu(o,u,0),Gu(n,u,s),u.set(r,a),new QE(o,n,r,u)};class QE{constructor(r,n,s,a){this.code=r,this.size=n,this.digest=s,this.bytes=a}}const rh=({name:o,code:r,encode:n})=>new JE(o,r,n);class JE{constructor(r,n,s){this.name=r,this.code=n,this.encode=s}digest(r){if(r instanceof Uint8Array){const n=this.encode(r);return n instanceof Uint8Array?bo(this.code,n):n.then(s=>bo(this.code,s))}else throw Error("Unknown type, must be binary type")}}const nh=o=>async r=>new Uint8Array(await crypto.subtle.digest(o,r)),ZE=rh({name:"sha2-256",code:18,encode:nh("SHA-256")}),YE=rh({name:"sha2-512",code:19,encode:nh("SHA-512")});var XE=Object.freeze({__proto__:null,sha256:ZE,sha512:YE});const sh=0,tI="identity",ih=Zl,eI=o=>bo(sh,ih(o)),rI={code:sh,name:tI,encode:ih,digest:eI};var nI=Object.freeze({__proto__:null,identity:rI});new TextEncoder,new TextDecoder;const Wu={...Qb,...Zb,...Xb,...eE,...sE,...dE,...vE,..._E,...PE,...AE};({...XE,...nI});function oh(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function sI(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?oh(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function ah(o,r,n,s){return{name:o,prefix:r,encoder:{name:o,prefix:r,encode:n},decoder:{decode:s}}}const Qu=ah("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),eo=ah("ascii","a",o=>{let r="a";for(let n=0;n<o.length;n++)r+=String.fromCharCode(o[n]);return r},o=>{o=o.substring(1);const r=sI(o.length);for(let n=0;n<o.length;n++)r[n]=o.charCodeAt(n);return r}),iI={utf8:Qu,"utf-8":Qu,hex:Wu.base16,latin1:eo,ascii:eo,binary:eo,...Wu};function oI(o,r="utf8"){const n=iI[r];if(!n)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?oh(globalThis.Buffer.from(o,"utf-8")):n.decoder.decode(`${n.prefix}${o}`)}const ch="wc",aI=2,$o="core",Be=`${ch}@2:${$o}:`,cI={name:$o,logger:"error"},uI={database:":memory:"},lI="crypto",Ju="client_ed25519_seed",hI=L.ONE_DAY,pI="keychain",fI="0.3",dI="messages",gI="0.3",yI=L.SIX_HOURS,vI="publisher",uh="irn",mI="error",lh="wss://relay.walletconnect.com",Zu="wss://relay.walletconnect.org",wI="relayer",Nt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},_I="_subscription",Ae={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},bI=L.ONE_SECOND,EI="2.11.0",II=1e4,SI="0.3",PI="WALLETCONNECT_CLIENT_ID",he={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},RI="subscription",OI="0.3",NI=L.FIVE_SECONDS*1e3,CI="pairing",xI="0.3",un={wc_pairingDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:L.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L.ONE_DAY,prompt:!1,tag:0},res:{ttl:L.ONE_DAY,prompt:!1,tag:0}}},gn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},me={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},AI="history",TI="0.3",DI="expirer",ne={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},jI="0.3",ro="verify-api",Cr="https://verify.walletconnect.com",Eo="https://verify.walletconnect.org",qI=[Cr,Eo],$I="echo",UI="https://echo.walletconnect.com";class kI{constructor(r,n){this.core=r,this.logger=n,this.keychain=new Map,this.name=pI,this.version=fI,this.initialized=!1,this.storagePrefix=Be,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=q("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=r,this.logger=Lt(n,this.name)}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,Fl(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Gl(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}}class MI{constructor(r,n,s){this.core=r,this.logger=n,this.name=lI,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=bu(a);return Sw(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=w_();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),h=bu(u),y=mo();return await Pw(y,a,hI,h)},this.generateSharedKey=(a,u,h)=>{this.isInitialized();const y=this.getPrivateKey(a),I=__(y,u);return this.setSymKey(I,h)},this.setSymKey=async(a,u)=>{this.isInitialized();const h=u||b_(a);return await this.keychain.set(h,a),h},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,h)=>{this.isInitialized();const y=Kl(h),I=lo(u);if(Au(y)){const j=y.senderPublicKey,F=y.receiverPublicKey;a=await this.generateSharedKey(j,F)}const R=this.getSymKey(a),{type:O,senderPublicKey:A}=y;return I_({type:O,symKey:R,message:I,senderPublicKey:A})},this.decode=async(a,u,h)=>{this.isInitialized();const y=R_(u,h);if(Au(y)){const I=y.receiverPublicKey,R=y.senderPublicKey;a=await this.generateSharedKey(I,R)}try{const I=this.getSymKey(a),R=S_({symKey:I,encoded:u});return Ul(R)}catch(I){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(I)}},this.getPayloadType=a=>{const u=Es(a);return _n(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Es(a);return u.senderPublicKey?se(u.senderPublicKey,Tt):void 0},this.core=r,this.logger=Lt(n,this.name),this.keychain=s||new kI(this.core,this.logger)}get context(){return Wt(this.logger)}async setPrivateKey(r,n){return await this.keychain.set(r,n),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(Ju)}catch{r=mo(),await this.keychain.set(Ju,r)}return oI(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}}class LI extends o_{constructor(r,n){super(r,n),this.logger=r,this.core=n,this.messages=new Map,this.name=dI,this.version=gI,this.initialized=!1,this.storagePrefix=Be,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=Ar(a);let h=this.messages.get(s);return typeof h>"u"&&(h={}),typeof h[u]<"u"||(h[u]=a,this.messages.set(s,h),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),h=Ar(a);return typeof u[h]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Lt(r,this.name),this.core=n}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,Fl(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Gl(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}}class zI extends a_{constructor(r,n){super(r,n),this.relayer=r,this.logger=n,this.events=new _e.EventEmitter,this.name=vI,this.queue=new Map,this.publishTimeout=L.toMiliseconds(L.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const y=(u==null?void 0:u.ttl)||yI,I=wo(u),R=(u==null?void 0:u.prompt)||!1,O=(u==null?void 0:u.tag)||0,A=(u==null?void 0:u.id)||$l().toString(),j={topic:s,message:a,opts:{ttl:y,relay:I,prompt:R,tag:O,id:A}},F=setTimeout(()=>this.queue.set(A,j),this.publishTimeout);try{await await wn(this.rpcPublish(s,a,y,I,R,O,A),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(A),this.relayer.events.emit(Nt.publish,j)}catch(z){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=u==null?void 0:u.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(A),z;return}finally{clearTimeout(F)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=r,this.logger=Lt(n,this.name),this.registerEventListeners()}get context(){return Wt(this.logger)}rpcPublish(r,n,s,a,u,h,y){var I,R,O,A;const j={method:_s(a.protocol).publish,params:{topic:r,message:n,ttl:s,prompt:u,tag:h},id:y};return Mt((I=j.params)==null?void 0:I.prompt)&&((R=j.params)==null||delete R.prompt),Mt((O=j.params)==null?void 0:O.tag)&&((A=j.params)==null||delete A.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:j}),this.relayer.request(j)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:n,message:s,opts:a}=r;await this.publish(n,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Nt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Nt.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class HI{constructor(){this.map=new Map,this.set=(r,n)=>{const s=this.get(r);this.exists(r,n)||this.map.set(r,[...s,n])},this.get=r=>this.map.get(r)||[],this.exists=(r,n)=>this.get(r).includes(n),this.delete=(r,n)=>{if(typeof n>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const s=this.get(r);if(!this.exists(r,n))return;const a=s.filter(u=>u!==n);if(!a.length){this.map.delete(r);return}this.map.set(r,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var VI=Object.defineProperty,KI=Object.defineProperties,FI=Object.getOwnPropertyDescriptors,Yu=Object.getOwnPropertySymbols,GI=Object.prototype.hasOwnProperty,BI=Object.prototype.propertyIsEnumerable,Xu=(o,r,n)=>r in o?VI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,ln=(o,r)=>{for(var n in r||(r={}))GI.call(r,n)&&Xu(o,n,r[n]);if(Yu)for(var n of Yu(r))BI.call(r,n)&&Xu(o,n,r[n]);return o},no=(o,r)=>KI(o,FI(r));class WI extends l_{constructor(r,n){super(r,n),this.relayer=r,this.logger=n,this.subscriptions=new Map,this.topicMap=new HI,this.events=new _e.EventEmitter,this.name=RI,this.version=OI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Be,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=wo(a),h={topic:s,relay:u};this.pending.set(s,h);const y=await this.rpcSubscribe(s,u);return this.onSubscribe(y,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),y}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const h=new L.Watch;h.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(y),h.stop(this.pendingSubscriptionWatchLabel),a(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=NI&&(clearInterval(y),h.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Lt(n,this.name),this.clientId=""}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,n){let s=!1;try{s=this.getSubscription(r).topic===n}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,n){const s=this.topicMap.get(r);await Promise.all(s.map(async a=>await this.unsubscribeById(r,a,n)))}async unsubscribeById(r,n,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:n,opts:s}});try{const a=wo(s);await this.rpcUnsubscribe(r,n,a);const u=vt("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,n,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:n,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(r,n){const s={method:_s(n.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await wn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Nt.connection_stalled)}return Ar(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const n=r[0].relay,s={method:_s(n.protocol).batchSubscribe,params:{topics:r.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await wn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Nt.connection_stalled)}}rpcUnsubscribe(r,n,s){const a={method:_s(s.protocol).unsubscribe,params:{topic:r,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(r,n){this.setSubscription(r,no(ln({},n),{id:r})),this.pending.delete(n.topic)}onBatchSubscribe(r){r.length&&r.forEach(n=>{this.setSubscription(n.id,ln({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(r,n,s){this.events.removeAllListeners(n),this.hasSubscription(n,r)&&this.deleteSubscription(n,s),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,n){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:n}),this.addSubscription(r,n))}addSubscription(r,n){this.subscriptions.set(r,ln({},n)),this.topicMap.set(n.topic,r),this.events.emit(he.created,n)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const n=this.subscriptions.get(r);if(!n){const{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return n}deleteSubscription(r,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:n});const s=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(s.topic,r),this.events.emit(he.deleted,no(ln({},s),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(he.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(he.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:n}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const n=await this.rpcBatchSubscribe(r);cr(n)&&this.onBatchSubscribe(n.map((s,a)=>no(ln({},r[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(n=>{r.push(n)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Nt.connect,async()=>{await this.onConnect()}),this.relayer.on(Nt.disconnect,()=>{this.onDisconnect()}),this.events.on(he.created,async r=>{const n=he.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),await this.persist()}),this.events.on(he.deleted,async r=>{const n=he.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const n=setInterval(()=>{this.restartInProgress||(clearInterval(n),r())},this.pollingInterval)})}}var QI=Object.defineProperty,tl=Object.getOwnPropertySymbols,JI=Object.prototype.hasOwnProperty,ZI=Object.prototype.propertyIsEnumerable,el=(o,r,n)=>r in o?QI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,YI=(o,r)=>{for(var n in r||(r={}))JI.call(r,n)&&el(o,n,r[n]);if(tl)for(var n of tl(r))ZI.call(r,n)&&el(o,n,r[n]);return o};class XI extends c_{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new _e.EventEmitter,this.name=wI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async n=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(n)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=n=>{this.onProviderPayload(n)},this.onConnectHandler=()=>{this.events.emit(Nt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=n=>{this.logger.error(n),this.events.emit(Nt.error,n),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Ae.payload,this.onPayloadHandler),this.provider.on(Ae.connect,this.onConnectHandler),this.provider.on(Ae.disconnect,this.onDisconnectHandler),this.provider.on(Ae.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Lt(r.logger,this.name):Ps(Rs({level:r.logger||mI})),this.messages=new LI(this.logger,r.core),this.subscriber=new WI(this,this.logger),this.publisher=new zI(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||lh,this.projectId=r.projectId,this.bundleId=T_(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Zu}...`),await this.restartTransport(Zu)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},II)}get context(){return Wt(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,n,s){this.isInitialized(),await this.publisher.publish(r,n,s),await this.recordMessageEvent({topic:r,message:n,publishedAt:Date.now()})}async subscribe(r,n){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(r))==null?void 0:s[0])||"";if(a)return a;let u;const h=y=>{y.topic===r&&(this.subscriber.off(he.created,h),u())};return await Promise.all([new Promise(y=>{u=y,this.subscriber.on(he.created,h)}),new Promise(async y=>{a=await this.subscriber.subscribe(r,n),y()})]),a}async unsubscribe(r,n){this.isInitialized(),await this.subscriber.unsubscribe(r,n)}on(r,n){this.events.on(r,n)}once(r,n){this.events.once(r,n)}off(r,n){this.events.off(r,n)}removeListener(r,n){this.events.removeListener(r,n)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await wn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(n=>{if(!this.initialized)return n();this.subscriber.once(he.resubscribed,()=>{n()})}),new Promise(async(n,s)=>{try{await wn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}n()})])}catch(n){this.logger.error(n);const s=n;if(!this.isConnectionStalled(s.message))throw n;this.provider.events.emit(Ae.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Hu())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(n=>r.includes(n))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new De(new Rw(k_({sdkVersion:EI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:n,message:s}=r;await this.messages.set(n,s)}async shouldIgnoreMessageEvent(r){const{topic:n,message:s}=r;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(n))return this.logger.debug(`Ignoring message for non-subscribed topic ${n}`),!0;const a=this.messages.has(n,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),xo(r)){if(!r.method.endsWith(_I))return;const n=r.params,{topic:s,message:a,publishedAt:u}=n.data,h={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(YI({type:"event",event:n.id},h)),this.events.emit(n.id,h),await this.acknowledgePayload(r),await this.onMessageEvent(h)}else Ns(r)&&this.events.emit(Nt.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Nt.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const n=Os(r.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(Ae.payload,this.onPayloadHandler),this.provider.off(Ae.connect,this.onConnectHandler),this.provider.off(Ae.disconnect,this.onDisconnectHandler),this.provider.off(Ae.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Nt.connection_stalled,()=>{this.restartTransport().catch(n=>this.logger.error(n))});let r=await Hu();xb(async n=>{this.initialized&&r!==n&&(r=n,n?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Nt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},L.toMiliseconds(bI)))}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const n=setInterval(()=>{this.connected&&(clearInterval(n),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var t0=Object.defineProperty,rl=Object.getOwnPropertySymbols,e0=Object.prototype.hasOwnProperty,r0=Object.prototype.propertyIsEnumerable,nl=(o,r,n)=>r in o?t0(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,sl=(o,r)=>{for(var n in r||(r={}))e0.call(r,n)&&nl(o,n,r[n]);if(rl)for(var n of rl(r))r0.call(r,n)&&nl(o,n,r[n]);return o};class As extends u_{constructor(r,n,s,a=Be,u=void 0){super(r,n,s,a),this.core=r,this.logger=n,this.name=s,this.map=new Map,this.version=SI,this.cached=[],this.initialized=!1,this.storagePrefix=Be,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!Mt(h)?this.map.set(this.getKey(h),h):ab(h)?this.map.set(h.id,h):cb(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,y)=>{this.isInitialized(),this.map.has(h)?await this.update(h,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:y}),this.map.set(h,y),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(y=>Object.keys(h).every(I=>bw(y[I],h[I]))):this.values),this.update=async(h,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:y});const I=sl(sl({},this.getData(h)),y);this.map.set(h,I),await this.persist()},this.delete=async(h,y)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:y}),this.map.delete(h),await this.persist())},this.logger=Lt(n,this.name),this.storagePrefix=a,this.getKey=u}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const n=this.map.get(r);if(!n){const{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(s),new Error(s)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:n}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}}class n0{constructor(r,n){this.core=r,this.logger=n,this.name=CI,this.version=xI,this.events=new Ro,this.initialized=!1,this.storagePrefix=Be,this.ignoredPayloadTypes=[lr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=mo(),a=await this.core.crypto.setSymKey(s),u=pe(L.FIVE_MINUTES),h={protocol:uh},y={topic:a,expiry:u,relay:h,active:!1},I=Z_({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:h});return await this.pairings.set(a,y),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:I}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:h}=Uu(s.uri);let y;if(this.pairings.keys.includes(a)&&(y=this.pairings.get(a),y.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const I=pe(L.FIVE_MINUTES),R={topic:a,relay:h,expiry:I,active:!1};return await this.pairings.set(a,R),this.core.expirer.set(a,I),s.activatePairing&&await this.activate({topic:a}),this.events.emit(gn.create,R),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:h})),R},this.activate=async({topic:s})=>{this.isInitialized();const a=pe(L.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:h,resolve:y,reject:I}=Nr();this.events.once(mt("pairing_ping",u),({error:R})=>{R?I(R):y()}),await h()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",vt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const h=xr(a,u),y=await this.core.crypto.encode(s,h),I=un[a].req;return this.core.history.set(s,h),this.core.relayer.publish(s,y,I),h.id},this.sendResult=async(s,a,u)=>{const h=Os(s,u),y=await this.core.crypto.encode(a,h),I=await this.core.history.get(a,s),R=un[I.request.method].res;await this.core.relayer.publish(a,y,R),await this.core.history.resolve(h)},this.sendError=async(s,a,u)=>{const h=Co(s,u),y=await this.core.crypto.encode(a,h),I=await this.core.history.get(a,s),R=un[I.request.method]?un[I.request.method].res:un.unregistered_method.res;await this.core.relayer.publish(a,y,R),await this.core.history.resolve(h)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,vt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Ge(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,h=(await this.core.history.get(a,u.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(gn.ping,{id:u,topic:s})}catch(h){await this.sendError(u,s,h),this.logger.error(h)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{Fe(a)?this.events.emit(mt("pairing_ping",u),{}):we(a)&&this.events.emit(mt("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(gn.delete,{id:u,topic:s})}catch(h){await this.sendError(u,s,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:h}=a;try{if(this.registeredMethods.includes(h))return;const y=vt("WC_METHOD_UNSUPPORTED",h);await this.sendError(u,s,y),this.logger.error(y)}catch(y){await this.sendError(u,s,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(vt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!kt(s)){const{message:h}=q("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(h)}if(!ob(s.uri)){const{message:h}=q("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(h)}const u=Uu(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:h}=q("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(u!=null&&u.symKey)){const{message:h}=q("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async s=>{if(!kt(s)){const{message:u}=q("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!kt(s)){const{message:u}=q("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!Et(s,!1)){const{message:a}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Ge(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=q("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=r,this.logger=Lt(n,this.name),this.pairings=new As(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Wt(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Nt.message,async r=>{const{topic:n,message:s}=r;if(!this.pairings.keys.includes(n)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(n,s);try{xo(a)?(this.core.history.set(n,a),this.onRelayEventRequest({topic:n,payload:a})):Ns(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a}),this.core.history.delete(n,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(ne.expired,async r=>{const{topic:n}=Wl(r.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(gn.expire,{topic:n}))})}}class s0 extends i_{constructor(r,n){super(r,n),this.core=r,this.logger=n,this.records=new Map,this.events=new _e.EventEmitter,this.name=AI,this.version=TI,this.cached=[],this.initialized=!1,this.storagePrefix=Be,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const h={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:pe(L.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(me.created,h)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=we(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(me.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(me.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Lt(n,this.name)}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const s={topic:n.topic,request:xr(n.request.method,n.request.params,n.id),chainId:n.chainId};return r.push(s)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const n=this.records.get(r);if(!n){const{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(me.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:n}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(me.created,r=>{const n=me.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:r}),this.persist()}),this.events.on(me.updated,r=>{const n=me.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:r}),this.persist()}),this.events.on(me.deleted,r=>{const n=me.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:r}),this.persist()}),this.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{L.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}}class i0 extends h_{constructor(r,n){super(r,n),this.core=r,this.logger=n,this.expirations=new Map,this.events=new _e.EventEmitter,this.name=DI,this.version=jI,this.cached=[],this.initialized=!1,this.storagePrefix=Be,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),h={target:u,expiry:a};this.expirations.set(u,h),this.checkExpiry(u,h),this.events.emit(ne.created,{target:u,expiration:h})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(ne.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Lt(n,this.name)}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return M_(r);if(typeof r=="number")return L_(r);const{message:n}=q("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(n)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ne.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:n}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const n=this.expirations.get(r);if(!n){const{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(s),new Error(s)}return n}checkExpiry(r,n){const{expiry:s}=n;L.toMiliseconds(s)-Date.now()<=0&&this.expire(r,n)}expire(r,n){this.expirations.delete(r),this.events.emit(ne.expired,{target:r,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,n)=>this.checkExpiry(n,r))}registerEventListeners(){this.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(ne.created,r=>{const n=ne.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),this.persist()}),this.events.on(ne.expired,r=>{const n=ne.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),this.persist()}),this.events.on(ne.deleted,r=>{const n=ne.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}}}class o0 extends p_{constructor(r,n){super(r,n),this.projectId=r,this.logger=n,this.name=ro,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||jr()||!qr())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Eo;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(h){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(h),u=await this.fetchAttestation(s.attestationId,Eo)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(L.ONE_SECOND*2),h=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),h.status===200?await h.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(ro))return u();window.addEventListener("message",a);const h=document.createElement("iframe");h.id=ro,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,s=u}),new Promise((u,h)=>setTimeout(()=>{window.removeEventListener("message",a),h("verify iframe load timeout")},L.toMiliseconds(L.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||Cr;return qI.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Cr}`),a=Cr),a},this.logger=Lt(n,this.name),this.verifyUrl=Cr,this.abortController=new AbortController,this.isDevEnv=Do()&&ut.process.env.IS_VITEST}get context(){return Wt(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),L.toMiliseconds(r))}}class a0 extends f_{constructor(r,n){super(r,n),this.projectId=r,this.logger=n,this.context=$I,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:h,enableEncrypted:y=!1}=s,I=`${UI}/${this.projectId}/clients`;await $b(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:h,token:u,always_raw:y})})},this.logger=Lt(n,this.context)}}var c0=Object.defineProperty,il=Object.getOwnPropertySymbols,u0=Object.prototype.hasOwnProperty,l0=Object.prototype.propertyIsEnumerable,ol=(o,r,n)=>r in o?c0(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,al=(o,r)=>{for(var n in r||(r={}))u0.call(r,n)&&ol(o,n,r[n]);if(il)for(var n of il(r))l0.call(r,n)&&ol(o,n,r[n]);return o};class Uo extends s_{constructor(r){super(r),this.protocol=ch,this.version=aI,this.name=$o,this.events=new _e.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||lh,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const n=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ps(Rs({level:(r==null?void 0:r.logger)||cI.logger}));this.logger=Lt(n,this.name),this.heartbeat=new Dr.HeartBeat,this.crypto=new MI(this,this.logger,r==null?void 0:r.keychain),this.history=new s0(this,this.logger),this.expirer=new i0(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new Ew(al(al({},uI),r==null?void 0:r.storageOptions)),this.relayer=new XI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new n0(this,this.logger),this.verify=new o0(this.projectId||"",this.logger),this.echoClient=new a0(this.projectId||"",this.logger)}static async init(r){const n=new Uo(r);await n.initialize();const s=await n.crypto.getClientId();return await n.storage.setItem(PI,s),n}get context(){return Wt(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const h0=Uo,hh="wc",ph=2,fh="client",ko=`${hh}@${ph}:${fh}:`,so={name:fh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},cl="WALLETCONNECT_DEEPLINK_CHOICE",p0="proposal",dh="Proposal expired",f0="session",vs=L.SEVEN_DAYS,d0="engine",hn={wc_sessionPropose:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1104},res:{ttl:L.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1106},res:{ttl:L.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1112},res:{ttl:L.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1115}}},io={min:L.FIVE_MINUTES,max:L.SEVEN_DAYS},Te={idle:"IDLE",active:"ACTIVE"},g0="request",y0=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var v0=Object.defineProperty,m0=Object.defineProperties,w0=Object.getOwnPropertyDescriptors,ul=Object.getOwnPropertySymbols,_0=Object.prototype.hasOwnProperty,b0=Object.prototype.propertyIsEnumerable,ll=(o,r,n)=>r in o?v0(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,Ut=(o,r)=>{for(var n in r||(r={}))_0.call(r,n)&&ll(o,n,r[n]);if(ul)for(var n of ul(r))b0.call(r,n)&&ll(o,n,r[n]);return o},pn=(o,r)=>m0(o,w0(r));class E0 extends g_{constructor(r){super(r),this.name=d0,this.events=new Ro,this.initialized=!1,this.ignoredPayloadTypes=[lr],this.requestQueue={state:Te.idle,queue:[]},this.sessionRequestQueue={state:Te.idle,queue:[]},this.requestQueueDelay=L.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(hn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay)))},this.connect=async n=>{await this.isInitialized();const s=pn(Ut({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:h,sessionProperties:y,relays:I}=s;let R=a,O,A=!1;if(R&&(A=this.client.core.pairing.pairings.get(R).active),!R||!A){const{topic:v,uri:w}=await this.client.core.pairing.create();R=v,O=w}const j=await this.client.core.crypto.generateKeyPair(),F=Ut({requiredNamespaces:u,optionalNamespaces:h,relays:I??[{protocol:uh}],proposer:{publicKey:j,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:z,resolve:et,done:nt}=Nr(L.FIVE_MINUTES,dh);if(this.events.once(mt("session_connect"),async({error:v,session:w})=>{if(v)z(v);else if(w){w.self.publicKey=j;const _=pn(Ut({},w),{requiredNamespaces:w.requiredNamespaces,optionalNamespaces:w.optionalNamespaces});await this.client.session.set(w.topic,_),await this.setExpiry(w.topic,w.expiry),R&&await this.client.core.pairing.updateMetadata({topic:R,metadata:w.peer.metadata}),et(_)}}),!R){const{message:v}=q("NO_MATCHING_KEY",`connect() pairing topic: ${R}`);throw new Error(v)}const st=await this.sendRequest({topic:R,method:"wc_sessionPropose",params:F}),d=pe(L.FIVE_MINUTES);return await this.setProposal(st,Ut({id:st,expiry:d},F)),{uri:O,approval:nt}},this.pair=async n=>(await this.isInitialized(),await this.client.core.pairing.pair(n)),this.approve=async n=>{await this.isInitialized(),await this.isValidApprove(n);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:h}=n,y=this.client.proposal.get(s);let{pairingTopic:I,proposer:R,requiredNamespaces:O,optionalNamespaces:A}=y;I=I||"",Tr(O)||(O=eb(u,"approve()"));const j=await this.client.core.crypto.generateKeyPair(),F=R.publicKey,z=await this.client.core.crypto.generateSharedKey(j,F);I&&s&&(await this.client.core.pairing.updateMetadata({topic:I,metadata:R.metadata}),await this.sendResult({id:s,topic:I,result:{relay:{protocol:a??"irn"},responderPublicKey:j}}),await this.client.proposal.delete(s,vt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:I}));const et=Ut({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:O,optionalNamespaces:A,pairingTopic:I,controller:{publicKey:j,metadata:this.client.metadata},expiry:pe(vs)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(z),await this.sendRequest({topic:z,method:"wc_sessionSettle",params:et,throwOnFailedPublish:!0});const nt=pn(Ut({},et),{topic:z,pairingTopic:I,acknowledged:!1,self:et.controller,peer:{publicKey:R.publicKey,metadata:R.metadata},controller:j});return await this.client.session.set(z,nt),await this.setExpiry(z,pe(vs)),{topic:z,acknowledged:()=>new Promise(st=>setTimeout(()=>st(this.client.session.get(z)),500))}},this.reject=async n=>{await this.isInitialized(),await this.isValidReject(n);const{id:s,reason:a}=n,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,vt("USER_DISCONNECTED")))},this.update=async n=>{await this.isInitialized(),await this.isValidUpdate(n);const{topic:s,namespaces:a}=n,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:h,resolve:y,reject:I}=Nr();return this.events.once(mt("session_update",u),({error:R})=>{R?I(R):y()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:h}},this.extend=async n=>{await this.isInitialized(),await this.isValidExtend(n);const{topic:s}=n,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:h,reject:y}=Nr();return this.events.once(mt("session_extend",a),({error:I})=>{I?y(I):h()}),await this.setExpiry(s,pe(vs)),{acknowledged:u}},this.request=async n=>{await this.isInitialized(),await this.isValidRequest(n);const{chainId:s,request:a,topic:u,expiry:h}=n,y=Iw(),{done:I,resolve:R,reject:O}=Nr(h,"Request expired. Please try again.");return this.events.once(mt("session_request",y),({error:A,result:j})=>{A?O(A):R(j)}),await Promise.all([new Promise(async A=>{await this.sendRequest({clientRpcId:y,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:h,throwOnFailedPublish:!0}).catch(j=>O(j)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:y}),A()}),new Promise(async A=>{const j=await H_(this.client.core.storage,cl);z_({id:y,topic:u,wcDeepLink:j}),A()}),I()]).then(A=>A[2])},this.respond=async n=>{await this.isInitialized(),await this.isValidRespond(n);const{topic:s,response:a}=n,{id:u}=a;Fe(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):we(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(n)},this.ping=async n=>{await this.isInitialized(),await this.isValidPing(n);const{topic:s}=n;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:h,reject:y}=Nr();this.events.once(mt("session_ping",a),({error:I})=>{I?y(I):h()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async n=>{await this.isInitialized(),await this.isValidEmit(n);const{topic:s,event:a,chainId:u}=n;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async n=>{await this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:vt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=n=>(this.isInitialized(),this.client.session.getAll().filter(s=>sb(s,n))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async n=>{if(n.pairingTopic)try{const s=this.client.core.pairing.pairings.get(n.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var h,y;return((h=u.peerMetadata)==null?void 0:h.url)&&((y=u.peerMetadata)==null?void 0:y.url)===n.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(n,s)=>{const{self:a}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),this.client.session.delete(n,vt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),s||this.client.core.expirer.del(n),this.client.core.storage.removeItem(cl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===n&&this.deletePendingSessionRequest(u.id,vt("USER_DISCONNECTED"))})},this.deleteProposal=async(n,s)=>{await Promise.all([this.client.proposal.delete(n,vt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(n)])},this.deletePendingSessionRequest=async(n,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,s),a?Promise.resolve():this.client.core.expirer.del(n)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==n),a&&(this.sessionRequestQueue.state=Te.idle)},this.setExpiry=async(n,s)=>{this.client.session.keys.includes(n)&&await this.client.session.update(n,{expiry:s}),this.client.core.expirer.set(n,s)},this.setProposal=async(n,s)=>{await this.client.proposal.set(n,s),this.client.core.expirer.set(n,s.expiry)},this.setPendingSessionRequest=async n=>{const s=hn.wc_sessionRequest.req.ttl,{id:a,topic:u,params:h,verifyContext:y}=n;await this.client.pendingRequest.set(a,{id:a,topic:u,params:h,verifyContext:y}),s&&this.client.core.expirer.set(a,pe(s))},this.sendRequest=async n=>{const{topic:s,method:a,params:u,expiry:h,relayRpcId:y,clientRpcId:I,throwOnFailedPublish:R}=n,O=xr(a,u,I);if(qr()&&y0.includes(a)){const F=Ar(JSON.stringify(O));this.client.core.verify.register({attestationId:F})}const A=await this.client.core.crypto.encode(s,O),j=hn[a].req;return h&&(j.ttl=h),y&&(j.id=y),this.client.core.history.set(s,O),R?(j.internal=pn(Ut({},j.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,A,j)):this.client.core.relayer.publish(s,A,j).catch(F=>this.client.logger.error(F)),O.id},this.sendResult=async n=>{const{id:s,topic:a,result:u,throwOnFailedPublish:h}=n,y=Os(s,u),I=await this.client.core.crypto.encode(a,y),R=await this.client.core.history.get(a,s),O=hn[R.request.method].res;h?(O.internal=pn(Ut({},O.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,I,O)):this.client.core.relayer.publish(a,I,O).catch(A=>this.client.logger.error(A)),await this.client.core.history.resolve(y)},this.sendError=async(n,s,a)=>{const u=Co(n,a),h=await this.client.core.crypto.encode(s,u),y=await this.client.core.history.get(s,n),I=hn[y.request.method].res;this.client.core.relayer.publish(s,h,I),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const n=[],s=[];this.client.session.getAll().forEach(a=>{Ge(a.expiry)&&n.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Ge(a.expiry)&&s.push(a.id)}),await Promise.all([...n.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Te.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Te.active;const n=this.requestQueue.queue.shift();if(n)try{this.processRequest(n),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=Te.idle},this.processRequest=n=>{const{topic:s,payload:a}=n,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async n=>{const{topic:s,payload:a}=n,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=n=>{const{topic:s}=n,{message:a}=q("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(n,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(Ut({},s.params));const h=pe(L.FIVE_MINUTES),y=Ut({id:u,pairingTopic:n,expiry:h},a);await this.setProposal(u,y);const I=Ar(JSON.stringify(s)),R=await this.getVerifyContext(I,y.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:y,verifyContext:R})}catch(h){await this.sendError(u,n,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(n,s)=>{const{id:a}=s;if(Fe(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const h=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const y=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const I=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:I});const R=await this.client.core.crypto.generateSharedKey(y,I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:R});const O=await this.client.core.relayer.subscribe(R);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:O}),await this.client.core.pairing.activate({topic:n})}else we(s)&&(await this.client.proposal.delete(a,vt("USER_DISCONNECTED")),this.events.emit(mt("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(n,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:h,controller:y,expiry:I,namespaces:R,requiredNamespaces:O,optionalNamespaces:A,sessionProperties:j,pairingTopic:F}=s.params,z=Ut({topic:n,relay:h,expiry:I,namespaces:R,acknowledged:!0,pairingTopic:F,requiredNamespaces:O,optionalNamespaces:A,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},j&&{sessionProperties:j});await this.sendResult({id:s.id,topic:n,result:!0}),this.events.emit(mt("session_connect"),{session:z}),this.cleanupDuplicatePairings(z)}catch(h){await this.sendError(a,n,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(n,s)=>{const{id:a}=s;Fe(s)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(mt("session_approve",a),{})):we(s)&&(await this.client.session.delete(n,vt("USER_DISCONNECTED")),this.events.emit(mt("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(n,s)=>{const{params:a,id:u}=s;try{const h=`${n}_session_update`,y=ys.get(h);if(y&&this.isRequestOutOfSync(y,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(Ut({topic:n},a)),await this.client.session.update(n,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:n,result:!0}),this.client.events.emit("session_update",{id:u,topic:n,params:a}),ys.set(h,u)}catch(h){await this.sendError(u,n,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(n,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(n.toString().slice(0,-3)),this.onSessionUpdateResponse=(n,s)=>{const{id:a}=s;Fe(s)?this.events.emit(mt("session_update",a),{}):we(s)&&this.events.emit(mt("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(n,s)=>{const{id:a}=s;try{this.isValidExtend({topic:n}),await this.setExpiry(n,pe(vs)),await this.sendResult({id:a,topic:n,result:!0}),this.client.events.emit("session_extend",{id:a,topic:n})}catch(u){await this.sendError(a,n,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(n,s)=>{const{id:a}=s;Fe(s)?this.events.emit(mt("session_extend",a),{}):we(s)&&this.events.emit(mt("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(n,s)=>{const{id:a}=s;try{this.isValidPing({topic:n}),await this.sendResult({id:a,topic:n,result:!0}),this.client.events.emit("session_ping",{id:a,topic:n})}catch(u){await this.sendError(a,n,u),this.client.logger.error(u)}},this.onSessionPingResponse=(n,s)=>{const{id:a}=s;setTimeout(()=>{Fe(s)?this.events.emit(mt("session_ping",a),{}):we(s)&&this.events.emit(mt("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(n,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:n,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Nt.publish,async()=>{u(await this.deleteSession(n))})}),this.sendResult({id:a,topic:n,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:n})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(n,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(Ut({topic:n},u));const h=Ar(JSON.stringify(xr("wc_sessionRequest",u,a))),y=this.client.session.get(n),I=await this.getVerifyContext(h,y.peer.metadata),R={id:a,topic:n,params:u,verifyContext:I};await this.setPendingSessionRequest(R),this.addSessionRequestToSessionRequestQueue(R),this.processSessionRequestQueue()}catch(h){await this.sendError(a,n,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(n,s)=>{const{id:a}=s;Fe(s)?this.events.emit(mt("session_request",a),{result:s.result}):we(s)&&this.events.emit(mt("session_request",a),{error:s.error})},this.onSessionEventRequest=async(n,s)=>{const{id:a,params:u}=s;try{const h=`${n}_session_event_${u.event.name}`,y=ys.get(h);if(y&&this.isRequestOutOfSync(y,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Ut({topic:n},u)),this.client.events.emit("session_event",{id:a,topic:n,params:u}),ys.set(h,a)}catch(h){await this.sendError(a,n,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=n=>{this.sessionRequestQueue.queue.push(n)},this.cleanupAfterResponse=n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Te.idle,this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Te.active){this.client.logger.info("session request queue is already active.");return}const n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Te.active,this.client.events.emit("session_request",n)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=n=>{if(n.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===n.topic);s&&this.onSessionProposeRequest(n.topic,xr("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async n=>{if(!kt(n)){const{message:I}=q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(I)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:h,relays:y}=n;if(Mt(s)||await this.isValidPairingTopic(s),!yb(y)){const{message:I}=q("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(I)}!Mt(a)&&Tr(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!Mt(u)&&Tr(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),Mt(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(n,s)=>{const a=gb(n,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async n=>{if(!kt(n))throw new Error(q("MISSING_OR_INVALID",`approve() params: ${n}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:h}=n;await this.isValidProposalId(s);const y=this.client.proposal.get(s),I=bs(a,"approve()");if(I)throw new Error(I.message);const R=Lu(y.requiredNamespaces,a,"approve()");if(R)throw new Error(R.message);if(!Et(u,!0)){const{message:O}=q("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(O)}Mt(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async n=>{if(!kt(n)){const{message:u}=q("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(u)}const{id:s,reason:a}=n;if(await this.isValidProposalId(s),!mb(a)){const{message:u}=q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=n=>{if(!kt(n)){const{message:R}=q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(R)}const{relay:s,controller:a,namespaces:u,expiry:h}=n;if(!Jl(s)){const{message:R}=q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(R)}const y=ub(a,"onSessionSettleRequest()");if(y)throw new Error(y.message);const I=bs(u,"onSessionSettleRequest()");if(I)throw new Error(I.message);if(Ge(h)){const{message:R}=q("EXPIRED","onSessionSettleRequest()");throw new Error(R)}},this.isValidUpdate=async n=>{if(!kt(n)){const{message:I}=q("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(I)}const{topic:s,namespaces:a}=n;await this.isValidSessionTopic(s);const u=this.client.session.get(s),h=bs(a,"update()");if(h)throw new Error(h.message);const y=Lu(u.requiredNamespaces,a,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async n=>{if(!kt(n)){const{message:a}=q("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(a)}const{topic:s}=n;await this.isValidSessionTopic(s)},this.isValidRequest=async n=>{if(!kt(n)){const{message:I}=q("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(I)}const{topic:s,request:a,chainId:u,expiry:h}=n;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!Mu(y,u)){const{message:I}=q("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(I)}if(!wb(a)){const{message:I}=q("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(I)}if(!Eb(y,u,a.method)){const{message:I}=q("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(I)}if(h&&!Rb(h,io)){const{message:I}=q("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${io.min} and ${io.max}`);throw new Error(I)}},this.isValidRespond=async n=>{var s;if(!kt(n)){const{message:h}=q("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(h)}const{topic:a,response:u}=n;try{await this.isValidSessionTopic(a)}catch(h){throw(s=n==null?void 0:n.response)!=null&&s.id&&this.cleanupAfterResponse(n),h}if(!_b(u)){const{message:h}=q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(h)}},this.isValidPing=async n=>{if(!kt(n)){const{message:a}=q("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(a)}const{topic:s}=n;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async n=>{if(!kt(n)){const{message:y}=q("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(y)}const{topic:s,event:a,chainId:u}=n;await this.isValidSessionTopic(s);const{namespaces:h}=this.client.session.get(s);if(!Mu(h,u)){const{message:y}=q("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(y)}if(!bb(a)){const{message:y}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}if(!Ib(h,u,a.name)){const{message:y}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}},this.isValidDisconnect=async n=>{if(!kt(n)){const{message:a}=q("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(a)}const{topic:s}=n;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(n,s)=>{const a={verified:{verifyUrl:s.verifyUrl||Cr,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:n,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(n,s)=>{Object.values(n).forEach(a=>{if(!Et(a,!1)){const{message:u}=q("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:r}=q("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Nt.message,async r=>{const{topic:n,message:s}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(n,s);try{xo(a)?(this.client.core.history.set(n,a),this.onRelayEventRequest({topic:n,payload:a})):Ns(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a}),this.client.core.history.delete(n,a.id)):this.onRelayEventUnknownPayload({topic:n,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(ne.expired,async r=>{const{topic:n,id:s}=Wl(r.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,q("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession(n,!0),this.client.events.emit("session_expire",{topic:n})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(gn.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!Et(r,!1)){const{message:n}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:n}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(n)}if(Ge(this.client.core.pairing.pairings.get(r).expiry)){const{message:n}=q("EXPIRED",`pairing topic: ${r}`);throw new Error(n)}}async isValidSessionTopic(r){if(!Et(r,!1)){const{message:n}=q("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(n)}if(!this.client.session.keys.includes(r)){const{message:n}=q("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(n)}if(Ge(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:n}=q("EXPIRED",`session topic: ${r}`);throw new Error(n)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(Et(r,!1)){const{message:n}=q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(n)}else{const{message:n}=q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(n)}}async isValidProposalId(r){if(!vb(r)){const{message:n}=q("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(n)}if(!this.client.proposal.keys.includes(r)){const{message:n}=q("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(n)}if(Ge(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:n}=q("EXPIRED",`proposal id: ${r}`);throw new Error(n)}}}class I0 extends As{constructor(r,n){super(r,n,p0,ko),this.core=r,this.logger=n}}class S0 extends As{constructor(r,n){super(r,n,f0,ko),this.core=r,this.logger=n}}class P0 extends As{constructor(r,n){super(r,n,g0,ko,s=>s.id),this.core=r,this.logger=n}}let R0=class gh extends d_{constructor(r){super(r),this.protocol=hh,this.version=ph,this.name=so.name,this.events=new _e.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(r==null?void 0:r.name)||so.name,this.metadata=(r==null?void 0:r.metadata)||j_();const n=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ps(Rs({level:(r==null?void 0:r.logger)||so.logger}));this.core=(r==null?void 0:r.core)||new h0(r),this.logger=Lt(n,this.name),this.session=new S0(this.core,this.logger),this.proposal=new I0(this.core,this.logger),this.pendingRequest=new P0(this.core,this.logger),this.engine=new E0(this)}static async init(r){const n=new gh(r);return await n.initialize(),n}get context(){return Wt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};var O0=Object.defineProperty,N0=Object.defineProperties,C0=Object.getOwnPropertyDescriptors,hl=Object.getOwnPropertySymbols,x0=Object.prototype.hasOwnProperty,A0=Object.prototype.propertyIsEnumerable,pl=(o,r,n)=>r in o?O0(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,fl=(o,r)=>{for(var n in r||(r={}))x0.call(r,n)&&pl(o,n,r[n]);if(hl)for(var n of hl(r))A0.call(r,n)&&pl(o,n,r[n]);return o},dl=(o,r)=>N0(o,C0(r));const T0={Accept:"application/json","Content-Type":"application/json"},D0="POST",gl={headers:T0,method:D0},yl=10;let Qe=class{constructor(o,r=!1){if(this.url=o,this.disableProviderPing=r,this.events=new _e.EventEmitter,this.isAvailable=!1,this.registering=!1,!_u(o))throw new Error(`Provided URL is not compatible with HTTP connection: ${o}`);this.url=o,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(o,r){this.events.on(o,r)}once(o,r){this.events.once(o,r)}off(o,r){this.events.off(o,r)}removeListener(o,r){this.events.removeListener(o,r)}async open(o=this.url){await this.register(o)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(o){this.isAvailable||await this.register();try{const r=lo(o),n=await(await wu(this.url,dl(fl({},gl),{body:r}))).json();this.onPayload({data:n})}catch(r){this.onError(o.id,r)}}async register(o=this.url){if(!_u(o))throw new Error(`Provided URL is not compatible with HTTP connection: ${o}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),s(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));n()})})}this.url=o,this.registering=!0;try{if(!this.disableProviderPing){const r=lo({id:1,jsonrpc:"2.0",method:"test",params:[]});await wu(o,dl(fl({},gl),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(o){if(typeof o.data>"u")return;const r=typeof o.data=="string"?Ul(o.data):o.data;this.events.emit("payload",r)}onError(o,r){const n=this.parseError(r),s=n.message||n.toString(),a=Co(o,s);this.events.emit("payload",a)}parseError(o,r=this.url){return _w(o,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>yl&&this.events.setMaxListeners(yl)}};const vl="error",j0="wss://relay.walletconnect.com",q0="wc",$0="universal_provider",ml=`${q0}@2:${$0}:`,U0="https://rpc.walletconnect.com/v1/",je={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var fn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ut.global<"u"?ut.global:typeof self<"u"?self:{},Io={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,r){(function(){var n,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",y="Invalid `variable` option passed into `_.template`",I="__lodash_hash_undefined__",R=500,O="__lodash_placeholder__",A=1,j=2,F=4,z=1,et=2,nt=1,st=2,d=4,v=8,w=16,_=32,S=64,$=128,D=256,Y=512,Ur=30,mh="...",wh=800,_h=16,zo=1,bh=2,Eh=3,Je=1/0,qe=9007199254740991,Ih=17976931348623157e292,In=NaN,de=4294967295,Sh=de-1,Ph=de>>>1,Rh=[["ary",$],["bind",nt],["bindKey",st],["curry",v],["curryRight",w],["flip",Y],["partial",_],["partialRight",S],["rearg",D]],pr="[object Arguments]",Sn="[object Array]",Oh="[object AsyncFunction]",kr="[object Boolean]",Mr="[object Date]",Nh="[object DOMException]",Pn="[object Error]",Rn="[object Function]",Ho="[object GeneratorFunction]",ie="[object Map]",Lr="[object Number]",Ch="[object Null]",be="[object Object]",Vo="[object Promise]",xh="[object Proxy]",zr="[object RegExp]",oe="[object Set]",Hr="[object String]",On="[object Symbol]",Ah="[object Undefined]",Vr="[object WeakMap]",Th="[object WeakSet]",Kr="[object ArrayBuffer]",fr="[object DataView]",Ts="[object Float32Array]",Ds="[object Float64Array]",js="[object Int8Array]",qs="[object Int16Array]",$s="[object Int32Array]",Us="[object Uint8Array]",ks="[object Uint8ClampedArray]",Ms="[object Uint16Array]",Ls="[object Uint32Array]",Dh=/\b__p \+= '';/g,jh=/\b(__p \+=) '' \+/g,qh=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ko=/&(?:amp|lt|gt|quot|#39);/g,Fo=/[&<>"']/g,$h=RegExp(Ko.source),Uh=RegExp(Fo.source),kh=/<%-([\s\S]+?)%>/g,Mh=/<%([\s\S]+?)%>/g,Go=/<%=([\s\S]+?)%>/g,Lh=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zh=/^\w*$/,Hh=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zs=/[\\^$.*+?()[\]{}|]/g,Vh=RegExp(zs.source),Hs=/^\s+/,Kh=/\s/,Fh=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Gh=/\{\n\/\* \[wrapped with (.+)\] \*/,Bh=/,? & /,Wh=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Qh=/[()=,{}\[\]\/\s]/,Jh=/\\(\\)?/g,Zh=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Bo=/\w*$/,Yh=/^[-+]0x[0-9a-f]+$/i,Xh=/^0b[01]+$/i,tp=/^\[object .+?Constructor\]$/,ep=/^0o[0-7]+$/i,rp=/^(?:0|[1-9]\d*)$/,np=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Nn=/($^)/,sp=/['\n\r\u2028\u2029\\]/g,Cn="\\ud800-\\udfff",ip="\\u0300-\\u036f",op="\\ufe20-\\ufe2f",ap="\\u20d0-\\u20ff",Wo=ip+op+ap,Qo="\\u2700-\\u27bf",Jo="a-z\\xdf-\\xf6\\xf8-\\xff",cp="\\xac\\xb1\\xd7\\xf7",up="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",lp="\\u2000-\\u206f",hp=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Zo="A-Z\\xc0-\\xd6\\xd8-\\xde",Yo="\\ufe0e\\ufe0f",Xo=cp+up+lp+hp,Vs="['â€™]",pp="["+Cn+"]",ta="["+Xo+"]",xn="["+Wo+"]",ea="\\d+",fp="["+Qo+"]",ra="["+Jo+"]",na="[^"+Cn+Xo+ea+Qo+Jo+Zo+"]",Ks="\\ud83c[\\udffb-\\udfff]",dp="(?:"+xn+"|"+Ks+")",sa="[^"+Cn+"]",Fs="(?:\\ud83c[\\udde6-\\uddff]){2}",Gs="[\\ud800-\\udbff][\\udc00-\\udfff]",dr="["+Zo+"]",ia="\\u200d",oa="(?:"+ra+"|"+na+")",gp="(?:"+dr+"|"+na+")",aa="(?:"+Vs+"(?:d|ll|m|re|s|t|ve))?",ca="(?:"+Vs+"(?:D|LL|M|RE|S|T|VE))?",ua=dp+"?",la="["+Yo+"]?",yp="(?:"+ia+"(?:"+[sa,Fs,Gs].join("|")+")"+la+ua+")*",vp="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",mp="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ha=la+ua+yp,wp="(?:"+[fp,Fs,Gs].join("|")+")"+ha,_p="(?:"+[sa+xn+"?",xn,Fs,Gs,pp].join("|")+")",bp=RegExp(Vs,"g"),Ep=RegExp(xn,"g"),Bs=RegExp(Ks+"(?="+Ks+")|"+_p+ha,"g"),Ip=RegExp([dr+"?"+ra+"+"+aa+"(?="+[ta,dr,"$"].join("|")+")",gp+"+"+ca+"(?="+[ta,dr+oa,"$"].join("|")+")",dr+"?"+oa+"+"+aa,dr+"+"+ca,mp,vp,ea,wp].join("|"),"g"),Sp=RegExp("["+ia+Cn+Wo+Yo+"]"),Pp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Rp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Op=-1,lt={};lt[Ts]=lt[Ds]=lt[js]=lt[qs]=lt[$s]=lt[Us]=lt[ks]=lt[Ms]=lt[Ls]=!0,lt[pr]=lt[Sn]=lt[Kr]=lt[kr]=lt[fr]=lt[Mr]=lt[Pn]=lt[Rn]=lt[ie]=lt[Lr]=lt[be]=lt[zr]=lt[oe]=lt[Hr]=lt[Vr]=!1;var ct={};ct[pr]=ct[Sn]=ct[Kr]=ct[fr]=ct[kr]=ct[Mr]=ct[Ts]=ct[Ds]=ct[js]=ct[qs]=ct[$s]=ct[ie]=ct[Lr]=ct[be]=ct[zr]=ct[oe]=ct[Hr]=ct[On]=ct[Us]=ct[ks]=ct[Ms]=ct[Ls]=!0,ct[Pn]=ct[Rn]=ct[Vr]=!1;var Np={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",Ã:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ã:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",Ä:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Ä:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",Å:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Å:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"s"},Cp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},xp={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ap={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Tp=parseFloat,Dp=parseInt,pa=typeof fn=="object"&&fn&&fn.Object===Object&&fn,jp=typeof self=="object"&&self&&self.Object===Object&&self,It=pa||jp||Function("return this")(),Ws=r&&!r.nodeType&&r,Ze=Ws&&!0&&o&&!o.nodeType&&o,fa=Ze&&Ze.exports===Ws,Qs=fa&&pa.process,Qt=function(){try{var b=Ze&&Ze.require&&Ze.require("util").types;return b||Qs&&Qs.binding&&Qs.binding("util")}catch{}}(),da=Qt&&Qt.isArrayBuffer,ga=Qt&&Qt.isDate,ya=Qt&&Qt.isMap,va=Qt&&Qt.isRegExp,ma=Qt&&Qt.isSet,wa=Qt&&Qt.isTypedArray;function zt(b,N,P){switch(P.length){case 0:return b.call(N);case 1:return b.call(N,P[0]);case 2:return b.call(N,P[0],P[1]);case 3:return b.call(N,P[0],P[1],P[2])}return b.apply(N,P)}function qp(b,N,P,k){for(var G=-1,rt=b==null?0:b.length;++G<rt;){var wt=b[G];N(k,wt,P(wt),b)}return k}function Jt(b,N){for(var P=-1,k=b==null?0:b.length;++P<k&&N(b[P],P,b)!==!1;);return b}function $p(b,N){for(var P=b==null?0:b.length;P--&&N(b[P],P,b)!==!1;);return b}function _a(b,N){for(var P=-1,k=b==null?0:b.length;++P<k;)if(!N(b[P],P,b))return!1;return!0}function $e(b,N){for(var P=-1,k=b==null?0:b.length,G=0,rt=[];++P<k;){var wt=b[P];N(wt,P,b)&&(rt[G++]=wt)}return rt}function An(b,N){var P=b==null?0:b.length;return!!P&&gr(b,N,0)>-1}function Js(b,N,P){for(var k=-1,G=b==null?0:b.length;++k<G;)if(P(N,b[k]))return!0;return!1}function ht(b,N){for(var P=-1,k=b==null?0:b.length,G=Array(k);++P<k;)G[P]=N(b[P],P,b);return G}function Ue(b,N){for(var P=-1,k=N.length,G=b.length;++P<k;)b[G+P]=N[P];return b}function Zs(b,N,P,k){var G=-1,rt=b==null?0:b.length;for(k&&rt&&(P=b[++G]);++G<rt;)P=N(P,b[G],G,b);return P}function Up(b,N,P,k){var G=b==null?0:b.length;for(k&&G&&(P=b[--G]);G--;)P=N(P,b[G],G,b);return P}function Ys(b,N){for(var P=-1,k=b==null?0:b.length;++P<k;)if(N(b[P],P,b))return!0;return!1}var kp=Xs("length");function Mp(b){return b.split("")}function Lp(b){return b.match(Wh)||[]}function ba(b,N,P){var k;return P(b,function(G,rt,wt){if(N(G,rt,wt))return k=rt,!1}),k}function Tn(b,N,P,k){for(var G=b.length,rt=P+(k?1:-1);k?rt--:++rt<G;)if(N(b[rt],rt,b))return rt;return-1}function gr(b,N,P){return N===N?Yp(b,N,P):Tn(b,Ea,P)}function zp(b,N,P,k){for(var G=P-1,rt=b.length;++G<rt;)if(k(b[G],N))return G;return-1}function Ea(b){return b!==b}function Ia(b,N){var P=b==null?0:b.length;return P?ei(b,N)/P:In}function Xs(b){return function(N){return N==null?n:N[b]}}function ti(b){return function(N){return b==null?n:b[N]}}function Sa(b,N,P,k,G){return G(b,function(rt,wt,at){P=k?(k=!1,rt):N(P,rt,wt,at)}),P}function Hp(b,N){var P=b.length;for(b.sort(N);P--;)b[P]=b[P].value;return b}function ei(b,N){for(var P,k=-1,G=b.length;++k<G;){var rt=N(b[k]);rt!==n&&(P=P===n?rt:P+rt)}return P}function ri(b,N){for(var P=-1,k=Array(b);++P<b;)k[P]=N(P);return k}function Vp(b,N){return ht(N,function(P){return[P,b[P]]})}function Pa(b){return b&&b.slice(0,Ca(b)+1).replace(Hs,"")}function Ht(b){return function(N){return b(N)}}function ni(b,N){return ht(N,function(P){return b[P]})}function Fr(b,N){return b.has(N)}function Ra(b,N){for(var P=-1,k=b.length;++P<k&&gr(N,b[P],0)>-1;);return P}function Oa(b,N){for(var P=b.length;P--&&gr(N,b[P],0)>-1;);return P}function Kp(b,N){for(var P=b.length,k=0;P--;)b[P]===N&&++k;return k}var Fp=ti(Np),Gp=ti(Cp);function Bp(b){return"\\"+Ap[b]}function Wp(b,N){return b==null?n:b[N]}function yr(b){return Sp.test(b)}function Qp(b){return Pp.test(b)}function Jp(b){for(var N,P=[];!(N=b.next()).done;)P.push(N.value);return P}function si(b){var N=-1,P=Array(b.size);return b.forEach(function(k,G){P[++N]=[G,k]}),P}function Na(b,N){return function(P){return b(N(P))}}function ke(b,N){for(var P=-1,k=b.length,G=0,rt=[];++P<k;){var wt=b[P];(wt===N||wt===O)&&(b[P]=O,rt[G++]=P)}return rt}function Dn(b){var N=-1,P=Array(b.size);return b.forEach(function(k){P[++N]=k}),P}function Zp(b){var N=-1,P=Array(b.size);return b.forEach(function(k){P[++N]=[k,k]}),P}function Yp(b,N,P){for(var k=P-1,G=b.length;++k<G;)if(b[k]===N)return k;return-1}function Xp(b,N,P){for(var k=P+1;k--;)if(b[k]===N)return k;return k}function vr(b){return yr(b)?ef(b):kp(b)}function ae(b){return yr(b)?rf(b):Mp(b)}function Ca(b){for(var N=b.length;N--&&Kh.test(b.charAt(N)););return N}var tf=ti(xp);function ef(b){for(var N=Bs.lastIndex=0;Bs.test(b);)++N;return N}function rf(b){return b.match(Bs)||[]}function nf(b){return b.match(Ip)||[]}var sf=function b(N){N=N==null?It:mr.defaults(It.Object(),N,mr.pick(It,Rp));var P=N.Array,k=N.Date,G=N.Error,rt=N.Function,wt=N.Math,at=N.Object,ii=N.RegExp,of=N.String,Zt=N.TypeError,jn=P.prototype,af=rt.prototype,wr=at.prototype,qn=N["__core-js_shared__"],$n=af.toString,ot=wr.hasOwnProperty,cf=0,xa=function(){var t=/[^.]+$/.exec(qn&&qn.keys&&qn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Un=wr.toString,uf=$n.call(at),lf=It._,hf=ii("^"+$n.call(ot).replace(zs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kn=fa?N.Buffer:n,Me=N.Symbol,Mn=N.Uint8Array,Aa=kn?kn.allocUnsafe:n,Ln=Na(at.getPrototypeOf,at),Ta=at.create,Da=wr.propertyIsEnumerable,zn=jn.splice,ja=Me?Me.isConcatSpreadable:n,Gr=Me?Me.iterator:n,Ye=Me?Me.toStringTag:n,Hn=function(){try{var t=nr(at,"defineProperty");return t({},"",{}),t}catch{}}(),pf=N.clearTimeout!==It.clearTimeout&&N.clearTimeout,ff=k&&k.now!==It.Date.now&&k.now,df=N.setTimeout!==It.setTimeout&&N.setTimeout,Vn=wt.ceil,Kn=wt.floor,oi=at.getOwnPropertySymbols,gf=kn?kn.isBuffer:n,qa=N.isFinite,yf=jn.join,vf=Na(at.keys,at),_t=wt.max,Rt=wt.min,mf=k.now,wf=N.parseInt,$a=wt.random,_f=jn.reverse,ai=nr(N,"DataView"),Br=nr(N,"Map"),ci=nr(N,"Promise"),_r=nr(N,"Set"),Wr=nr(N,"WeakMap"),Qr=nr(at,"create"),Fn=Wr&&new Wr,br={},bf=sr(ai),Ef=sr(Br),If=sr(ci),Sf=sr(_r),Pf=sr(Wr),Gn=Me?Me.prototype:n,Jr=Gn?Gn.valueOf:n,Ua=Gn?Gn.toString:n;function p(t){if(dt(t)&&!B(t)&&!(t instanceof X)){if(t instanceof Yt)return t;if(ot.call(t,"__wrapped__"))return kc(t)}return new Yt(t)}var Er=function(){function t(){}return function(e){if(!ft(e))return{};if(Ta)return Ta(e);t.prototype=e;var i=new t;return t.prototype=n,i}}();function Bn(){}function Yt(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}p.templateSettings={escape:kh,evaluate:Mh,interpolate:Go,variable:"",imports:{_:p}},p.prototype=Bn.prototype,p.prototype.constructor=p,Yt.prototype=Er(Bn.prototype),Yt.prototype.constructor=Yt;function X(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=de,this.__views__=[]}function Rf(){var t=new X(this.__wrapped__);return t.__actions__=Dt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Dt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Dt(this.__views__),t}function Of(){if(this.__filtered__){var t=new X(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Nf(){var t=this.__wrapped__.value(),e=this.__dir__,i=B(t),c=e<0,l=i?t.length:0,f=Ld(0,l,this.__views__),g=f.start,m=f.end,E=m-g,C=c?m:g-1,x=this.__iteratees__,T=x.length,U=0,M=Rt(E,this.__takeCount__);if(!i||!c&&l==E&&M==E)return ac(t,this.__actions__);var V=[];t:for(;E--&&U<M;){C+=e;for(var Q=-1,K=t[C];++Q<T;){var Z=x[Q],tt=Z.iteratee,Ft=Z.type,At=tt(K);if(Ft==bh)K=At;else if(!At){if(Ft==zo)continue t;break t}}V[U++]=K}return V}X.prototype=Er(Bn.prototype),X.prototype.constructor=X;function Xe(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var c=t[e];this.set(c[0],c[1])}}function Cf(){this.__data__=Qr?Qr(null):{},this.size=0}function xf(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Af(t){var e=this.__data__;if(Qr){var i=e[t];return i===I?n:i}return ot.call(e,t)?e[t]:n}function Tf(t){var e=this.__data__;return Qr?e[t]!==n:ot.call(e,t)}function Df(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Qr&&e===n?I:e,this}Xe.prototype.clear=Cf,Xe.prototype.delete=xf,Xe.prototype.get=Af,Xe.prototype.has=Tf,Xe.prototype.set=Df;function Ee(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var c=t[e];this.set(c[0],c[1])}}function jf(){this.__data__=[],this.size=0}function qf(t){var e=this.__data__,i=Wn(e,t);if(i<0)return!1;var c=e.length-1;return i==c?e.pop():zn.call(e,i,1),--this.size,!0}function $f(t){var e=this.__data__,i=Wn(e,t);return i<0?n:e[i][1]}function Uf(t){return Wn(this.__data__,t)>-1}function kf(t,e){var i=this.__data__,c=Wn(i,t);return c<0?(++this.size,i.push([t,e])):i[c][1]=e,this}Ee.prototype.clear=jf,Ee.prototype.delete=qf,Ee.prototype.get=$f,Ee.prototype.has=Uf,Ee.prototype.set=kf;function Ie(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var c=t[e];this.set(c[0],c[1])}}function Mf(){this.size=0,this.__data__={hash:new Xe,map:new(Br||Ee),string:new Xe}}function Lf(t){var e=os(this,t).delete(t);return this.size-=e?1:0,e}function zf(t){return os(this,t).get(t)}function Hf(t){return os(this,t).has(t)}function Vf(t,e){var i=os(this,t),c=i.size;return i.set(t,e),this.size+=i.size==c?0:1,this}Ie.prototype.clear=Mf,Ie.prototype.delete=Lf,Ie.prototype.get=zf,Ie.prototype.has=Hf,Ie.prototype.set=Vf;function tr(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new Ie;++e<i;)this.add(t[e])}function Kf(t){return this.__data__.set(t,I),this}function Ff(t){return this.__data__.has(t)}tr.prototype.add=tr.prototype.push=Kf,tr.prototype.has=Ff;function ce(t){var e=this.__data__=new Ee(t);this.size=e.size}function Gf(){this.__data__=new Ee,this.size=0}function Bf(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function Wf(t){return this.__data__.get(t)}function Qf(t){return this.__data__.has(t)}function Jf(t,e){var i=this.__data__;if(i instanceof Ee){var c=i.__data__;if(!Br||c.length<a-1)return c.push([t,e]),this.size=++i.size,this;i=this.__data__=new Ie(c)}return i.set(t,e),this.size=i.size,this}ce.prototype.clear=Gf,ce.prototype.delete=Bf,ce.prototype.get=Wf,ce.prototype.has=Qf,ce.prototype.set=Jf;function ka(t,e){var i=B(t),c=!i&&ir(t),l=!i&&!c&&Ke(t),f=!i&&!c&&!l&&Rr(t),g=i||c||l||f,m=g?ri(t.length,of):[],E=m.length;for(var C in t)(e||ot.call(t,C))&&!(g&&(C=="length"||l&&(C=="offset"||C=="parent")||f&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||Oe(C,E)))&&m.push(C);return m}function Ma(t){var e=t.length;return e?t[wi(0,e-1)]:n}function Zf(t,e){return as(Dt(t),er(e,0,t.length))}function Yf(t){return as(Dt(t))}function ui(t,e,i){(i!==n&&!ue(t[e],i)||i===n&&!(e in t))&&Se(t,e,i)}function Zr(t,e,i){var c=t[e];(!(ot.call(t,e)&&ue(c,i))||i===n&&!(e in t))&&Se(t,e,i)}function Wn(t,e){for(var i=t.length;i--;)if(ue(t[i][0],e))return i;return-1}function Xf(t,e,i,c){return Le(t,function(l,f,g){e(c,l,i(l),g)}),c}function La(t,e){return t&&ye(e,bt(e),t)}function td(t,e){return t&&ye(e,qt(e),t)}function Se(t,e,i){e=="__proto__"&&Hn?Hn(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function li(t,e){for(var i=-1,c=e.length,l=P(c),f=t==null;++i<c;)l[i]=f?n:Ki(t,e[i]);return l}function er(t,e,i){return t===t&&(i!==n&&(t=t<=i?t:i),e!==n&&(t=t>=e?t:e)),t}function Xt(t,e,i,c,l,f){var g,m=e&A,E=e&j,C=e&F;if(i&&(g=l?i(t,c,l,f):i(t)),g!==n)return g;if(!ft(t))return t;var x=B(t);if(x){if(g=Hd(t),!m)return Dt(t,g)}else{var T=Ot(t),U=T==Rn||T==Ho;if(Ke(t))return lc(t,m);if(T==be||T==pr||U&&!l){if(g=E||U?{}:Cc(t),!m)return E?Ad(t,td(g,t)):xd(t,La(g,t))}else{if(!ct[T])return l?t:{};g=Vd(t,T,m)}}f||(f=new ce);var M=f.get(t);if(M)return M;f.set(t,g),su(t)?t.forEach(function(K){g.add(Xt(K,e,i,K,t,f))}):ru(t)&&t.forEach(function(K,Z){g.set(Z,Xt(K,e,i,Z,t,f))});var V=C?E?xi:Ci:E?qt:bt,Q=x?n:V(t);return Jt(Q||t,function(K,Z){Q&&(Z=K,K=t[Z]),Zr(g,Z,Xt(K,e,i,Z,t,f))}),g}function ed(t){var e=bt(t);return function(i){return za(i,t,e)}}function za(t,e,i){var c=i.length;if(t==null)return!c;for(t=at(t);c--;){var l=i[c],f=e[l],g=t[l];if(g===n&&!(l in t)||!f(g))return!1}return!0}function Ha(t,e,i){if(typeof t!="function")throw new Zt(h);return sn(function(){t.apply(n,i)},e)}function Yr(t,e,i,c){var l=-1,f=An,g=!0,m=t.length,E=[],C=e.length;if(!m)return E;i&&(e=ht(e,Ht(i))),c?(f=Js,g=!1):e.length>=a&&(f=Fr,g=!1,e=new tr(e));t:for(;++l<m;){var x=t[l],T=i==null?x:i(x);if(x=c||x!==0?x:0,g&&T===T){for(var U=C;U--;)if(e[U]===T)continue t;E.push(x)}else f(e,T,c)||E.push(x)}return E}var Le=gc(ge),Va=gc(pi,!0);function rd(t,e){var i=!0;return Le(t,function(c,l,f){return i=!!e(c,l,f),i}),i}function Qn(t,e,i){for(var c=-1,l=t.length;++c<l;){var f=t[c],g=e(f);if(g!=null&&(m===n?g===g&&!Kt(g):i(g,m)))var m=g,E=f}return E}function nd(t,e,i,c){var l=t.length;for(i=W(i),i<0&&(i=-i>l?0:l+i),c=c===n||c>l?l:W(c),c<0&&(c+=l),c=i>c?0:ou(c);i<c;)t[i++]=e;return t}function Ka(t,e){var i=[];return Le(t,function(c,l,f){e(c,l,f)&&i.push(c)}),i}function St(t,e,i,c,l){var f=-1,g=t.length;for(i||(i=Fd),l||(l=[]);++f<g;){var m=t[f];e>0&&i(m)?e>1?St(m,e-1,i,c,l):Ue(l,m):c||(l[l.length]=m)}return l}var hi=yc(),Fa=yc(!0);function ge(t,e){return t&&hi(t,e,bt)}function pi(t,e){return t&&Fa(t,e,bt)}function Jn(t,e){return $e(e,function(i){return Ne(t[i])})}function rr(t,e){e=He(e,t);for(var i=0,c=e.length;t!=null&&i<c;)t=t[ve(e[i++])];return i&&i==c?t:n}function Ga(t,e,i){var c=e(t);return B(t)?c:Ue(c,i(t))}function Ct(t){return t==null?t===n?Ah:Ch:Ye&&Ye in at(t)?Md(t):Yd(t)}function fi(t,e){return t>e}function sd(t,e){return t!=null&&ot.call(t,e)}function id(t,e){return t!=null&&e in at(t)}function od(t,e,i){return t>=Rt(e,i)&&t<_t(e,i)}function di(t,e,i){for(var c=i?Js:An,l=t[0].length,f=t.length,g=f,m=P(f),E=1/0,C=[];g--;){var x=t[g];g&&e&&(x=ht(x,Ht(e))),E=Rt(x.length,E),m[g]=!i&&(e||l>=120&&x.length>=120)?new tr(g&&x):n}x=t[0];var T=-1,U=m[0];t:for(;++T<l&&C.length<E;){var M=x[T],V=e?e(M):M;if(M=i||M!==0?M:0,!(U?Fr(U,V):c(C,V,i))){for(g=f;--g;){var Q=m[g];if(!(Q?Fr(Q,V):c(t[g],V,i)))continue t}U&&U.push(V),C.push(M)}}return C}function ad(t,e,i,c){return ge(t,function(l,f,g){e(c,i(l),f,g)}),c}function Xr(t,e,i){e=He(e,t),t=Dc(t,e);var c=t==null?t:t[ve(ee(e))];return c==null?n:zt(c,t,i)}function Ba(t){return dt(t)&&Ct(t)==pr}function cd(t){return dt(t)&&Ct(t)==Kr}function ud(t){return dt(t)&&Ct(t)==Mr}function tn(t,e,i,c,l){return t===e?!0:t==null||e==null||!dt(t)&&!dt(e)?t!==t&&e!==e:ld(t,e,i,c,tn,l)}function ld(t,e,i,c,l,f){var g=B(t),m=B(e),E=g?Sn:Ot(t),C=m?Sn:Ot(e);E=E==pr?be:E,C=C==pr?be:C;var x=E==be,T=C==be,U=E==C;if(U&&Ke(t)){if(!Ke(e))return!1;g=!0,x=!1}if(U&&!x)return f||(f=new ce),g||Rr(t)?Rc(t,e,i,c,l,f):Ud(t,e,E,i,c,l,f);if(!(i&z)){var M=x&&ot.call(t,"__wrapped__"),V=T&&ot.call(e,"__wrapped__");if(M||V){var Q=M?t.value():t,K=V?e.value():e;return f||(f=new ce),l(Q,K,i,c,f)}}return U?(f||(f=new ce),kd(t,e,i,c,l,f)):!1}function hd(t){return dt(t)&&Ot(t)==ie}function gi(t,e,i,c){var l=i.length,f=l,g=!c;if(t==null)return!f;for(t=at(t);l--;){var m=i[l];if(g&&m[2]?m[1]!==t[m[0]]:!(m[0]in t))return!1}for(;++l<f;){m=i[l];var E=m[0],C=t[E],x=m[1];if(g&&m[2]){if(C===n&&!(E in t))return!1}else{var T=new ce;if(c)var U=c(C,x,E,t,e,T);if(!(U===n?tn(x,C,z|et,c,T):U))return!1}}return!0}function Wa(t){if(!ft(t)||Bd(t))return!1;var e=Ne(t)?hf:tp;return e.test(sr(t))}function pd(t){return dt(t)&&Ct(t)==zr}function fd(t){return dt(t)&&Ot(t)==oe}function dd(t){return dt(t)&&fs(t.length)&&!!lt[Ct(t)]}function Qa(t){return typeof t=="function"?t:t==null?$t:typeof t=="object"?B(t)?Ya(t[0],t[1]):Za(t):vu(t)}function yi(t){if(!nn(t))return vf(t);var e=[];for(var i in at(t))ot.call(t,i)&&i!="constructor"&&e.push(i);return e}function gd(t){if(!ft(t))return Zd(t);var e=nn(t),i=[];for(var c in t)c=="constructor"&&(e||!ot.call(t,c))||i.push(c);return i}function vi(t,e){return t<e}function Ja(t,e){var i=-1,c=jt(t)?P(t.length):[];return Le(t,function(l,f,g){c[++i]=e(l,f,g)}),c}function Za(t){var e=Ti(t);return e.length==1&&e[0][2]?Ac(e[0][0],e[0][1]):function(i){return i===t||gi(i,t,e)}}function Ya(t,e){return ji(t)&&xc(e)?Ac(ve(t),e):function(i){var c=Ki(i,t);return c===n&&c===e?Fi(i,t):tn(e,c,z|et)}}function Zn(t,e,i,c,l){t!==e&&hi(e,function(f,g){if(l||(l=new ce),ft(f))yd(t,e,g,i,Zn,c,l);else{var m=c?c($i(t,g),f,g+"",t,e,l):n;m===n&&(m=f),ui(t,g,m)}},qt)}function yd(t,e,i,c,l,f,g){var m=$i(t,i),E=$i(e,i),C=g.get(E);if(C){ui(t,i,C);return}var x=f?f(m,E,i+"",t,e,g):n,T=x===n;if(T){var U=B(E),M=!U&&Ke(E),V=!U&&!M&&Rr(E);x=E,U||M||V?B(m)?x=m:gt(m)?x=Dt(m):M?(T=!1,x=lc(E,!0)):V?(T=!1,x=hc(E,!0)):x=[]:on(E)||ir(E)?(x=m,ir(m)?x=au(m):(!ft(m)||Ne(m))&&(x=Cc(E))):T=!1}T&&(g.set(E,x),l(x,E,c,f,g),g.delete(E)),ui(t,i,x)}function Xa(t,e){var i=t.length;if(i)return e+=e<0?i:0,Oe(e,i)?t[e]:n}function tc(t,e,i){e.length?e=ht(e,function(f){return B(f)?function(g){return rr(g,f.length===1?f[0]:f)}:f}):e=[$t];var c=-1;e=ht(e,Ht(H()));var l=Ja(t,function(f,g,m){var E=ht(e,function(C){return C(f)});return{criteria:E,index:++c,value:f}});return Hp(l,function(f,g){return Cd(f,g,i)})}function vd(t,e){return ec(t,e,function(i,c){return Fi(t,c)})}function ec(t,e,i){for(var c=-1,l=e.length,f={};++c<l;){var g=e[c],m=rr(t,g);i(m,g)&&en(f,He(g,t),m)}return f}function md(t){return function(e){return rr(e,t)}}function mi(t,e,i,c){var l=c?zp:gr,f=-1,g=e.length,m=t;for(t===e&&(e=Dt(e)),i&&(m=ht(t,Ht(i)));++f<g;)for(var E=0,C=e[f],x=i?i(C):C;(E=l(m,x,E,c))>-1;)m!==t&&zn.call(m,E,1),zn.call(t,E,1);return t}function rc(t,e){for(var i=t?e.length:0,c=i-1;i--;){var l=e[i];if(i==c||l!==f){var f=l;Oe(l)?zn.call(t,l,1):Ei(t,l)}}return t}function wi(t,e){return t+Kn($a()*(e-t+1))}function wd(t,e,i,c){for(var l=-1,f=_t(Vn((e-t)/(i||1)),0),g=P(f);f--;)g[c?f:++l]=t,t+=i;return g}function _i(t,e){var i="";if(!t||e<1||e>qe)return i;do e%2&&(i+=t),e=Kn(e/2),e&&(t+=t);while(e);return i}function J(t,e){return Ui(Tc(t,e,$t),t+"")}function _d(t){return Ma(Or(t))}function bd(t,e){var i=Or(t);return as(i,er(e,0,i.length))}function en(t,e,i,c){if(!ft(t))return t;e=He(e,t);for(var l=-1,f=e.length,g=f-1,m=t;m!=null&&++l<f;){var E=ve(e[l]),C=i;if(E==="__proto__"||E==="constructor"||E==="prototype")return t;if(l!=g){var x=m[E];C=c?c(x,E,m):n,C===n&&(C=ft(x)?x:Oe(e[l+1])?[]:{})}Zr(m,E,C),m=m[E]}return t}var nc=Fn?function(t,e){return Fn.set(t,e),t}:$t,Ed=Hn?function(t,e){return Hn(t,"toString",{configurable:!0,enumerable:!1,value:Bi(e),writable:!0})}:$t;function Id(t){return as(Or(t))}function te(t,e,i){var c=-1,l=t.length;e<0&&(e=-e>l?0:l+e),i=i>l?l:i,i<0&&(i+=l),l=e>i?0:i-e>>>0,e>>>=0;for(var f=P(l);++c<l;)f[c]=t[c+e];return f}function Sd(t,e){var i;return Le(t,function(c,l,f){return i=e(c,l,f),!i}),!!i}function Yn(t,e,i){var c=0,l=t==null?c:t.length;if(typeof e=="number"&&e===e&&l<=Ph){for(;c<l;){var f=c+l>>>1,g=t[f];g!==null&&!Kt(g)&&(i?g<=e:g<e)?c=f+1:l=f}return l}return bi(t,e,$t,i)}function bi(t,e,i,c){var l=0,f=t==null?0:t.length;if(f===0)return 0;e=i(e);for(var g=e!==e,m=e===null,E=Kt(e),C=e===n;l<f;){var x=Kn((l+f)/2),T=i(t[x]),U=T!==n,M=T===null,V=T===T,Q=Kt(T);if(g)var K=c||V;else C?K=V&&(c||U):m?K=V&&U&&(c||!M):E?K=V&&U&&!M&&(c||!Q):M||Q?K=!1:K=c?T<=e:T<e;K?l=x+1:f=x}return Rt(f,Sh)}function sc(t,e){for(var i=-1,c=t.length,l=0,f=[];++i<c;){var g=t[i],m=e?e(g):g;if(!i||!ue(m,E)){var E=m;f[l++]=g===0?0:g}}return f}function ic(t){return typeof t=="number"?t:Kt(t)?In:+t}function Vt(t){if(typeof t=="string")return t;if(B(t))return ht(t,Vt)+"";if(Kt(t))return Ua?Ua.call(t):"";var e=t+"";return e=="0"&&1/t==-Je?"-0":e}function ze(t,e,i){var c=-1,l=An,f=t.length,g=!0,m=[],E=m;if(i)g=!1,l=Js;else if(f>=a){var C=e?null:qd(t);if(C)return Dn(C);g=!1,l=Fr,E=new tr}else E=e?[]:m;t:for(;++c<f;){var x=t[c],T=e?e(x):x;if(x=i||x!==0?x:0,g&&T===T){for(var U=E.length;U--;)if(E[U]===T)continue t;e&&E.push(T),m.push(x)}else l(E,T,i)||(E!==m&&E.push(T),m.push(x))}return m}function Ei(t,e){return e=He(e,t),t=Dc(t,e),t==null||delete t[ve(ee(e))]}function oc(t,e,i,c){return en(t,e,i(rr(t,e)),c)}function Xn(t,e,i,c){for(var l=t.length,f=c?l:-1;(c?f--:++f<l)&&e(t[f],f,t););return i?te(t,c?0:f,c?f+1:l):te(t,c?f+1:0,c?l:f)}function ac(t,e){var i=t;return i instanceof X&&(i=i.value()),Zs(e,function(c,l){return l.func.apply(l.thisArg,Ue([c],l.args))},i)}function Ii(t,e,i){var c=t.length;if(c<2)return c?ze(t[0]):[];for(var l=-1,f=P(c);++l<c;)for(var g=t[l],m=-1;++m<c;)m!=l&&(f[l]=Yr(f[l]||g,t[m],e,i));return ze(St(f,1),e,i)}function cc(t,e,i){for(var c=-1,l=t.length,f=e.length,g={};++c<l;){var m=c<f?e[c]:n;i(g,t[c],m)}return g}function Si(t){return gt(t)?t:[]}function Pi(t){return typeof t=="function"?t:$t}function He(t,e){return B(t)?t:ji(t,e)?[t]:Uc(it(t))}var Pd=J;function Ve(t,e,i){var c=t.length;return i=i===n?c:i,!e&&i>=c?t:te(t,e,i)}var uc=pf||function(t){return It.clearTimeout(t)};function lc(t,e){if(e)return t.slice();var i=t.length,c=Aa?Aa(i):new t.constructor(i);return t.copy(c),c}function Ri(t){var e=new t.constructor(t.byteLength);return new Mn(e).set(new Mn(t)),e}function Rd(t,e){var i=e?Ri(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}function Od(t){var e=new t.constructor(t.source,Bo.exec(t));return e.lastIndex=t.lastIndex,e}function Nd(t){return Jr?at(Jr.call(t)):{}}function hc(t,e){var i=e?Ri(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function pc(t,e){if(t!==e){var i=t!==n,c=t===null,l=t===t,f=Kt(t),g=e!==n,m=e===null,E=e===e,C=Kt(e);if(!m&&!C&&!f&&t>e||f&&g&&E&&!m&&!C||c&&g&&E||!i&&E||!l)return 1;if(!c&&!f&&!C&&t<e||C&&i&&l&&!c&&!f||m&&i&&l||!g&&l||!E)return-1}return 0}function Cd(t,e,i){for(var c=-1,l=t.criteria,f=e.criteria,g=l.length,m=i.length;++c<g;){var E=pc(l[c],f[c]);if(E){if(c>=m)return E;var C=i[c];return E*(C=="desc"?-1:1)}}return t.index-e.index}function fc(t,e,i,c){for(var l=-1,f=t.length,g=i.length,m=-1,E=e.length,C=_t(f-g,0),x=P(E+C),T=!c;++m<E;)x[m]=e[m];for(;++l<g;)(T||l<f)&&(x[i[l]]=t[l]);for(;C--;)x[m++]=t[l++];return x}function dc(t,e,i,c){for(var l=-1,f=t.length,g=-1,m=i.length,E=-1,C=e.length,x=_t(f-m,0),T=P(x+C),U=!c;++l<x;)T[l]=t[l];for(var M=l;++E<C;)T[M+E]=e[E];for(;++g<m;)(U||l<f)&&(T[M+i[g]]=t[l++]);return T}function Dt(t,e){var i=-1,c=t.length;for(e||(e=P(c));++i<c;)e[i]=t[i];return e}function ye(t,e,i,c){var l=!i;i||(i={});for(var f=-1,g=e.length;++f<g;){var m=e[f],E=c?c(i[m],t[m],m,i,t):n;E===n&&(E=t[m]),l?Se(i,m,E):Zr(i,m,E)}return i}function xd(t,e){return ye(t,Di(t),e)}function Ad(t,e){return ye(t,Oc(t),e)}function ts(t,e){return function(i,c){var l=B(i)?qp:Xf,f=e?e():{};return l(i,t,H(c,2),f)}}function Ir(t){return J(function(e,i){var c=-1,l=i.length,f=l>1?i[l-1]:n,g=l>2?i[2]:n;for(f=t.length>3&&typeof f=="function"?(l--,f):n,g&&xt(i[0],i[1],g)&&(f=l<3?n:f,l=1),e=at(e);++c<l;){var m=i[c];m&&t(e,m,c,f)}return e})}function gc(t,e){return function(i,c){if(i==null)return i;if(!jt(i))return t(i,c);for(var l=i.length,f=e?l:-1,g=at(i);(e?f--:++f<l)&&c(g[f],f,g)!==!1;);return i}}function yc(t){return function(e,i,c){for(var l=-1,f=at(e),g=c(e),m=g.length;m--;){var E=g[t?m:++l];if(i(f[E],E,f)===!1)break}return e}}function Td(t,e,i){var c=e&nt,l=rn(t);function f(){var g=this&&this!==It&&this instanceof f?l:t;return g.apply(c?i:this,arguments)}return f}function vc(t){return function(e){e=it(e);var i=yr(e)?ae(e):n,c=i?i[0]:e.charAt(0),l=i?Ve(i,1).join(""):e.slice(1);return c[t]()+l}}function Sr(t){return function(e){return Zs(gu(du(e).replace(bp,"")),t,"")}}function rn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=Er(t.prototype),c=t.apply(i,e);return ft(c)?c:i}}function Dd(t,e,i){var c=rn(t);function l(){for(var f=arguments.length,g=P(f),m=f,E=Pr(l);m--;)g[m]=arguments[m];var C=f<3&&g[0]!==E&&g[f-1]!==E?[]:ke(g,E);if(f-=C.length,f<i)return Ec(t,e,es,l.placeholder,n,g,C,n,n,i-f);var x=this&&this!==It&&this instanceof l?c:t;return zt(x,this,g)}return l}function mc(t){return function(e,i,c){var l=at(e);if(!jt(e)){var f=H(i,3);e=bt(e),i=function(m){return f(l[m],m,l)}}var g=t(e,i,c);return g>-1?l[f?e[g]:g]:n}}function wc(t){return Re(function(e){var i=e.length,c=i,l=Yt.prototype.thru;for(t&&e.reverse();c--;){var f=e[c];if(typeof f!="function")throw new Zt(h);if(l&&!g&&is(f)=="wrapper")var g=new Yt([],!0)}for(c=g?c:i;++c<i;){f=e[c];var m=is(f),E=m=="wrapper"?Ai(f):n;E&&qi(E[0])&&E[1]==($|v|_|D)&&!E[4].length&&E[9]==1?g=g[is(E[0])].apply(g,E[3]):g=f.length==1&&qi(f)?g[m]():g.thru(f)}return function(){var C=arguments,x=C[0];if(g&&C.length==1&&B(x))return g.plant(x).value();for(var T=0,U=i?e[T].apply(this,C):x;++T<i;)U=e[T].call(this,U);return U}})}function es(t,e,i,c,l,f,g,m,E,C){var x=e&$,T=e&nt,U=e&st,M=e&(v|w),V=e&Y,Q=U?n:rn(t);function K(){for(var Z=arguments.length,tt=P(Z),Ft=Z;Ft--;)tt[Ft]=arguments[Ft];if(M)var At=Pr(K),Gt=Kp(tt,At);if(c&&(tt=fc(tt,c,l,M)),f&&(tt=dc(tt,f,g,M)),Z-=Gt,M&&Z<C){var yt=ke(tt,At);return Ec(t,e,es,K.placeholder,i,tt,yt,m,E,C-Z)}var le=T?i:this,xe=U?le[t]:t;return Z=tt.length,m?tt=Xd(tt,m):V&&Z>1&&tt.reverse(),x&&E<Z&&(tt.length=E),this&&this!==It&&this instanceof K&&(xe=Q||rn(xe)),xe.apply(le,tt)}return K}function _c(t,e){return function(i,c){return ad(i,t,e(c),{})}}function rs(t,e){return function(i,c){var l;if(i===n&&c===n)return e;if(i!==n&&(l=i),c!==n){if(l===n)return c;typeof i=="string"||typeof c=="string"?(i=Vt(i),c=Vt(c)):(i=ic(i),c=ic(c)),l=t(i,c)}return l}}function Oi(t){return Re(function(e){return e=ht(e,Ht(H())),J(function(i){var c=this;return t(e,function(l){return zt(l,c,i)})})})}function ns(t,e){e=e===n?" ":Vt(e);var i=e.length;if(i<2)return i?_i(e,t):e;var c=_i(e,Vn(t/vr(e)));return yr(e)?Ve(ae(c),0,t).join(""):c.slice(0,t)}function jd(t,e,i,c){var l=e&nt,f=rn(t);function g(){for(var m=-1,E=arguments.length,C=-1,x=c.length,T=P(x+E),U=this&&this!==It&&this instanceof g?f:t;++C<x;)T[C]=c[C];for(;E--;)T[C++]=arguments[++m];return zt(U,l?i:this,T)}return g}function bc(t){return function(e,i,c){return c&&typeof c!="number"&&xt(e,i,c)&&(i=c=n),e=Ce(e),i===n?(i=e,e=0):i=Ce(i),c=c===n?e<i?1:-1:Ce(c),wd(e,i,c,t)}}function ss(t){return function(e,i){return typeof e=="string"&&typeof i=="string"||(e=re(e),i=re(i)),t(e,i)}}function Ec(t,e,i,c,l,f,g,m,E,C){var x=e&v,T=x?g:n,U=x?n:g,M=x?f:n,V=x?n:f;e|=x?_:S,e&=~(x?S:_),e&d||(e&=~(nt|st));var Q=[t,e,l,M,T,V,U,m,E,C],K=i.apply(n,Q);return qi(t)&&jc(K,Q),K.placeholder=c,qc(K,t,e)}function Ni(t){var e=wt[t];return function(i,c){if(i=re(i),c=c==null?0:Rt(W(c),292),c&&qa(i)){var l=(it(i)+"e").split("e"),f=e(l[0]+"e"+(+l[1]+c));return l=(it(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return e(i)}}var qd=_r&&1/Dn(new _r([,-0]))[1]==Je?function(t){return new _r(t)}:Ji;function Ic(t){return function(e){var i=Ot(e);return i==ie?si(e):i==oe?Zp(e):Vp(e,t(e))}}function Pe(t,e,i,c,l,f,g,m){var E=e&st;if(!E&&typeof t!="function")throw new Zt(h);var C=c?c.length:0;if(C||(e&=~(_|S),c=l=n),g=g===n?g:_t(W(g),0),m=m===n?m:W(m),C-=l?l.length:0,e&S){var x=c,T=l;c=l=n}var U=E?n:Ai(t),M=[t,e,i,c,l,x,T,f,g,m];if(U&&Jd(M,U),t=M[0],e=M[1],i=M[2],c=M[3],l=M[4],m=M[9]=M[9]===n?E?0:t.length:_t(M[9]-C,0),!m&&e&(v|w)&&(e&=~(v|w)),!e||e==nt)var V=Td(t,e,i);else e==v||e==w?V=Dd(t,e,m):(e==_||e==(nt|_))&&!l.length?V=jd(t,e,i,c):V=es.apply(n,M);var Q=U?nc:jc;return qc(Q(V,M),t,e)}function Sc(t,e,i,c){return t===n||ue(t,wr[i])&&!ot.call(c,i)?e:t}function Pc(t,e,i,c,l,f){return ft(t)&&ft(e)&&(f.set(e,t),Zn(t,e,n,Pc,f),f.delete(e)),t}function $d(t){return on(t)?n:t}function Rc(t,e,i,c,l,f){var g=i&z,m=t.length,E=e.length;if(m!=E&&!(g&&E>m))return!1;var C=f.get(t),x=f.get(e);if(C&&x)return C==e&&x==t;var T=-1,U=!0,M=i&et?new tr:n;for(f.set(t,e),f.set(e,t);++T<m;){var V=t[T],Q=e[T];if(c)var K=g?c(Q,V,T,e,t,f):c(V,Q,T,t,e,f);if(K!==n){if(K)continue;U=!1;break}if(M){if(!Ys(e,function(Z,tt){if(!Fr(M,tt)&&(V===Z||l(V,Z,i,c,f)))return M.push(tt)})){U=!1;break}}else if(!(V===Q||l(V,Q,i,c,f))){U=!1;break}}return f.delete(t),f.delete(e),U}function Ud(t,e,i,c,l,f,g){switch(i){case fr:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Kr:return!(t.byteLength!=e.byteLength||!f(new Mn(t),new Mn(e)));case kr:case Mr:case Lr:return ue(+t,+e);case Pn:return t.name==e.name&&t.message==e.message;case zr:case Hr:return t==e+"";case ie:var m=si;case oe:var E=c&z;if(m||(m=Dn),t.size!=e.size&&!E)return!1;var C=g.get(t);if(C)return C==e;c|=et,g.set(t,e);var x=Rc(m(t),m(e),c,l,f,g);return g.delete(t),x;case On:if(Jr)return Jr.call(t)==Jr.call(e)}return!1}function kd(t,e,i,c,l,f){var g=i&z,m=Ci(t),E=m.length,C=Ci(e),x=C.length;if(E!=x&&!g)return!1;for(var T=E;T--;){var U=m[T];if(!(g?U in e:ot.call(e,U)))return!1}var M=f.get(t),V=f.get(e);if(M&&V)return M==e&&V==t;var Q=!0;f.set(t,e),f.set(e,t);for(var K=g;++T<E;){U=m[T];var Z=t[U],tt=e[U];if(c)var Ft=g?c(tt,Z,U,e,t,f):c(Z,tt,U,t,e,f);if(!(Ft===n?Z===tt||l(Z,tt,i,c,f):Ft)){Q=!1;break}K||(K=U=="constructor")}if(Q&&!K){var At=t.constructor,Gt=e.constructor;At!=Gt&&"constructor"in t&&"constructor"in e&&!(typeof At=="function"&&At instanceof At&&typeof Gt=="function"&&Gt instanceof Gt)&&(Q=!1)}return f.delete(t),f.delete(e),Q}function Re(t){return Ui(Tc(t,n,zc),t+"")}function Ci(t){return Ga(t,bt,Di)}function xi(t){return Ga(t,qt,Oc)}var Ai=Fn?function(t){return Fn.get(t)}:Ji;function is(t){for(var e=t.name+"",i=br[e],c=ot.call(br,e)?i.length:0;c--;){var l=i[c],f=l.func;if(f==null||f==t)return l.name}return e}function Pr(t){var e=ot.call(p,"placeholder")?p:t;return e.placeholder}function H(){var t=p.iteratee||Wi;return t=t===Wi?Qa:t,arguments.length?t(arguments[0],arguments[1]):t}function os(t,e){var i=t.__data__;return Gd(e)?i[typeof e=="string"?"string":"hash"]:i.map}function Ti(t){for(var e=bt(t),i=e.length;i--;){var c=e[i],l=t[c];e[i]=[c,l,xc(l)]}return e}function nr(t,e){var i=Wp(t,e);return Wa(i)?i:n}function Md(t){var e=ot.call(t,Ye),i=t[Ye];try{t[Ye]=n;var c=!0}catch{}var l=Un.call(t);return c&&(e?t[Ye]=i:delete t[Ye]),l}var Di=oi?function(t){return t==null?[]:(t=at(t),$e(oi(t),function(e){return Da.call(t,e)}))}:Zi,Oc=oi?function(t){for(var e=[];t;)Ue(e,Di(t)),t=Ln(t);return e}:Zi,Ot=Ct;(ai&&Ot(new ai(new ArrayBuffer(1)))!=fr||Br&&Ot(new Br)!=ie||ci&&Ot(ci.resolve())!=Vo||_r&&Ot(new _r)!=oe||Wr&&Ot(new Wr)!=Vr)&&(Ot=function(t){var e=Ct(t),i=e==be?t.constructor:n,c=i?sr(i):"";if(c)switch(c){case bf:return fr;case Ef:return ie;case If:return Vo;case Sf:return oe;case Pf:return Vr}return e});function Ld(t,e,i){for(var c=-1,l=i.length;++c<l;){var f=i[c],g=f.size;switch(f.type){case"drop":t+=g;break;case"dropRight":e-=g;break;case"take":e=Rt(e,t+g);break;case"takeRight":t=_t(t,e-g);break}}return{start:t,end:e}}function zd(t){var e=t.match(Gh);return e?e[1].split(Bh):[]}function Nc(t,e,i){e=He(e,t);for(var c=-1,l=e.length,f=!1;++c<l;){var g=ve(e[c]);if(!(f=t!=null&&i(t,g)))break;t=t[g]}return f||++c!=l?f:(l=t==null?0:t.length,!!l&&fs(l)&&Oe(g,l)&&(B(t)||ir(t)))}function Hd(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&ot.call(t,"index")&&(i.index=t.index,i.input=t.input),i}function Cc(t){return typeof t.constructor=="function"&&!nn(t)?Er(Ln(t)):{}}function Vd(t,e,i){var c=t.constructor;switch(e){case Kr:return Ri(t);case kr:case Mr:return new c(+t);case fr:return Rd(t,i);case Ts:case Ds:case js:case qs:case $s:case Us:case ks:case Ms:case Ls:return hc(t,i);case ie:return new c;case Lr:case Hr:return new c(t);case zr:return Od(t);case oe:return new c;case On:return Nd(t)}}function Kd(t,e){var i=e.length;if(!i)return t;var c=i-1;return e[c]=(i>1?"& ":"")+e[c],e=e.join(i>2?", ":" "),t.replace(Fh,`{
/* [wrapped with `+e+`] */
`)}function Fd(t){return B(t)||ir(t)||!!(ja&&t&&t[ja])}function Oe(t,e){var i=typeof t;return e=e??qe,!!e&&(i=="number"||i!="symbol"&&rp.test(t))&&t>-1&&t%1==0&&t<e}function xt(t,e,i){if(!ft(i))return!1;var c=typeof e;return(c=="number"?jt(i)&&Oe(e,i.length):c=="string"&&e in i)?ue(i[e],t):!1}function ji(t,e){if(B(t))return!1;var i=typeof t;return i=="number"||i=="symbol"||i=="boolean"||t==null||Kt(t)?!0:zh.test(t)||!Lh.test(t)||e!=null&&t in at(e)}function Gd(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function qi(t){var e=is(t),i=p[e];if(typeof i!="function"||!(e in X.prototype))return!1;if(t===i)return!0;var c=Ai(i);return!!c&&t===c[0]}function Bd(t){return!!xa&&xa in t}var Wd=qn?Ne:Yi;function nn(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||wr;return t===i}function xc(t){return t===t&&!ft(t)}function Ac(t,e){return function(i){return i==null?!1:i[t]===e&&(e!==n||t in at(i))}}function Qd(t){var e=hs(t,function(c){return i.size===R&&i.clear(),c}),i=e.cache;return e}function Jd(t,e){var i=t[1],c=e[1],l=i|c,f=l<(nt|st|$),g=c==$&&i==v||c==$&&i==D&&t[7].length<=e[8]||c==($|D)&&e[7].length<=e[8]&&i==v;if(!(f||g))return t;c&nt&&(t[2]=e[2],l|=i&nt?0:d);var m=e[3];if(m){var E=t[3];t[3]=E?fc(E,m,e[4]):m,t[4]=E?ke(t[3],O):e[4]}return m=e[5],m&&(E=t[5],t[5]=E?dc(E,m,e[6]):m,t[6]=E?ke(t[5],O):e[6]),m=e[7],m&&(t[7]=m),c&$&&(t[8]=t[8]==null?e[8]:Rt(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=l,t}function Zd(t){var e=[];if(t!=null)for(var i in at(t))e.push(i);return e}function Yd(t){return Un.call(t)}function Tc(t,e,i){return e=_t(e===n?t.length-1:e,0),function(){for(var c=arguments,l=-1,f=_t(c.length-e,0),g=P(f);++l<f;)g[l]=c[e+l];l=-1;for(var m=P(e+1);++l<e;)m[l]=c[l];return m[e]=i(g),zt(t,this,m)}}function Dc(t,e){return e.length<2?t:rr(t,te(e,0,-1))}function Xd(t,e){for(var i=t.length,c=Rt(e.length,i),l=Dt(t);c--;){var f=e[c];t[c]=Oe(f,i)?l[f]:n}return t}function $i(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var jc=$c(nc),sn=df||function(t,e){return It.setTimeout(t,e)},Ui=$c(Ed);function qc(t,e,i){var c=e+"";return Ui(t,Kd(c,tg(zd(c),i)))}function $c(t){var e=0,i=0;return function(){var c=mf(),l=_h-(c-i);if(i=c,l>0){if(++e>=wh)return arguments[0]}else e=0;return t.apply(n,arguments)}}function as(t,e){var i=-1,c=t.length,l=c-1;for(e=e===n?c:e;++i<e;){var f=wi(i,l),g=t[f];t[f]=t[i],t[i]=g}return t.length=e,t}var Uc=Qd(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Hh,function(i,c,l,f){e.push(l?f.replace(Jh,"$1"):c||i)}),e});function ve(t){if(typeof t=="string"||Kt(t))return t;var e=t+"";return e=="0"&&1/t==-Je?"-0":e}function sr(t){if(t!=null){try{return $n.call(t)}catch{}try{return t+""}catch{}}return""}function tg(t,e){return Jt(Rh,function(i){var c="_."+i[0];e&i[1]&&!An(t,c)&&t.push(c)}),t.sort()}function kc(t){if(t instanceof X)return t.clone();var e=new Yt(t.__wrapped__,t.__chain__);return e.__actions__=Dt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function eg(t,e,i){(i?xt(t,e,i):e===n)?e=1:e=_t(W(e),0);var c=t==null?0:t.length;if(!c||e<1)return[];for(var l=0,f=0,g=P(Vn(c/e));l<c;)g[f++]=te(t,l,l+=e);return g}function rg(t){for(var e=-1,i=t==null?0:t.length,c=0,l=[];++e<i;){var f=t[e];f&&(l[c++]=f)}return l}function ng(){var t=arguments.length;if(!t)return[];for(var e=P(t-1),i=arguments[0],c=t;c--;)e[c-1]=arguments[c];return Ue(B(i)?Dt(i):[i],St(e,1))}var sg=J(function(t,e){return gt(t)?Yr(t,St(e,1,gt,!0)):[]}),ig=J(function(t,e){var i=ee(e);return gt(i)&&(i=n),gt(t)?Yr(t,St(e,1,gt,!0),H(i,2)):[]}),og=J(function(t,e){var i=ee(e);return gt(i)&&(i=n),gt(t)?Yr(t,St(e,1,gt,!0),n,i):[]});function ag(t,e,i){var c=t==null?0:t.length;return c?(e=i||e===n?1:W(e),te(t,e<0?0:e,c)):[]}function cg(t,e,i){var c=t==null?0:t.length;return c?(e=i||e===n?1:W(e),e=c-e,te(t,0,e<0?0:e)):[]}function ug(t,e){return t&&t.length?Xn(t,H(e,3),!0,!0):[]}function lg(t,e){return t&&t.length?Xn(t,H(e,3),!0):[]}function hg(t,e,i,c){var l=t==null?0:t.length;return l?(i&&typeof i!="number"&&xt(t,e,i)&&(i=0,c=l),nd(t,e,i,c)):[]}function Mc(t,e,i){var c=t==null?0:t.length;if(!c)return-1;var l=i==null?0:W(i);return l<0&&(l=_t(c+l,0)),Tn(t,H(e,3),l)}function Lc(t,e,i){var c=t==null?0:t.length;if(!c)return-1;var l=c-1;return i!==n&&(l=W(i),l=i<0?_t(c+l,0):Rt(l,c-1)),Tn(t,H(e,3),l,!0)}function zc(t){var e=t==null?0:t.length;return e?St(t,1):[]}function pg(t){var e=t==null?0:t.length;return e?St(t,Je):[]}function fg(t,e){var i=t==null?0:t.length;return i?(e=e===n?1:W(e),St(t,e)):[]}function dg(t){for(var e=-1,i=t==null?0:t.length,c={};++e<i;){var l=t[e];c[l[0]]=l[1]}return c}function Hc(t){return t&&t.length?t[0]:n}function gg(t,e,i){var c=t==null?0:t.length;if(!c)return-1;var l=i==null?0:W(i);return l<0&&(l=_t(c+l,0)),gr(t,e,l)}function yg(t){var e=t==null?0:t.length;return e?te(t,0,-1):[]}var vg=J(function(t){var e=ht(t,Si);return e.length&&e[0]===t[0]?di(e):[]}),mg=J(function(t){var e=ee(t),i=ht(t,Si);return e===ee(i)?e=n:i.pop(),i.length&&i[0]===t[0]?di(i,H(e,2)):[]}),wg=J(function(t){var e=ee(t),i=ht(t,Si);return e=typeof e=="function"?e:n,e&&i.pop(),i.length&&i[0]===t[0]?di(i,n,e):[]});function _g(t,e){return t==null?"":yf.call(t,e)}function ee(t){var e=t==null?0:t.length;return e?t[e-1]:n}function bg(t,e,i){var c=t==null?0:t.length;if(!c)return-1;var l=c;return i!==n&&(l=W(i),l=l<0?_t(c+l,0):Rt(l,c-1)),e===e?Xp(t,e,l):Tn(t,Ea,l,!0)}function Eg(t,e){return t&&t.length?Xa(t,W(e)):n}var Ig=J(Vc);function Vc(t,e){return t&&t.length&&e&&e.length?mi(t,e):t}function Sg(t,e,i){return t&&t.length&&e&&e.length?mi(t,e,H(i,2)):t}function Pg(t,e,i){return t&&t.length&&e&&e.length?mi(t,e,n,i):t}var Rg=Re(function(t,e){var i=t==null?0:t.length,c=li(t,e);return rc(t,ht(e,function(l){return Oe(l,i)?+l:l}).sort(pc)),c});function Og(t,e){var i=[];if(!(t&&t.length))return i;var c=-1,l=[],f=t.length;for(e=H(e,3);++c<f;){var g=t[c];e(g,c,t)&&(i.push(g),l.push(c))}return rc(t,l),i}function ki(t){return t==null?t:_f.call(t)}function Ng(t,e,i){var c=t==null?0:t.length;return c?(i&&typeof i!="number"&&xt(t,e,i)?(e=0,i=c):(e=e==null?0:W(e),i=i===n?c:W(i)),te(t,e,i)):[]}function Cg(t,e){return Yn(t,e)}function xg(t,e,i){return bi(t,e,H(i,2))}function Ag(t,e){var i=t==null?0:t.length;if(i){var c=Yn(t,e);if(c<i&&ue(t[c],e))return c}return-1}function Tg(t,e){return Yn(t,e,!0)}function Dg(t,e,i){return bi(t,e,H(i,2),!0)}function jg(t,e){var i=t==null?0:t.length;if(i){var c=Yn(t,e,!0)-1;if(ue(t[c],e))return c}return-1}function qg(t){return t&&t.length?sc(t):[]}function $g(t,e){return t&&t.length?sc(t,H(e,2)):[]}function Ug(t){var e=t==null?0:t.length;return e?te(t,1,e):[]}function kg(t,e,i){return t&&t.length?(e=i||e===n?1:W(e),te(t,0,e<0?0:e)):[]}function Mg(t,e,i){var c=t==null?0:t.length;return c?(e=i||e===n?1:W(e),e=c-e,te(t,e<0?0:e,c)):[]}function Lg(t,e){return t&&t.length?Xn(t,H(e,3),!1,!0):[]}function zg(t,e){return t&&t.length?Xn(t,H(e,3)):[]}var Hg=J(function(t){return ze(St(t,1,gt,!0))}),Vg=J(function(t){var e=ee(t);return gt(e)&&(e=n),ze(St(t,1,gt,!0),H(e,2))}),Kg=J(function(t){var e=ee(t);return e=typeof e=="function"?e:n,ze(St(t,1,gt,!0),n,e)});function Fg(t){return t&&t.length?ze(t):[]}function Gg(t,e){return t&&t.length?ze(t,H(e,2)):[]}function Bg(t,e){return e=typeof e=="function"?e:n,t&&t.length?ze(t,n,e):[]}function Mi(t){if(!(t&&t.length))return[];var e=0;return t=$e(t,function(i){if(gt(i))return e=_t(i.length,e),!0}),ri(e,function(i){return ht(t,Xs(i))})}function Kc(t,e){if(!(t&&t.length))return[];var i=Mi(t);return e==null?i:ht(i,function(c){return zt(e,n,c)})}var Wg=J(function(t,e){return gt(t)?Yr(t,e):[]}),Qg=J(function(t){return Ii($e(t,gt))}),Jg=J(function(t){var e=ee(t);return gt(e)&&(e=n),Ii($e(t,gt),H(e,2))}),Zg=J(function(t){var e=ee(t);return e=typeof e=="function"?e:n,Ii($e(t,gt),n,e)}),Yg=J(Mi);function Xg(t,e){return cc(t||[],e||[],Zr)}function ty(t,e){return cc(t||[],e||[],en)}var ey=J(function(t){var e=t.length,i=e>1?t[e-1]:n;return i=typeof i=="function"?(t.pop(),i):n,Kc(t,i)});function Fc(t){var e=p(t);return e.__chain__=!0,e}function ry(t,e){return e(t),t}function cs(t,e){return e(t)}var ny=Re(function(t){var e=t.length,i=e?t[0]:0,c=this.__wrapped__,l=function(f){return li(f,t)};return e>1||this.__actions__.length||!(c instanceof X)||!Oe(i)?this.thru(l):(c=c.slice(i,+i+(e?1:0)),c.__actions__.push({func:cs,args:[l],thisArg:n}),new Yt(c,this.__chain__).thru(function(f){return e&&!f.length&&f.push(n),f}))});function sy(){return Fc(this)}function iy(){return new Yt(this.value(),this.__chain__)}function oy(){this.__values__===n&&(this.__values__=iu(this.value()));var t=this.__index__>=this.__values__.length,e=t?n:this.__values__[this.__index__++];return{done:t,value:e}}function ay(){return this}function cy(t){for(var e,i=this;i instanceof Bn;){var c=kc(i);c.__index__=0,c.__values__=n,e?l.__wrapped__=c:e=c;var l=c;i=i.__wrapped__}return l.__wrapped__=t,e}function uy(){var t=this.__wrapped__;if(t instanceof X){var e=t;return this.__actions__.length&&(e=new X(this)),e=e.reverse(),e.__actions__.push({func:cs,args:[ki],thisArg:n}),new Yt(e,this.__chain__)}return this.thru(ki)}function ly(){return ac(this.__wrapped__,this.__actions__)}var hy=ts(function(t,e,i){ot.call(t,i)?++t[i]:Se(t,i,1)});function py(t,e,i){var c=B(t)?_a:rd;return i&&xt(t,e,i)&&(e=n),c(t,H(e,3))}function fy(t,e){var i=B(t)?$e:Ka;return i(t,H(e,3))}var dy=mc(Mc),gy=mc(Lc);function yy(t,e){return St(us(t,e),1)}function vy(t,e){return St(us(t,e),Je)}function my(t,e,i){return i=i===n?1:W(i),St(us(t,e),i)}function Gc(t,e){var i=B(t)?Jt:Le;return i(t,H(e,3))}function Bc(t,e){var i=B(t)?$p:Va;return i(t,H(e,3))}var wy=ts(function(t,e,i){ot.call(t,i)?t[i].push(e):Se(t,i,[e])});function _y(t,e,i,c){t=jt(t)?t:Or(t),i=i&&!c?W(i):0;var l=t.length;return i<0&&(i=_t(l+i,0)),ds(t)?i<=l&&t.indexOf(e,i)>-1:!!l&&gr(t,e,i)>-1}var by=J(function(t,e,i){var c=-1,l=typeof e=="function",f=jt(t)?P(t.length):[];return Le(t,function(g){f[++c]=l?zt(e,g,i):Xr(g,e,i)}),f}),Ey=ts(function(t,e,i){Se(t,i,e)});function us(t,e){var i=B(t)?ht:Ja;return i(t,H(e,3))}function Iy(t,e,i,c){return t==null?[]:(B(e)||(e=e==null?[]:[e]),i=c?n:i,B(i)||(i=i==null?[]:[i]),tc(t,e,i))}var Sy=ts(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]});function Py(t,e,i){var c=B(t)?Zs:Sa,l=arguments.length<3;return c(t,H(e,4),i,l,Le)}function Ry(t,e,i){var c=B(t)?Up:Sa,l=arguments.length<3;return c(t,H(e,4),i,l,Va)}function Oy(t,e){var i=B(t)?$e:Ka;return i(t,ps(H(e,3)))}function Ny(t){var e=B(t)?Ma:_d;return e(t)}function Cy(t,e,i){(i?xt(t,e,i):e===n)?e=1:e=W(e);var c=B(t)?Zf:bd;return c(t,e)}function xy(t){var e=B(t)?Yf:Id;return e(t)}function Ay(t){if(t==null)return 0;if(jt(t))return ds(t)?vr(t):t.length;var e=Ot(t);return e==ie||e==oe?t.size:yi(t).length}function Ty(t,e,i){var c=B(t)?Ys:Sd;return i&&xt(t,e,i)&&(e=n),c(t,H(e,3))}var Dy=J(function(t,e){if(t==null)return[];var i=e.length;return i>1&&xt(t,e[0],e[1])?e=[]:i>2&&xt(e[0],e[1],e[2])&&(e=[e[0]]),tc(t,St(e,1),[])}),ls=ff||function(){return It.Date.now()};function jy(t,e){if(typeof e!="function")throw new Zt(h);return t=W(t),function(){if(--t<1)return e.apply(this,arguments)}}function Wc(t,e,i){return e=i?n:e,e=t&&e==null?t.length:e,Pe(t,$,n,n,n,n,e)}function Qc(t,e){var i;if(typeof e!="function")throw new Zt(h);return t=W(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Li=J(function(t,e,i){var c=nt;if(i.length){var l=ke(i,Pr(Li));c|=_}return Pe(t,c,e,i,l)}),Jc=J(function(t,e,i){var c=nt|st;if(i.length){var l=ke(i,Pr(Jc));c|=_}return Pe(e,c,t,i,l)});function Zc(t,e,i){e=i?n:e;var c=Pe(t,v,n,n,n,n,n,e);return c.placeholder=Zc.placeholder,c}function Yc(t,e,i){e=i?n:e;var c=Pe(t,w,n,n,n,n,n,e);return c.placeholder=Yc.placeholder,c}function Xc(t,e,i){var c,l,f,g,m,E,C=0,x=!1,T=!1,U=!0;if(typeof t!="function")throw new Zt(h);e=re(e)||0,ft(i)&&(x=!!i.leading,T="maxWait"in i,f=T?_t(re(i.maxWait)||0,e):f,U="trailing"in i?!!i.trailing:U);function M(yt){var le=c,xe=l;return c=l=n,C=yt,g=t.apply(xe,le),g}function V(yt){return C=yt,m=sn(Z,e),x?M(yt):g}function Q(yt){var le=yt-E,xe=yt-C,mu=e-le;return T?Rt(mu,f-xe):mu}function K(yt){var le=yt-E,xe=yt-C;return E===n||le>=e||le<0||T&&xe>=f}function Z(){var yt=ls();if(K(yt))return tt(yt);m=sn(Z,Q(yt))}function tt(yt){return m=n,U&&c?M(yt):(c=l=n,g)}function Ft(){m!==n&&uc(m),C=0,c=E=l=m=n}function At(){return m===n?g:tt(ls())}function Gt(){var yt=ls(),le=K(yt);if(c=arguments,l=this,E=yt,le){if(m===n)return V(E);if(T)return uc(m),m=sn(Z,e),M(E)}return m===n&&(m=sn(Z,e)),g}return Gt.cancel=Ft,Gt.flush=At,Gt}var qy=J(function(t,e){return Ha(t,1,e)}),$y=J(function(t,e,i){return Ha(t,re(e)||0,i)});function Uy(t){return Pe(t,Y)}function hs(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Zt(h);var i=function(){var c=arguments,l=e?e.apply(this,c):c[0],f=i.cache;if(f.has(l))return f.get(l);var g=t.apply(this,c);return i.cache=f.set(l,g)||f,g};return i.cache=new(hs.Cache||Ie),i}hs.Cache=Ie;function ps(t){if(typeof t!="function")throw new Zt(h);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function ky(t){return Qc(2,t)}var My=Pd(function(t,e){e=e.length==1&&B(e[0])?ht(e[0],Ht(H())):ht(St(e,1),Ht(H()));var i=e.length;return J(function(c){for(var l=-1,f=Rt(c.length,i);++l<f;)c[l]=e[l].call(this,c[l]);return zt(t,this,c)})}),zi=J(function(t,e){var i=ke(e,Pr(zi));return Pe(t,_,n,e,i)}),tu=J(function(t,e){var i=ke(e,Pr(tu));return Pe(t,S,n,e,i)}),Ly=Re(function(t,e){return Pe(t,D,n,n,n,e)});function zy(t,e){if(typeof t!="function")throw new Zt(h);return e=e===n?e:W(e),J(t,e)}function Hy(t,e){if(typeof t!="function")throw new Zt(h);return e=e==null?0:_t(W(e),0),J(function(i){var c=i[e],l=Ve(i,0,e);return c&&Ue(l,c),zt(t,this,l)})}function Vy(t,e,i){var c=!0,l=!0;if(typeof t!="function")throw new Zt(h);return ft(i)&&(c="leading"in i?!!i.leading:c,l="trailing"in i?!!i.trailing:l),Xc(t,e,{leading:c,maxWait:e,trailing:l})}function Ky(t){return Wc(t,1)}function Fy(t,e){return zi(Pi(e),t)}function Gy(){if(!arguments.length)return[];var t=arguments[0];return B(t)?t:[t]}function By(t){return Xt(t,F)}function Wy(t,e){return e=typeof e=="function"?e:n,Xt(t,F,e)}function Qy(t){return Xt(t,A|F)}function Jy(t,e){return e=typeof e=="function"?e:n,Xt(t,A|F,e)}function Zy(t,e){return e==null||za(t,e,bt(e))}function ue(t,e){return t===e||t!==t&&e!==e}var Yy=ss(fi),Xy=ss(function(t,e){return t>=e}),ir=Ba(function(){return arguments}())?Ba:function(t){return dt(t)&&ot.call(t,"callee")&&!Da.call(t,"callee")},B=P.isArray,tv=da?Ht(da):cd;function jt(t){return t!=null&&fs(t.length)&&!Ne(t)}function gt(t){return dt(t)&&jt(t)}function ev(t){return t===!0||t===!1||dt(t)&&Ct(t)==kr}var Ke=gf||Yi,rv=ga?Ht(ga):ud;function nv(t){return dt(t)&&t.nodeType===1&&!on(t)}function sv(t){if(t==null)return!0;if(jt(t)&&(B(t)||typeof t=="string"||typeof t.splice=="function"||Ke(t)||Rr(t)||ir(t)))return!t.length;var e=Ot(t);if(e==ie||e==oe)return!t.size;if(nn(t))return!yi(t).length;for(var i in t)if(ot.call(t,i))return!1;return!0}function iv(t,e){return tn(t,e)}function ov(t,e,i){i=typeof i=="function"?i:n;var c=i?i(t,e):n;return c===n?tn(t,e,n,i):!!c}function Hi(t){if(!dt(t))return!1;var e=Ct(t);return e==Pn||e==Nh||typeof t.message=="string"&&typeof t.name=="string"&&!on(t)}function av(t){return typeof t=="number"&&qa(t)}function Ne(t){if(!ft(t))return!1;var e=Ct(t);return e==Rn||e==Ho||e==Oh||e==xh}function eu(t){return typeof t=="number"&&t==W(t)}function fs(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=qe}function ft(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function dt(t){return t!=null&&typeof t=="object"}var ru=ya?Ht(ya):hd;function cv(t,e){return t===e||gi(t,e,Ti(e))}function uv(t,e,i){return i=typeof i=="function"?i:n,gi(t,e,Ti(e),i)}function lv(t){return nu(t)&&t!=+t}function hv(t){if(Wd(t))throw new G(u);return Wa(t)}function pv(t){return t===null}function fv(t){return t==null}function nu(t){return typeof t=="number"||dt(t)&&Ct(t)==Lr}function on(t){if(!dt(t)||Ct(t)!=be)return!1;var e=Ln(t);if(e===null)return!0;var i=ot.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&$n.call(i)==uf}var Vi=va?Ht(va):pd;function dv(t){return eu(t)&&t>=-qe&&t<=qe}var su=ma?Ht(ma):fd;function ds(t){return typeof t=="string"||!B(t)&&dt(t)&&Ct(t)==Hr}function Kt(t){return typeof t=="symbol"||dt(t)&&Ct(t)==On}var Rr=wa?Ht(wa):dd;function gv(t){return t===n}function yv(t){return dt(t)&&Ot(t)==Vr}function vv(t){return dt(t)&&Ct(t)==Th}var mv=ss(vi),wv=ss(function(t,e){return t<=e});function iu(t){if(!t)return[];if(jt(t))return ds(t)?ae(t):Dt(t);if(Gr&&t[Gr])return Jp(t[Gr]());var e=Ot(t),i=e==ie?si:e==oe?Dn:Or;return i(t)}function Ce(t){if(!t)return t===0?t:0;if(t=re(t),t===Je||t===-Je){var e=t<0?-1:1;return e*Ih}return t===t?t:0}function W(t){var e=Ce(t),i=e%1;return e===e?i?e-i:e:0}function ou(t){return t?er(W(t),0,de):0}function re(t){if(typeof t=="number")return t;if(Kt(t))return In;if(ft(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=ft(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Pa(t);var i=Xh.test(t);return i||ep.test(t)?Dp(t.slice(2),i?2:8):Yh.test(t)?In:+t}function au(t){return ye(t,qt(t))}function _v(t){return t?er(W(t),-qe,qe):t===0?t:0}function it(t){return t==null?"":Vt(t)}var bv=Ir(function(t,e){if(nn(e)||jt(e)){ye(e,bt(e),t);return}for(var i in e)ot.call(e,i)&&Zr(t,i,e[i])}),cu=Ir(function(t,e){ye(e,qt(e),t)}),gs=Ir(function(t,e,i,c){ye(e,qt(e),t,c)}),Ev=Ir(function(t,e,i,c){ye(e,bt(e),t,c)}),Iv=Re(li);function Sv(t,e){var i=Er(t);return e==null?i:La(i,e)}var Pv=J(function(t,e){t=at(t);var i=-1,c=e.length,l=c>2?e[2]:n;for(l&&xt(e[0],e[1],l)&&(c=1);++i<c;)for(var f=e[i],g=qt(f),m=-1,E=g.length;++m<E;){var C=g[m],x=t[C];(x===n||ue(x,wr[C])&&!ot.call(t,C))&&(t[C]=f[C])}return t}),Rv=J(function(t){return t.push(n,Pc),zt(uu,n,t)});function Ov(t,e){return ba(t,H(e,3),ge)}function Nv(t,e){return ba(t,H(e,3),pi)}function Cv(t,e){return t==null?t:hi(t,H(e,3),qt)}function xv(t,e){return t==null?t:Fa(t,H(e,3),qt)}function Av(t,e){return t&&ge(t,H(e,3))}function Tv(t,e){return t&&pi(t,H(e,3))}function Dv(t){return t==null?[]:Jn(t,bt(t))}function jv(t){return t==null?[]:Jn(t,qt(t))}function Ki(t,e,i){var c=t==null?n:rr(t,e);return c===n?i:c}function qv(t,e){return t!=null&&Nc(t,e,sd)}function Fi(t,e){return t!=null&&Nc(t,e,id)}var $v=_c(function(t,e,i){e!=null&&typeof e.toString!="function"&&(e=Un.call(e)),t[e]=i},Bi($t)),Uv=_c(function(t,e,i){e!=null&&typeof e.toString!="function"&&(e=Un.call(e)),ot.call(t,e)?t[e].push(i):t[e]=[i]},H),kv=J(Xr);function bt(t){return jt(t)?ka(t):yi(t)}function qt(t){return jt(t)?ka(t,!0):gd(t)}function Mv(t,e){var i={};return e=H(e,3),ge(t,function(c,l,f){Se(i,e(c,l,f),c)}),i}function Lv(t,e){var i={};return e=H(e,3),ge(t,function(c,l,f){Se(i,l,e(c,l,f))}),i}var zv=Ir(function(t,e,i){Zn(t,e,i)}),uu=Ir(function(t,e,i,c){Zn(t,e,i,c)}),Hv=Re(function(t,e){var i={};if(t==null)return i;var c=!1;e=ht(e,function(f){return f=He(f,t),c||(c=f.length>1),f}),ye(t,xi(t),i),c&&(i=Xt(i,A|j|F,$d));for(var l=e.length;l--;)Ei(i,e[l]);return i});function Vv(t,e){return lu(t,ps(H(e)))}var Kv=Re(function(t,e){return t==null?{}:vd(t,e)});function lu(t,e){if(t==null)return{};var i=ht(xi(t),function(c){return[c]});return e=H(e),ec(t,i,function(c,l){return e(c,l[0])})}function Fv(t,e,i){e=He(e,t);var c=-1,l=e.length;for(l||(l=1,t=n);++c<l;){var f=t==null?n:t[ve(e[c])];f===n&&(c=l,f=i),t=Ne(f)?f.call(t):f}return t}function Gv(t,e,i){return t==null?t:en(t,e,i)}function Bv(t,e,i,c){return c=typeof c=="function"?c:n,t==null?t:en(t,e,i,c)}var hu=Ic(bt),pu=Ic(qt);function Wv(t,e,i){var c=B(t),l=c||Ke(t)||Rr(t);if(e=H(e,4),i==null){var f=t&&t.constructor;l?i=c?new f:[]:ft(t)?i=Ne(f)?Er(Ln(t)):{}:i={}}return(l?Jt:ge)(t,function(g,m,E){return e(i,g,m,E)}),i}function Qv(t,e){return t==null?!0:Ei(t,e)}function Jv(t,e,i){return t==null?t:oc(t,e,Pi(i))}function Zv(t,e,i,c){return c=typeof c=="function"?c:n,t==null?t:oc(t,e,Pi(i),c)}function Or(t){return t==null?[]:ni(t,bt(t))}function Yv(t){return t==null?[]:ni(t,qt(t))}function Xv(t,e,i){return i===n&&(i=e,e=n),i!==n&&(i=re(i),i=i===i?i:0),e!==n&&(e=re(e),e=e===e?e:0),er(re(t),e,i)}function tm(t,e,i){return e=Ce(e),i===n?(i=e,e=0):i=Ce(i),t=re(t),od(t,e,i)}function em(t,e,i){if(i&&typeof i!="boolean"&&xt(t,e,i)&&(e=i=n),i===n&&(typeof e=="boolean"?(i=e,e=n):typeof t=="boolean"&&(i=t,t=n)),t===n&&e===n?(t=0,e=1):(t=Ce(t),e===n?(e=t,t=0):e=Ce(e)),t>e){var c=t;t=e,e=c}if(i||t%1||e%1){var l=$a();return Rt(t+l*(e-t+Tp("1e-"+((l+"").length-1))),e)}return wi(t,e)}var rm=Sr(function(t,e,i){return e=e.toLowerCase(),t+(i?fu(e):e)});function fu(t){return Gi(it(t).toLowerCase())}function du(t){return t=it(t),t&&t.replace(np,Fp).replace(Ep,"")}function nm(t,e,i){t=it(t),e=Vt(e);var c=t.length;i=i===n?c:er(W(i),0,c);var l=i;return i-=e.length,i>=0&&t.slice(i,l)==e}function sm(t){return t=it(t),t&&Uh.test(t)?t.replace(Fo,Gp):t}function im(t){return t=it(t),t&&Vh.test(t)?t.replace(zs,"\\$&"):t}var om=Sr(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()}),am=Sr(function(t,e,i){return t+(i?" ":"")+e.toLowerCase()}),cm=vc("toLowerCase");function um(t,e,i){t=it(t),e=W(e);var c=e?vr(t):0;if(!e||c>=e)return t;var l=(e-c)/2;return ns(Kn(l),i)+t+ns(Vn(l),i)}function lm(t,e,i){t=it(t),e=W(e);var c=e?vr(t):0;return e&&c<e?t+ns(e-c,i):t}function hm(t,e,i){t=it(t),e=W(e);var c=e?vr(t):0;return e&&c<e?ns(e-c,i)+t:t}function pm(t,e,i){return i||e==null?e=0:e&&(e=+e),wf(it(t).replace(Hs,""),e||0)}function fm(t,e,i){return(i?xt(t,e,i):e===n)?e=1:e=W(e),_i(it(t),e)}function dm(){var t=arguments,e=it(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var gm=Sr(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()});function ym(t,e,i){return i&&typeof i!="number"&&xt(t,e,i)&&(e=i=n),i=i===n?de:i>>>0,i?(t=it(t),t&&(typeof e=="string"||e!=null&&!Vi(e))&&(e=Vt(e),!e&&yr(t))?Ve(ae(t),0,i):t.split(e,i)):[]}var vm=Sr(function(t,e,i){return t+(i?" ":"")+Gi(e)});function mm(t,e,i){return t=it(t),i=i==null?0:er(W(i),0,t.length),e=Vt(e),t.slice(i,i+e.length)==e}function wm(t,e,i){var c=p.templateSettings;i&&xt(t,e,i)&&(e=n),t=it(t),e=gs({},e,c,Sc);var l=gs({},e.imports,c.imports,Sc),f=bt(l),g=ni(l,f),m,E,C=0,x=e.interpolate||Nn,T="__p += '",U=ii((e.escape||Nn).source+"|"+x.source+"|"+(x===Go?Zh:Nn).source+"|"+(e.evaluate||Nn).source+"|$","g"),M="//# sourceURL="+(ot.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Op+"]")+`
`;t.replace(U,function(K,Z,tt,Ft,At,Gt){return tt||(tt=Ft),T+=t.slice(C,Gt).replace(sp,Bp),Z&&(m=!0,T+=`' +
__e(`+Z+`) +
'`),At&&(E=!0,T+=`';
`+At+`;
__p += '`),tt&&(T+=`' +
((__t = (`+tt+`)) == null ? '' : __t) +
'`),C=Gt+K.length,K}),T+=`';
`;var V=ot.call(e,"variable")&&e.variable;if(!V)T=`with (obj) {
`+T+`
}
`;else if(Qh.test(V))throw new G(y);T=(E?T.replace(Dh,""):T).replace(jh,"$1").replace(qh,"$1;"),T="function("+(V||"obj")+`) {
`+(V?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(E?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+T+`return __p
}`;var Q=yu(function(){return rt(f,M+"return "+T).apply(n,g)});if(Q.source=T,Hi(Q))throw Q;return Q}function _m(t){return it(t).toLowerCase()}function bm(t){return it(t).toUpperCase()}function Em(t,e,i){if(t=it(t),t&&(i||e===n))return Pa(t);if(!t||!(e=Vt(e)))return t;var c=ae(t),l=ae(e),f=Ra(c,l),g=Oa(c,l)+1;return Ve(c,f,g).join("")}function Im(t,e,i){if(t=it(t),t&&(i||e===n))return t.slice(0,Ca(t)+1);if(!t||!(e=Vt(e)))return t;var c=ae(t),l=Oa(c,ae(e))+1;return Ve(c,0,l).join("")}function Sm(t,e,i){if(t=it(t),t&&(i||e===n))return t.replace(Hs,"");if(!t||!(e=Vt(e)))return t;var c=ae(t),l=Ra(c,ae(e));return Ve(c,l).join("")}function Pm(t,e){var i=Ur,c=mh;if(ft(e)){var l="separator"in e?e.separator:l;i="length"in e?W(e.length):i,c="omission"in e?Vt(e.omission):c}t=it(t);var f=t.length;if(yr(t)){var g=ae(t);f=g.length}if(i>=f)return t;var m=i-vr(c);if(m<1)return c;var E=g?Ve(g,0,m).join(""):t.slice(0,m);if(l===n)return E+c;if(g&&(m+=E.length-m),Vi(l)){if(t.slice(m).search(l)){var C,x=E;for(l.global||(l=ii(l.source,it(Bo.exec(l))+"g")),l.lastIndex=0;C=l.exec(x);)var T=C.index;E=E.slice(0,T===n?m:T)}}else if(t.indexOf(Vt(l),m)!=m){var U=E.lastIndexOf(l);U>-1&&(E=E.slice(0,U))}return E+c}function Rm(t){return t=it(t),t&&$h.test(t)?t.replace(Ko,tf):t}var Om=Sr(function(t,e,i){return t+(i?" ":"")+e.toUpperCase()}),Gi=vc("toUpperCase");function gu(t,e,i){return t=it(t),e=i?n:e,e===n?Qp(t)?nf(t):Lp(t):t.match(e)||[]}var yu=J(function(t,e){try{return zt(t,n,e)}catch(i){return Hi(i)?i:new G(i)}}),Nm=Re(function(t,e){return Jt(e,function(i){i=ve(i),Se(t,i,Li(t[i],t))}),t});function Cm(t){var e=t==null?0:t.length,i=H();return t=e?ht(t,function(c){if(typeof c[1]!="function")throw new Zt(h);return[i(c[0]),c[1]]}):[],J(function(c){for(var l=-1;++l<e;){var f=t[l];if(zt(f[0],this,c))return zt(f[1],this,c)}})}function xm(t){return ed(Xt(t,A))}function Bi(t){return function(){return t}}function Am(t,e){return t==null||t!==t?e:t}var Tm=wc(),Dm=wc(!0);function $t(t){return t}function Wi(t){return Qa(typeof t=="function"?t:Xt(t,A))}function jm(t){return Za(Xt(t,A))}function qm(t,e){return Ya(t,Xt(e,A))}var $m=J(function(t,e){return function(i){return Xr(i,t,e)}}),Um=J(function(t,e){return function(i){return Xr(t,i,e)}});function Qi(t,e,i){var c=bt(e),l=Jn(e,c);i==null&&!(ft(e)&&(l.length||!c.length))&&(i=e,e=t,t=this,l=Jn(e,bt(e)));var f=!(ft(i)&&"chain"in i)||!!i.chain,g=Ne(t);return Jt(l,function(m){var E=e[m];t[m]=E,g&&(t.prototype[m]=function(){var C=this.__chain__;if(f||C){var x=t(this.__wrapped__),T=x.__actions__=Dt(this.__actions__);return T.push({func:E,args:arguments,thisArg:t}),x.__chain__=C,x}return E.apply(t,Ue([this.value()],arguments))})}),t}function km(){return It._===this&&(It._=lf),this}function Ji(){}function Mm(t){return t=W(t),J(function(e){return Xa(e,t)})}var Lm=Oi(ht),zm=Oi(_a),Hm=Oi(Ys);function vu(t){return ji(t)?Xs(ve(t)):md(t)}function Vm(t){return function(e){return t==null?n:rr(t,e)}}var Km=bc(),Fm=bc(!0);function Zi(){return[]}function Yi(){return!1}function Gm(){return{}}function Bm(){return""}function Wm(){return!0}function Qm(t,e){if(t=W(t),t<1||t>qe)return[];var i=de,c=Rt(t,de);e=H(e),t-=de;for(var l=ri(c,e);++i<t;)e(i);return l}function Jm(t){return B(t)?ht(t,ve):Kt(t)?[t]:Dt(Uc(it(t)))}function Zm(t){var e=++cf;return it(t)+e}var Ym=rs(function(t,e){return t+e},0),Xm=Ni("ceil"),tw=rs(function(t,e){return t/e},1),ew=Ni("floor");function rw(t){return t&&t.length?Qn(t,$t,fi):n}function nw(t,e){return t&&t.length?Qn(t,H(e,2),fi):n}function sw(t){return Ia(t,$t)}function iw(t,e){return Ia(t,H(e,2))}function ow(t){return t&&t.length?Qn(t,$t,vi):n}function aw(t,e){return t&&t.length?Qn(t,H(e,2),vi):n}var cw=rs(function(t,e){return t*e},1),uw=Ni("round"),lw=rs(function(t,e){return t-e},0);function hw(t){return t&&t.length?ei(t,$t):0}function pw(t,e){return t&&t.length?ei(t,H(e,2)):0}return p.after=jy,p.ary=Wc,p.assign=bv,p.assignIn=cu,p.assignInWith=gs,p.assignWith=Ev,p.at=Iv,p.before=Qc,p.bind=Li,p.bindAll=Nm,p.bindKey=Jc,p.castArray=Gy,p.chain=Fc,p.chunk=eg,p.compact=rg,p.concat=ng,p.cond=Cm,p.conforms=xm,p.constant=Bi,p.countBy=hy,p.create=Sv,p.curry=Zc,p.curryRight=Yc,p.debounce=Xc,p.defaults=Pv,p.defaultsDeep=Rv,p.defer=qy,p.delay=$y,p.difference=sg,p.differenceBy=ig,p.differenceWith=og,p.drop=ag,p.dropRight=cg,p.dropRightWhile=ug,p.dropWhile=lg,p.fill=hg,p.filter=fy,p.flatMap=yy,p.flatMapDeep=vy,p.flatMapDepth=my,p.flatten=zc,p.flattenDeep=pg,p.flattenDepth=fg,p.flip=Uy,p.flow=Tm,p.flowRight=Dm,p.fromPairs=dg,p.functions=Dv,p.functionsIn=jv,p.groupBy=wy,p.initial=yg,p.intersection=vg,p.intersectionBy=mg,p.intersectionWith=wg,p.invert=$v,p.invertBy=Uv,p.invokeMap=by,p.iteratee=Wi,p.keyBy=Ey,p.keys=bt,p.keysIn=qt,p.map=us,p.mapKeys=Mv,p.mapValues=Lv,p.matches=jm,p.matchesProperty=qm,p.memoize=hs,p.merge=zv,p.mergeWith=uu,p.method=$m,p.methodOf=Um,p.mixin=Qi,p.negate=ps,p.nthArg=Mm,p.omit=Hv,p.omitBy=Vv,p.once=ky,p.orderBy=Iy,p.over=Lm,p.overArgs=My,p.overEvery=zm,p.overSome=Hm,p.partial=zi,p.partialRight=tu,p.partition=Sy,p.pick=Kv,p.pickBy=lu,p.property=vu,p.propertyOf=Vm,p.pull=Ig,p.pullAll=Vc,p.pullAllBy=Sg,p.pullAllWith=Pg,p.pullAt=Rg,p.range=Km,p.rangeRight=Fm,p.rearg=Ly,p.reject=Oy,p.remove=Og,p.rest=zy,p.reverse=ki,p.sampleSize=Cy,p.set=Gv,p.setWith=Bv,p.shuffle=xy,p.slice=Ng,p.sortBy=Dy,p.sortedUniq=qg,p.sortedUniqBy=$g,p.split=ym,p.spread=Hy,p.tail=Ug,p.take=kg,p.takeRight=Mg,p.takeRightWhile=Lg,p.takeWhile=zg,p.tap=ry,p.throttle=Vy,p.thru=cs,p.toArray=iu,p.toPairs=hu,p.toPairsIn=pu,p.toPath=Jm,p.toPlainObject=au,p.transform=Wv,p.unary=Ky,p.union=Hg,p.unionBy=Vg,p.unionWith=Kg,p.uniq=Fg,p.uniqBy=Gg,p.uniqWith=Bg,p.unset=Qv,p.unzip=Mi,p.unzipWith=Kc,p.update=Jv,p.updateWith=Zv,p.values=Or,p.valuesIn=Yv,p.without=Wg,p.words=gu,p.wrap=Fy,p.xor=Qg,p.xorBy=Jg,p.xorWith=Zg,p.zip=Yg,p.zipObject=Xg,p.zipObjectDeep=ty,p.zipWith=ey,p.entries=hu,p.entriesIn=pu,p.extend=cu,p.extendWith=gs,Qi(p,p),p.add=Ym,p.attempt=yu,p.camelCase=rm,p.capitalize=fu,p.ceil=Xm,p.clamp=Xv,p.clone=By,p.cloneDeep=Qy,p.cloneDeepWith=Jy,p.cloneWith=Wy,p.conformsTo=Zy,p.deburr=du,p.defaultTo=Am,p.divide=tw,p.endsWith=nm,p.eq=ue,p.escape=sm,p.escapeRegExp=im,p.every=py,p.find=dy,p.findIndex=Mc,p.findKey=Ov,p.findLast=gy,p.findLastIndex=Lc,p.findLastKey=Nv,p.floor=ew,p.forEach=Gc,p.forEachRight=Bc,p.forIn=Cv,p.forInRight=xv,p.forOwn=Av,p.forOwnRight=Tv,p.get=Ki,p.gt=Yy,p.gte=Xy,p.has=qv,p.hasIn=Fi,p.head=Hc,p.identity=$t,p.includes=_y,p.indexOf=gg,p.inRange=tm,p.invoke=kv,p.isArguments=ir,p.isArray=B,p.isArrayBuffer=tv,p.isArrayLike=jt,p.isArrayLikeObject=gt,p.isBoolean=ev,p.isBuffer=Ke,p.isDate=rv,p.isElement=nv,p.isEmpty=sv,p.isEqual=iv,p.isEqualWith=ov,p.isError=Hi,p.isFinite=av,p.isFunction=Ne,p.isInteger=eu,p.isLength=fs,p.isMap=ru,p.isMatch=cv,p.isMatchWith=uv,p.isNaN=lv,p.isNative=hv,p.isNil=fv,p.isNull=pv,p.isNumber=nu,p.isObject=ft,p.isObjectLike=dt,p.isPlainObject=on,p.isRegExp=Vi,p.isSafeInteger=dv,p.isSet=su,p.isString=ds,p.isSymbol=Kt,p.isTypedArray=Rr,p.isUndefined=gv,p.isWeakMap=yv,p.isWeakSet=vv,p.join=_g,p.kebabCase=om,p.last=ee,p.lastIndexOf=bg,p.lowerCase=am,p.lowerFirst=cm,p.lt=mv,p.lte=wv,p.max=rw,p.maxBy=nw,p.mean=sw,p.meanBy=iw,p.min=ow,p.minBy=aw,p.stubArray=Zi,p.stubFalse=Yi,p.stubObject=Gm,p.stubString=Bm,p.stubTrue=Wm,p.multiply=cw,p.nth=Eg,p.noConflict=km,p.noop=Ji,p.now=ls,p.pad=um,p.padEnd=lm,p.padStart=hm,p.parseInt=pm,p.random=em,p.reduce=Py,p.reduceRight=Ry,p.repeat=fm,p.replace=dm,p.result=Fv,p.round=uw,p.runInContext=b,p.sample=Ny,p.size=Ay,p.snakeCase=gm,p.some=Ty,p.sortedIndex=Cg,p.sortedIndexBy=xg,p.sortedIndexOf=Ag,p.sortedLastIndex=Tg,p.sortedLastIndexBy=Dg,p.sortedLastIndexOf=jg,p.startCase=vm,p.startsWith=mm,p.subtract=lw,p.sum=hw,p.sumBy=pw,p.template=wm,p.times=Qm,p.toFinite=Ce,p.toInteger=W,p.toLength=ou,p.toLower=_m,p.toNumber=re,p.toSafeInteger=_v,p.toString=it,p.toUpper=bm,p.trim=Em,p.trimEnd=Im,p.trimStart=Sm,p.truncate=Pm,p.unescape=Rm,p.uniqueId=Zm,p.upperCase=Om,p.upperFirst=Gi,p.each=Gc,p.eachRight=Bc,p.first=Hc,Qi(p,function(){var t={};return ge(p,function(e,i){ot.call(p.prototype,i)||(t[i]=e)}),t}(),{chain:!1}),p.VERSION=s,Jt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){p[t].placeholder=p}),Jt(["drop","take"],function(t,e){X.prototype[t]=function(i){i=i===n?1:_t(W(i),0);var c=this.__filtered__&&!e?new X(this):this.clone();return c.__filtered__?c.__takeCount__=Rt(i,c.__takeCount__):c.__views__.push({size:Rt(i,de),type:t+(c.__dir__<0?"Right":"")}),c},X.prototype[t+"Right"]=function(i){return this.reverse()[t](i).reverse()}}),Jt(["filter","map","takeWhile"],function(t,e){var i=e+1,c=i==zo||i==Eh;X.prototype[t]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:H(l,3),type:i}),f.__filtered__=f.__filtered__||c,f}}),Jt(["head","last"],function(t,e){var i="take"+(e?"Right":"");X.prototype[t]=function(){return this[i](1).value()[0]}}),Jt(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");X.prototype[t]=function(){return this.__filtered__?new X(this):this[i](1)}}),X.prototype.compact=function(){return this.filter($t)},X.prototype.find=function(t){return this.filter(t).head()},X.prototype.findLast=function(t){return this.reverse().find(t)},X.prototype.invokeMap=J(function(t,e){return typeof t=="function"?new X(this):this.map(function(i){return Xr(i,t,e)})}),X.prototype.reject=function(t){return this.filter(ps(H(t)))},X.prototype.slice=function(t,e){t=W(t);var i=this;return i.__filtered__&&(t>0||e<0)?new X(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==n&&(e=W(e),i=e<0?i.dropRight(-e):i.take(e-t)),i)},X.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},X.prototype.toArray=function(){return this.take(de)},ge(X.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),c=/^(?:head|last)$/.test(e),l=p[c?"take"+(e=="last"?"Right":""):e],f=c||/^find/.test(e);l&&(p.prototype[e]=function(){var g=this.__wrapped__,m=c?[1]:arguments,E=g instanceof X,C=m[0],x=E||B(g),T=function(Z){var tt=l.apply(p,Ue([Z],m));return c&&U?tt[0]:tt};x&&i&&typeof C=="function"&&C.length!=1&&(E=x=!1);var U=this.__chain__,M=!!this.__actions__.length,V=f&&!U,Q=E&&!M;if(!f&&x){g=Q?g:new X(this);var K=t.apply(g,m);return K.__actions__.push({func:cs,args:[T],thisArg:n}),new Yt(K,U)}return V&&Q?t.apply(this,m):(K=this.thru(T),V?c?K.value()[0]:K.value():K)})}),Jt(["pop","push","shift","sort","splice","unshift"],function(t){var e=jn[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",c=/^(?:pop|shift)$/.test(t);p.prototype[t]=function(){var l=arguments;if(c&&!this.__chain__){var f=this.value();return e.apply(B(f)?f:[],l)}return this[i](function(g){return e.apply(B(g)?g:[],l)})}}),ge(X.prototype,function(t,e){var i=p[e];if(i){var c=i.name+"";ot.call(br,c)||(br[c]=[]),br[c].push({name:e,func:i})}}),br[es(n,st).name]=[{name:"wrapper",func:n}],X.prototype.clone=Rf,X.prototype.reverse=Of,X.prototype.value=Nf,p.prototype.at=ny,p.prototype.chain=sy,p.prototype.commit=iy,p.prototype.next=oy,p.prototype.plant=cy,p.prototype.reverse=uy,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=ly,p.prototype.first=p.prototype.head,Gr&&(p.prototype[Gr]=ay),p},mr=sf();Ze?((Ze.exports=mr)._=mr,Ws._=mr):It._=mr}).call(fn)})(Io,Io.exports);var k0=Object.defineProperty,M0=Object.defineProperties,L0=Object.getOwnPropertyDescriptors,wl=Object.getOwnPropertySymbols,z0=Object.prototype.hasOwnProperty,H0=Object.prototype.propertyIsEnumerable,_l=(o,r,n)=>r in o?k0(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,ms=(o,r)=>{for(var n in r||(r={}))z0.call(r,n)&&_l(o,n,r[n]);if(wl)for(var n of wl(r))H0.call(r,n)&&_l(o,n,r[n]);return o},V0=(o,r)=>M0(o,L0(r));function We(o,r,n){var s;const a=v_(o);return((s=r.rpcMap)==null?void 0:s[a.reference])||`${U0}?chainId=${a.namespace}:${a.reference}&projectId=${n}`}function hr(o){return o.includes(":")?o.split(":")[1]:o}function yh(o){return o.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function K0(o,r){const n=Object.keys(r.namespaces).filter(a=>a.includes(o));if(!n.length)return[];const s=[];return n.forEach(a=>{const u=r.namespaces[a].accounts;s.push(...u)}),s}function F0(o={},r={}){const n=bl(o),s=bl(r);return Io.exports.merge(n,s)}function bl(o){var r,n,s,a;const u={};if(!Tr(o))return u;for(const[h,y]of Object.entries(o)){const I=jo(h)?[h]:y.chains,R=y.methods||[],O=y.events||[],A=y.rpcMap||{},j=dn(h);u[j]=V0(ms(ms({},u[j]),y),{chains:Xi(I,(r=u[j])==null?void 0:r.chains),methods:Xi(R,(n=u[j])==null?void 0:n.methods),events:Xi(O,(s=u[j])==null?void 0:s.events),rpcMap:ms(ms({},A),(a=u[j])==null?void 0:a.rpcMap)})}return u}function G0(o){return o.includes(":")?o.split(":")[2]:o}function B0(o){const r={};for(const[n,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],h=s.accounts||[],y=jo(n)?[n]:s.chains?s.chains:yh(s.accounts);r[n]={chains:y,methods:a,events:u,accounts:h}}return r}function oo(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const vh={},pt=o=>vh[o],ao=(o,r)=>{vh[o]=r};class W0{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=pt("events"),this.client=pt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,n){this.httpProviders[r]||this.setHttpProvider(r,n),this.chainId=r,this.events.emit(je.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(n=>{var s;const a=hr(n);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[n])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return n}setHttpProvider(r,n){const s=this.createHttpProvider(r,n);s&&(this.httpProviders[r]=s)}createHttpProvider(r,n){const s=n||We(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new De(new Qe(s,pt("disableProviderPing")))}}class Q0{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=pt("events"),this.client=pt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,n){this.httpProviders[r]||this.setHttpProvider(parseInt(r),n),this.chainId=parseInt(r),this.events.emit(je.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,n){const s=n||We(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new De(new Qe(s,pt("disableProviderPing")))}setHttpProvider(r,n){const s=this.createHttpProvider(r,n);s&&(this.httpProviders[r]=s)}createHttpProviders(){const r={};return this.namespace.chains.forEach(n=>{var s;const a=parseInt(hr(n));r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[n])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return n}async handleSwitchChain(r){var n,s;let a=r.request.params?(n=r.request.params[0])==null?void 0:n.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class J0{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=pt("events"),this.client=pt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,n){this.httpProviders[r]||this.setHttpProvider(r,n),this.chainId=r,this.events.emit(je.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(n=>{var s;const a=hr(n);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[n])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return n}setHttpProvider(r,n){const s=this.createHttpProvider(r,n);s&&(this.httpProviders[r]=s)}createHttpProvider(r,n){const s=n||We(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new De(new Qe(s,pt("disableProviderPing")))}}class Z0{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=pt("events"),this.client=pt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,n){this.httpProviders[r]||this.setHttpProvider(r,n),this.chainId=r,this.events.emit(je.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(n=>{var s;const a=hr(n);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[n])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return n}setHttpProvider(r,n){const s=this.createHttpProvider(r,n);s&&(this.httpProviders[r]=s)}createHttpProvider(r,n){const s=n||We(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new De(new Qe(s,pt("disableProviderPing")))}}class Y0{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=pt("events"),this.client=pt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,n){this.httpProviders[r]||this.setHttpProvider(r,n),this.chainId=r,this.events.emit(je.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(n=>{const s=this.getCardanoRPCUrl(n),a=hr(n);r[a]=this.createHttpProvider(a,s)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return n}getCardanoRPCUrl(r){const n=this.namespace.rpcMap;if(n)return n[r]}setHttpProvider(r,n){const s=this.createHttpProvider(r,n);s&&(this.httpProviders[r]=s)}createHttpProvider(r,n){const s=n||this.getCardanoRPCUrl(r);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new De(new Qe(s,pt("disableProviderPing")))}}class X0{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=pt("events"),this.client=pt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,n){this.httpProviders[r]||this.setHttpProvider(r,n),this.chainId=r,this.events.emit(je.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(n=>{var s;const a=hr(n);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[n])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return n}setHttpProvider(r,n){const s=this.createHttpProvider(r,n);s&&(this.httpProviders[r]=s)}createHttpProvider(r,n){const s=n||We(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new De(new Qe(s,pt("disableProviderPing")))}}class tS{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=pt("events"),this.client=pt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,n){this.httpProviders[r]||this.setHttpProvider(r,n),this.chainId=r,this.events.emit(je.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(n=>{var s;const a=hr(n);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[n])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return n}setHttpProvider(r,n){const s=this.createHttpProvider(r,n);s&&(this.httpProviders[r]=s)}createHttpProvider(r,n){const s=n||We(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new De(new Qe(s,pt("disableProviderPing")))}}class eS{constructor(r){this.name="near",this.namespace=r.namespace,this.events=pt("events"),this.client=pt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,n){if(this.chainId=r,!this.httpProviders[r]){const s=n||We(`${this.name}:${r}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,s)}this.events.emit(je.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(n=>{var s;r[n]=this.createHttpProvider(n,(s=this.namespace.rpcMap)==null?void 0:s[n])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return n}setHttpProvider(r,n){const s=this.createHttpProvider(r,n);s&&(this.httpProviders[r]=s)}createHttpProvider(r,n){const s=n||We(r,this.namespace);return typeof s>"u"?void 0:new De(new Qe(s,pt("disableProviderPing")))}}var rS=Object.defineProperty,nS=Object.defineProperties,sS=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,iS=Object.prototype.hasOwnProperty,oS=Object.prototype.propertyIsEnumerable,Il=(o,r,n)=>r in o?rS(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,ws=(o,r)=>{for(var n in r||(r={}))iS.call(r,n)&&Il(o,n,r[n]);if(El)for(var n of El(r))oS.call(r,n)&&Il(o,n,r[n]);return o},co=(o,r)=>nS(o,sS(r));class Mo{constructor(r){this.events=new Ro,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ps(Rs({level:(r==null?void 0:r.logger)||vl})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const n=new Mo(r);return await n.initialize(),n}async request(r,n){const[s,a]=this.validateChain(n);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ws({},r),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(r,n,s){const a=new Date().getTime();this.request(r,s).then(u=>n(null,Os(a,u))).catch(u=>n(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:vt("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,n){this.events.on(r,n)}once(r,n){this.events.once(r,n)}removeListener(r,n){this.events.removeListener(r,n)}off(r,n){this.events.off(r,n)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let n=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(n>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=B0(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==dh)throw u;n++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,n){try{if(!this.session)return;const[s,a]=this.validateChain(r);this.getProvider(s).setDefaultChain(a,n)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const n=this.client.pairing.getAll();if(cr(n)){for(const s of n)r.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${n.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await R0.init({logger:this.providerOpts.logger||vl,relayUrl:this.providerOpts.relayUrl||j0,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(n=>dn(n)))];ao("client",this.client),ao("events",this.events),ao("disableProviderPing",this.disableProviderPing),r.forEach(n=>{if(!this.session)return;const s=K0(n,this.session),a=yh(s),u=F0(this.namespaces,this.optionalNamespaces),h=co(ws({},u[n]),{accounts:s,chains:a});switch(n){case"eip155":this.rpcProviders[n]=new Q0({namespace:h});break;case"solana":this.rpcProviders[n]=new J0({namespace:h});break;case"cosmos":this.rpcProviders[n]=new Z0({namespace:h});break;case"polkadot":this.rpcProviders[n]=new W0({namespace:h});break;case"cip34":this.rpcProviders[n]=new Y0({namespace:h});break;case"elrond":this.rpcProviders[n]=new X0({namespace:h});break;case"multiversx":this.rpcProviders[n]=new tS({namespace:h});break;case"near":this.rpcProviders[n]=new eS({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:n}=r,{event:s}=n;if(s.name==="accountsChanged"){const a=s.data;a&&cr(a)&&this.events.emit("accountsChanged",a.map(G0))}else if(s.name==="chainChanged"){const a=n.chainId,u=n.event.data,h=dn(a),y=oo(a)!==oo(u)?`${h}:${oo(u)}`:a;this.onChainChanged(y)}else this.events.emit(s.name,s.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:n})=>{var s;const{namespaces:a}=n,u=(s=this.client)==null?void 0:s.session.get(r);this.session=co(ws({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:n})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",co(ws({},vt("USER_DISCONNECTED")),{data:r.topic}))}),this.on(je.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var n;this.getProvider(r).updateNamespace((n=this.session)==null?void 0:n.namespaces[r])})}setNamespaces(r){const{namespaces:n,optionalNamespaces:s,sessionProperties:a}=r;n&&Object.keys(n).length&&(this.namespaces=n),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",n),this.persist("optionalNamespaces",s)}validateChain(r){const[n,s]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[n,s];if(n&&!Object.keys(this.namespaces||{}).map(h=>dn(h)).includes(n))throw new Error(`Namespace '${n}' is not configured. Please call connect() first with namespace config.`);if(n&&s)return[n,s];const a=dn(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,n=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(r);n||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,n){this.client.core.storage.setItem(`${ml}/${r}`,n)}async getFromStore(r){return await this.client.core.storage.getItem(`${ml}/${r}`)}}const aS=Mo,cS="wc",uS="ethereum_provider",lS=`${cS}@2:${uS}:`,hS="https://rpc.walletconnect.com/v1/",So=["eth_sendTransaction","personal_sign"],pS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Po=["chainChanged","accountsChanged"],fS=["chainChanged","accountsChanged","message","disconnect","connect"];var dS=Object.defineProperty,gS=Object.defineProperties,yS=Object.getOwnPropertyDescriptors,Sl=Object.getOwnPropertySymbols,vS=Object.prototype.hasOwnProperty,mS=Object.prototype.propertyIsEnumerable,Pl=(o,r,n)=>r in o?dS(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,yn=(o,r)=>{for(var n in r||(r={}))vS.call(r,n)&&Pl(o,n,r[n]);if(Sl)for(var n of Sl(r))mS.call(r,n)&&Pl(o,n,r[n]);return o},Rl=(o,r)=>gS(o,yS(r));function Ss(o){return Number(o[0].split(":")[1])}function uo(o){return`0x${o.toString(16)}`}function wS(o){const{chains:r,optionalChains:n,methods:s,optionalMethods:a,events:u,optionalEvents:h,rpcMap:y}=o;if(!ho(r))throw new Error("Invalid chains");const I={chains:r,methods:s||So,events:u||Po,rpcMap:yn({},r.length?{[Ss(r)]:y[Ss(r)]}:{})},R=u==null?void 0:u.filter(F=>!Po.includes(F)),O=s==null?void 0:s.filter(F=>!So.includes(F));if(!n&&!h&&!a&&!(R!=null&&R.length)&&!(O!=null&&O.length))return{required:r.length?I:void 0};const A=(R==null?void 0:R.length)&&(O==null?void 0:O.length)||!n,j={chains:[...new Set(A?I.chains.concat(n||[]):n)],methods:[...new Set(I.methods.concat(a!=null&&a.length?a:pS))],events:[...new Set(I.events.concat(h!=null&&h.length?h:fS))],rpcMap:y};return{required:r.length?I:void 0,optional:n.length?j:void 0}}class Lo{constructor(){this.events=new _e.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=lS,this.on=(r,n)=>(this.events.on(r,n),this),this.once=(r,n)=>(this.events.once(r,n),this),this.removeListener=(r,n)=>(this.events.removeListener(r,n),this),this.off=(r,n)=>(this.events.off(r,n),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const n=new Lo;return await n.initialize(r),n}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,n){this.signer.sendAsync(r,n,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:n,optional:s}=wS(this.rpc);try{const a=await new Promise(async(h,y)=>{var I;this.rpc.showQrModal&&((I=this.modal)==null||I.subscribeModal(R=>{!R.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Rl(yn({namespaces:yn({},n&&{[this.namespace]:n})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(R=>{h(R)}).catch(R=>{y(new Error(R.message))})});if(!a)return;const u=xw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:uo(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:n}=r,{event:s}=n;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const n=parseInt(r);this.chainId=n,this.events.emit("chainChanged",uo(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",Rl(yn({},Tw("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var n,s;this.rpc.showQrModal&&((n=this.modal)==null||n.closeModal(),(s=this.modal)==null||s.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const n=r.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));n.length&&(this.chainId=n[0],this.events.emit("chainChanged",uo(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const n=this.parseChainId(r);this.chainId=n,this.switchEthereumChain(n)}}parseAccountId(r){const[n,s,a]=r.split(":");return{chainId:`${n}:${s}`,address:a}}setAccounts(r){this.accounts=r.filter(n=>this.parseChainId(this.parseAccountId(n).chainId)===this.chainId).map(n=>this.parseAccountId(n).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var n,s;const a=(n=r==null?void 0:r.chains)!=null?n:[],u=(s=r==null?void 0:r.optionalChains)!=null?s:[],h=a.concat(u);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=a.length?(r==null?void 0:r.methods)||So:[],I=a.length?(r==null?void 0:r.events)||Po:[],R=(r==null?void 0:r.optionalMethods)||[],O=(r==null?void 0:r.optionalEvents)||[],A=(r==null?void 0:r.rpcMap)||this.buildRpcMap(h,r.projectId),j=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(F=>this.formatChainId(F)),optionalChains:u.map(F=>this.formatChainId(F)),methods:y,events:I,optionalMethods:R,optionalEvents:O,rpcMap:A,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:j,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,n){const s={};return r.forEach(a=>{s[a]=this.getRpcUrl(a,n)}),s}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?Ss(this.rpc.chains):Ss(this.rpc.optionalChains),this.signer=await aS.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let n;try{const{WalletConnectModal:s}=await fw(async()=>{const{WalletConnectModal:a}=await import("./index-BVRvOPhF.lm4p6xgw.js");return{WalletConnectModal:a}},[],import.meta.url).then(a=>a.i);n=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(n)try{this.modal=new n(yn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:n,optionalChains:s,rpcMap:a}=r;n&&ho(n)&&(this.rpc.chains=n.map(u=>this.formatChainId(u)),n.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&ho(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(r,n){var s;return((s=this.rpc.rpcMap)==null?void 0:s[r])||`${hS}?chainId=eip155:${r}&projectId=${n||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),n=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:n==null?void 0:n.accounts),this.setAccounts(n==null?void 0:n.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(n=>this.parseAccount(n))}}const TS=Lo;export{TS as EthereumProvider,fS as OPTIONAL_EVENTS,pS as OPTIONAL_METHODS,Po as REQUIRED_EVENTS,So as REQUIRED_METHODS,Lo as default};
